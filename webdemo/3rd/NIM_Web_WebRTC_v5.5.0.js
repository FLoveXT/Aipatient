!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.WebRTC=t():e.WebRTC=t()}(window,function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=377)}([,function(e,t){var n=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},function(e,t,n){var r=n(37)("wks"),i=n(23),o=n(1).Symbol,a="function"==typeof o;(e.exports=function(e){return r[e]||(r[e]=a&&o[e]||(a?o:i)("Symbol."+e))}).store=r},function(e,t,n){"use strict";var r={info:{hash:"22810abc547670ef206e55ee91d2252dd6d63f75",shortHash:"22810abc",version:"5.5.0",sdkVersion:"52",nrtcVersion:"4.1.0",nrtcSdkVersion:"1",protocolVersion:1},agentVersion:"2.7.0.710",lbsUrl:"https://lbs.netease.im/lbs/webconf.jsp",roomserver:"roomserver.netease.im",connectTimeout:1e4,xhrTimeout:1e4,socketTimeout:1e4,reconnectionDelay:800,reconnectionDelayMax:1e4,reconnectionJitter:.01,heartbeatInterval:3e4,cmdTimeout:1e4,defaultReportUrl:"https://dr.netease.im/1.gif",isWeixinApp:!1,isNodejs:!1,isRN:!1,PUSHTOKEN:"",PUSHCONFIG:{},CLIENTTYPE:16,formatSocketUrl:function(e){var t=e.url,n=e.secure?"https":"http";return-1===t.indexOf("http")?n+"://"+t:t},uploadUrl:"https://nos.netease.com",replaceUrl:"https://{bucket}.nosdn.127.net/{object}",downloadHost:"nos.netease.com",downloadUrl:"https://{bucket}.nosdn.127.net/{object}",httpsEnabled:!1,genUploadUrl:function(e){return r.uploadUrl+"/"+e},genDownloadUrl:function(e,t){var n=e.bucket,i=(e.tag,e.expireSec),o=+new Date,a=i?"&survivalTime="+i:"",s=r.replaceUrl+"?createTime="+o+a;return/^http/.test(s)?r.httpsEnabled&&(s=s.replace("http","https")):s=r.httpsEnabled?"https://"+s:"http://"+s,s.replace("{bucket}",n).replace("{object}",t)}};e.exports=r},function(e,t){var n=e.exports={version:"2.5.7"};"number"==typeof __e&&(__e=n)},function(e,t,n){"use strict";t.__esModule=!0;var r=a(n(75)),i=a(n(86)),o="function"==typeof i.default&&"symbol"==typeof r.default?function(e){return typeof e}:function(e){return e&&"function"==typeof i.default&&e.constructor===i.default&&e!==i.default.prototype?"symbol":typeof e};function a(e){return e&&e.__esModule?e:{default:e}}t.default="function"==typeof i.default&&"symbol"===o(r.default)?function(e){return void 0===e?"undefined":o(e)}:function(e){return e&&"function"==typeof i.default&&e.constructor===i.default&&e!==i.default.prototype?"symbol":void 0===e?"undefined":o(e)}},function(e,t,n){var r=n(10),i=n(53),o=n(35),a=Object.defineProperty;t.f=n(8)?Object.defineProperty:function(e,t,n){if(r(e),t=o(t,!0),r(n),i)try{return a(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(e[t]=n.value),e}},function(e,t){var n={}.hasOwnProperty;e.exports=function(e,t){return n.call(e,t)}},function(e,t,n){e.exports=!n(15)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(e,t,n){var r=n(6),i=n(21);e.exports=n(8)?function(e,t,n){return r.f(e,t,i(1,n))}:function(e,t,n){return e[t]=n,e}},function(e,t,n){var r=n(11);e.exports=function(e){if(!r(e))throw TypeError(e+" is not an object!");return e}},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t,n){var r=n(56),i=n(34);e.exports=function(e){return r(i(e))}},function(e,t,n){var r=n(1),i=n(4),o=n(43),a=n(9),s=n(7),c=function(e,t,n){var u,d,l,p=e&c.F,f=e&c.G,h=e&c.S,m=e&c.P,v=e&c.B,g=e&c.W,y=f?i:i[t]||(i[t]={}),S=y.prototype,b=f?r:h?r[t]:(r[t]||{}).prototype;for(u in f&&(n=t),n)(d=!p&&b&&void 0!==b[u])&&s(y,u)||(l=d?b[u]:n[u],y[u]=f&&"function"!=typeof b[u]?n[u]:v&&d?o(l,r):g&&b[u]==l?function(e){var t=function(t,n,r){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,n)}return new e(t,n,r)}return e.apply(this,arguments)};return t.prototype=e.prototype,t}(l):m&&"function"==typeof l?o(Function.call,l):l,m&&((y.virtual||(y.virtual={}))[u]=l,e&c.R&&S&&!S[u]&&a(S,u,l)))};c.F=1,c.G=2,c.S=4,c.P=8,c.B=16,c.W=32,c.U=64,c.R=128,e.exports=c},function(e,t,n){"use strict";t.__esModule=!0,t.default=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t,n){"use strict";(function(t){var r=function(e){return e&&e.__esModule?e:{default:e}}(n(5));var i=function(){var e="object"===(void 0===t?"undefined":(0,r.default)(t))?t:window,n=Math.pow(2,53)-1,i=/\bOpera/,o=Object.prototype,a=o.hasOwnProperty,s=o.toString;function c(e){return(e=String(e)).charAt(0).toUpperCase()+e.slice(1)}function u(e){return e=h(e),/^(?:webOS|i(?:OS|P))/.test(e)?e:c(e)}function d(e,t){for(var n in e)a.call(e,n)&&t(e[n],n,e)}function l(e){return null==e?c(e):s.call(e).slice(8,-1)}function p(e){return String(e).replace(/([ -])(?!$)/g,"$1?")}function f(e,t){var r=null;return function(e,t){var r=-1,i=e?e.length:0;if("number"==typeof i&&i>-1&&i<=n)for(;++r<i;)t(e[r],r,e);else d(e,t)}(e,function(n,i){r=t(r,n,i,e)}),r}function h(e){return String(e).replace(/^ +| +$/g,"")}return function t(n){var o=e,a=n&&"object"===(void 0===n?"undefined":(0,r.default)(n))&&"String"!=l(n);a&&(o=n,n=null);var c=o.navigator||{},m=c.userAgent||"";n||(n=m);var v,g,y=a?!!c.likeChrome:/\bChrome\b/.test(n)&&!/internal|\n/i.test(s.toString()),S=a?"Object":"ScriptBridgingProxyObject",b=a?"Object":"Environment",C=a&&o.java?"JavaPackage":l(o.java),_=a?"Object":"RuntimeObject",T=/\bJava/.test(C)&&o.java,R=T&&l(o.environment)==b,w=T?"a":"α",k=T?"b":"β",E=o.document||{},P=o.operamini||o.opera,O=i.test(O=a&&P?P["[[Class]]"]:l(P))?O:P=null,I=n,A=[],x=null,M=n==m,D=M&&P&&"function"==typeof P.version&&P.version(),L=function(e){return f(e,function(e,t){return e||RegExp("\\b"+(t.pattern||p(t))+"\\b","i").exec(n)&&(t.label||t)})}([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"]),j=function(e){return f(e,function(e,t){return e||RegExp("\\b"+(t.pattern||p(t))+"\\b","i").exec(n)&&(t.label||t)})}(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"Edge"},"Midori","Nook Browser","PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Waterfox","WebPositive","Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chrome",{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"]),N=F([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),V=function(e){return f(e,function(e,t,r){return e||(t[N]||t[/^[a-z]+(?: +[a-z]+\b)*/i.exec(N)]||RegExp("\\b"+p(r)+"(?:\\b|\\w*\\d)","i").exec(n))&&r})}({Apple:{iPad:1,iPhone:1,iPod:1},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1}}),U=function(e){return f(e,function(e,t){var r=t.pattern||p(t);return!e&&(e=RegExp("\\b"+r+"(?:/[\\d.]+|[ \\w.]*)","i").exec(n))&&(e=function(e,t,n){var r={"10.0":"10",6.4:"10 Technical Preview",6.3:"8.1",6.2:"8",6.1:"Server 2008 R2 / 7","6.0":"Server 2008 / Vista",5.2:"Server 2003 / XP 64-bit",5.1:"XP",5.01:"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};return t&&n&&/^Win/i.test(e)&&!/^Windows Phone /i.test(e)&&(r=r[/[\d.]+$/.exec(e)])&&(e="Windows "+r),e=String(e),t&&n&&(e=e.replace(RegExp(t,"i"),n)),e=u(e.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0])}(e,r,t.label||t)),e})}(["Windows Phone","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian","Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "]);function F(e){return f(e,function(e,t){var r=t.pattern||p(t);return!e&&(e=RegExp("\\b"+r+" *\\d+[.\\w_]*","i").exec(n)||RegExp("\\b"+r+" *\\w+-[\\w]*","i").exec(n)||RegExp("\\b"+r+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(n))&&((e=String(t.label&&!RegExp(r,"i").test(t.label)?t.label:e).split("/"))[1]&&!/[\d.]+/.test(e[0])&&(e[0]+=" "+e[1]),t=t.label||t,e=u(e[0].replace(RegExp(r,"i"),t).replace(RegExp("; *(?:"+t+"[_-])?","i")," ").replace(RegExp("("+t+")[-_.]?(\\w)","i"),"$1 $2"))),e})}if(L&&(L=[L]),V&&!N&&(N=F([V])),(v=/\bGoogle TV\b/.exec(N))&&(N=v[0]),/\bSimulator\b/i.test(n)&&(N=(N?N+" ":"")+"Simulator"),"Opera Mini"==j&&/\bOPiOS\b/.test(n)&&A.push("running in Turbo/Uncompressed mode"),"IE"==j&&/\blike iPhone OS\b/.test(n)?(V=(v=t(n.replace(/like iPhone OS/,""))).manufacturer,N=v.product):/^iP/.test(N)?(j||(j="Safari"),U="iOS"+((v=/ OS ([\d_]+)/i.exec(n))?" "+v[1].replace(/_/g,"."):"")):"Konqueror"!=j||/buntu/i.test(U)?V&&"Google"!=V&&(/Chrome/.test(j)&&!/\bMobile Safari\b/i.test(n)||/\bVita\b/.test(N))||/\bAndroid\b/.test(U)&&/^Chrome/.test(j)&&/\bVersion\//i.test(n)?(j="Android Browser",U=/\bAndroid\b/.test(U)?U:"Android"):"Silk"==j?(/\bMobi/i.test(n)||(U="Android",A.unshift("desktop mode")),/Accelerated *= *true/i.test(n)&&A.unshift("accelerated")):"PaleMoon"==j&&(v=/\bFirefox\/([\d.]+)\b/.exec(n))?A.push("identifying as Firefox "+v[1]):"Firefox"==j&&(v=/\b(Mobile|Tablet|TV)\b/i.exec(n))?(U||(U="Firefox OS"),N||(N=v[1])):!j||(v=!/\bMinefield\b/i.test(n)&&/\b(?:Firefox|Safari)\b/.exec(j))?(j&&!N&&/[\/,]|^[^(]+?\)/.test(n.slice(n.indexOf(v+"/")+8))&&(j=null),(v=N||V||U)&&(N||V||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(U))&&(j=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(U)?U:v)+" Browser")):"Electron"==j&&(v=(/\bChrome\/([\d.]+)\b/.exec(n)||0)[1])&&A.push("Chromium "+v):U="Kubuntu",D||(D=function(e){return f(e,function(e,t){return e||(RegExp(t+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(n)||0)[1]||null})}(["(?:Cloud9|CriOS|CrMo|Edge|FxiOS|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$))","Version",p(j),"(?:Firefox|Minefield|NetFront)"])),(v=("iCab"==L&&parseFloat(D)>3?"WebKit":/\bOpera\b/.test(j)&&(/\bOPR\b/.test(n)?"Blink":"Presto"))||/\b(?:Midori|Nook|Safari)\b/i.test(n)&&!/^(?:Trident|EdgeHTML)$/.test(L)&&"WebKit"||!L&&/\bMSIE\b/i.test(n)&&("Mac OS"==U?"Tasman":"Trident")||"WebKit"==L&&/\bPlayStation\b(?! Vita\b)/i.test(j)&&"NetFront")&&(L=[v]),"IE"==j&&(v=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(n)||0)[1])?(j+=" Mobile",U="Windows Phone "+(/\+$/.test(v)?v:v+".x"),A.unshift("desktop mode")):/\bWPDesktop\b/i.test(n)?(j="IE Mobile",U="Windows Phone 8.x",A.unshift("desktop mode"),D||(D=(/\brv:([\d.]+)/.exec(n)||0)[1])):"IE"!=j&&"Trident"==L&&(v=/\brv:([\d.]+)/.exec(n))&&(j&&A.push("identifying as "+j+(D?" "+D:"")),j="IE",D=v[1]),M){if(function(e,t){var n=null!=e?(0,r.default)(e[t]):"number";return!(/^(?:boolean|number|string|undefined)$/.test(n)||"object"==n&&!e[t])}(o,"global"))if(T&&(I=(v=T.lang.System).getProperty("os.arch"),U=U||v.getProperty("os.name")+" "+v.getProperty("os.version")),R){try{D=o.require("ringo/engine").version.join("."),j="RingoJS"}catch(e){(v=o.system)&&v.global.system==o.system&&(j="Narwhal",U||(U=v[0].os||null))}j||(j="Rhino")}else"object"===(0,r.default)(o.process)&&!o.process.browser&&(v=o.process)&&("object"===(0,r.default)(v.versions)&&("string"==typeof v.versions.electron?(A.push("Node "+v.versions.node),j="Electron",D=v.versions.electron):"string"==typeof v.versions.nw&&(A.push("Chromium "+D,"Node "+v.versions.node),j="NW.js",D=v.versions.nw)),j||(j="Node.js",I=v.arch,U=v.platform,D=(D=/[\d.]+/.exec(v.version))?D[0]:null));else l(v=o.runtime)==S?(j="Adobe AIR",U=v.flash.system.Capabilities.os):l(v=o.phantom)==_?(j="PhantomJS",D=(v=v.version||null)&&v.major+"."+v.minor+"."+v.patch):"number"==typeof E.documentMode&&(v=/\bTrident\/(\d+)/i.exec(n))?(D=[D,E.documentMode],(v=+v[1]+4)!=D[1]&&(A.push("IE "+D[1]+" mode"),L&&(L[1]=""),D[1]=v),D="IE"==j?String(D[1].toFixed(1)):D[0]):"number"==typeof E.documentMode&&/^(?:Chrome|Firefox)\b/.test(j)&&(A.push("masking as "+j+" "+D),j="IE",D="11.0",L=["Trident"],U="Windows");U=U&&u(U)}if(D&&(v=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(D)||/(?:alpha|beta)(?: ?\d)?/i.exec(n+";"+(M&&c.appMinorVersion))||/\bMinefield\b/i.test(n)&&"a")&&(x=/b/i.test(v)?"beta":"alpha",D=D.replace(RegExp(v+"\\+?$"),"")+("beta"==x?k:w)+(/\d+\+?/.exec(v)||"")),"Fennec"==j||"Firefox"==j&&/\b(?:Android|Firefox OS)\b/.test(U))j="Firefox Mobile";else if("Maxthon"==j&&D)D=D.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(N))"Xbox 360"==N&&(U=null),"Xbox 360"==N&&/\bIEMobile\b/.test(n)&&A.unshift("mobile mode");else if(!/^(?:Chrome|IE|Opera)$/.test(j)&&(!j||N||/Browser|Mobi/.test(j))||"Windows CE"!=U&&!/Mobi/i.test(n))if("IE"==j&&M)try{null===o.external&&A.unshift("platform preview")}catch(e){A.unshift("embedded")}else(/\bBlackBerry\b/.test(N)||/\bBB10\b/.test(n))&&(v=(RegExp(N.replace(/ +/g," *")+"/([.\\d]+)","i").exec(n)||0)[1]||D)?(U=((v=[v,/BB10/.test(n)])[1]?(N=null,V="BlackBerry"):"Device Software")+" "+v[0],D=null):this!=d&&"Wii"!=N&&(M&&P||/Opera/.test(j)&&/\b(?:MSIE|Firefox)\b/i.test(n)||"Firefox"==j&&/\bOS X (?:\d+\.){2,}/.test(U)||"IE"==j&&(U&&!/^Win/.test(U)&&D>5.5||/\bWindows XP\b/.test(U)&&D>8||8==D&&!/\bTrident\b/.test(n)))&&!i.test(v=t.call(d,n.replace(i,"")+";"))&&v.name&&(v="ing as "+v.name+((v=v.version)?" "+v:""),i.test(j)?(/\bIE\b/.test(v)&&"Mac OS"==U&&(U=null),v="identify"+v):(v="mask"+v,j=O?u(O.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(v)&&(U=null),M||(D=null)),L=["Presto"],A.push(v));else j+=" Mobile";(v=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(n)||0)[1])&&(v=[parseFloat(v.replace(/\.(\d)$/,".0$1")),v],"Safari"==j&&"+"==v[1].slice(-1)?(j="WebKit Nightly",x="alpha",D=v[1].slice(0,-1)):D!=v[1]&&D!=(v[2]=(/\bSafari\/([\d.]+\+?)/i.exec(n)||0)[1])||(D=null),v[1]=(/\bChrome\/([\d.]+)/i.exec(n)||0)[1],537.36==v[0]&&537.36==v[2]&&parseFloat(v[1])>=28&&"WebKit"==L&&(L=["Blink"]),M&&(y||v[1])?(L&&(L[1]="like Chrome"),v=v[1]||((v=v[0])<530?1:v<532?2:v<532.05?3:v<533?4:v<534.03?5:v<534.07?6:v<534.1?7:v<534.13?8:v<534.16?9:v<534.24?10:v<534.3?11:v<535.01?12:v<535.02?"13+":v<535.07?15:v<535.11?16:v<535.19?17:v<536.05?18:v<536.1?19:v<537.01?20:v<537.11?"21+":v<537.13?23:v<537.18?24:v<537.24?25:v<537.36?26:"Blink"!=L?"27":"28")):(L&&(L[1]="like Safari"),v=(v=v[0])<400?1:v<500?2:v<526?3:v<533?4:v<534?"4+":v<535?5:v<537?6:v<538?7:v<601?8:"8"),L&&(L[1]+=" "+(v+="number"==typeof v?".x":/[.+]/.test(v)?"":"+")),"Safari"==j&&(!D||parseInt(D)>45)&&(D=v)),"Opera"==j&&(v=/\bzbov|zvav$/.exec(U))?(j+=" ",A.unshift("desktop mode"),"zvav"==v?(j+="Mini",D=null):j+="Mobile",U=U.replace(RegExp(" *"+v+"$"),"")):"Safari"==j&&/\bChrome\b/.exec(L&&L[1])&&(A.unshift("desktop mode"),j="Chrome Mobile",D=null,/\bOS X\b/.test(U)?(V="Apple",U="iOS 4.3+"):U=null),D&&0==D.indexOf(v=/[\d.]+$/.exec(U))&&n.indexOf("/"+v+"-")>-1&&(U=h(U.replace(v,""))),L&&!/\b(?:Avant|Nook)\b/.test(j)&&(/Browser|Lunascape|Maxthon/.test(j)||"Safari"!=j&&/^iOS/.test(U)&&/\bSafari\b/.test(L[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|Web)/.test(j)&&L[1])&&(v=L[L.length-1])&&A.push(v),A.length&&(A=["("+A.join("; ")+")"]),V&&N&&N.indexOf(V)<0&&A.push("on "+V),N&&A.push((/^on /.test(A[A.length-1])?"":"on ")+N),U&&(v=/ ([\d.+]+)$/.exec(U),g=v&&"/"==U.charAt(U.length-v[0].length-1),U={architecture:32,family:v&&!g?U.replace(v[0],""):U,version:v?v[1]:null,toString:function(){var e=this.version;return this.family+(e&&!g?" "+e:"")+(64==this.architecture?" 64-bit":"")}}),(v=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(I))&&!/\bi686\b/i.test(I)?(U&&(U.architecture=64,U.family=U.family.replace(RegExp(" *"+v),"")),j&&(/\bWOW64\b/i.test(n)||M&&/\w(?:86|32)$/.test(c.cpuClass||c.platform)&&!/\bWin64; x64\b/i.test(n))&&A.unshift("32-bit")):U&&/^OS X/.test(U.family)&&"Chrome"==j&&parseFloat(D)>=39&&(U.architecture=64),n||(n=null);var B={};return B.description=n,B.layout=L&&L[0],B.manufacturer=V,B.name=j,B.prerelease=x,B.product=N,B.ua=n,B.version=j&&D,B.os=U||{architecture:null,family:null,version:null,toString:function(){return"null"}},B.parse=t,B.toString=function(){return this.description||""},B.version&&A.unshift(D),B.name&&A.unshift(j),U&&j&&(U!=String(U).split(" ")[0]||U!=j.split(" ")[0]&&!N)&&A.push(N?"("+U+")":"on "+U),A.length&&(B.description=A.join(" ")),B}()}();e.exports=i}).call(this,n(29))},function(e,t){e.exports={}},,,function(e,t){e.exports=!0},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t,n){var r=n(55),i=n(38);e.exports=Object.keys||function(e){return r(e,i)}},function(e,t){var n=0,r=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++n+r).toString(36))}},function(e,t){t.f={}.propertyIsEnumerable},function(e,t,n){"use strict";var r=Object.prototype.hasOwnProperty,i="~";function o(){}function a(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function s(){this._events=new o,this._eventsCount=0}Object.create&&(o.prototype=Object.create(null),(new o).__proto__||(i=!1)),s.prototype.eventNames=function(){var e,t,n=[];if(0===this._eventsCount)return n;for(t in e=this._events)r.call(e,t)&&n.push(i?t.slice(1):t);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},s.prototype.listeners=function(e,t){var n=i?i+e:e,r=this._events[n];if(t)return!!r;if(!r)return[];if(r.fn)return[r.fn];for(var o=0,a=r.length,s=new Array(a);o<a;o++)s[o]=r[o].fn;return s},s.prototype.emit=function(e,t,n,r,o,a){var s=i?i+e:e;if(!this._events[s])return!1;var c,u,d=this._events[s],l=arguments.length;if(d.fn){switch(d.once&&this.removeListener(e,d.fn,void 0,!0),l){case 1:return d.fn.call(d.context),!0;case 2:return d.fn.call(d.context,t),!0;case 3:return d.fn.call(d.context,t,n),!0;case 4:return d.fn.call(d.context,t,n,r),!0;case 5:return d.fn.call(d.context,t,n,r,o),!0;case 6:return d.fn.call(d.context,t,n,r,o,a),!0}for(u=1,c=new Array(l-1);u<l;u++)c[u-1]=arguments[u];d.fn.apply(d.context,c)}else{var p,f=d.length;for(u=0;u<f;u++)switch(d[u].once&&this.removeListener(e,d[u].fn,void 0,!0),l){case 1:d[u].fn.call(d[u].context);break;case 2:d[u].fn.call(d[u].context,t);break;case 3:d[u].fn.call(d[u].context,t,n);break;case 4:d[u].fn.call(d[u].context,t,n,r);break;default:if(!c)for(p=1,c=new Array(l-1);p<l;p++)c[p-1]=arguments[p];d[u].fn.apply(d[u].context,c)}}return!0},s.prototype.on=function(e,t,n){var r=new a(t,n||this),o=i?i+e:e;return this._events[o]?this._events[o].fn?this._events[o]=[this._events[o],r]:this._events[o].push(r):(this._events[o]=r,this._eventsCount++),this},s.prototype.once=function(e,t,n){var r=new a(t,n||this,!0),o=i?i+e:e;return this._events[o]?this._events[o].fn?this._events[o]=[this._events[o],r]:this._events[o].push(r):(this._events[o]=r,this._eventsCount++),this},s.prototype.removeListener=function(e,t,n,r){var a=i?i+e:e;if(!this._events[a])return this;if(!t)return 0==--this._eventsCount?this._events=new o:delete this._events[a],this;var s=this._events[a];if(s.fn)s.fn!==t||r&&!s.once||n&&s.context!==n||(0==--this._eventsCount?this._events=new o:delete this._events[a]);else{for(var c=0,u=[],d=s.length;c<d;c++)(s[c].fn!==t||r&&!s[c].once||n&&s[c].context!==n)&&u.push(s[c]);u.length?this._events[a]=1===u.length?u[0]:u:0==--this._eventsCount?this._events=new o:delete this._events[a]}return this},s.prototype.removeAllListeners=function(e){var t;return e?(t=i?i+e:e,this._events[t]&&(0==--this._eventsCount?this._events=new o:delete this._events[t])):(this._events=new o,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prototype.setMaxListeners=function(){return this},s.prefixed=i,s.EventEmitter=s,e.exports=s},function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.url2origin=t.uniqueID=t.off=t.removeEventListener=t.on=t.addEventListener=t.format=t.regWhiteSpace=t.regBlank=t.emptyFunc=t.f=t.emptyObj=t.o=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(n(5));t.getGlobal=i,t.detectCSSFeature=function(e){var t=!1,n="Webkit Moz ms O".split(" "),r=document.createElement("div"),i=null;e=e.toLowerCase(),void 0!==r.style[e]&&(t=!0);if(!1===t){i=e.charAt(0).toUpperCase()+e.substr(1);for(var o=0;o<n.length;o++)if(void 0!==r.style[n[o]+i]){t=!0;break}}return t},t.fix=o,t.getYearStr=a,t.getMonthStr=s,t.getDayStr=c,t.getHourStr=u,t.getMinuteStr=d,t.getSecondStr=l,t.getMillisecondStr=p,t.dateFromDateTimeLocal=function(e){return e=""+e,new Date(e.replace(/-/g,"/").replace("T"," "))},t.getClass=f,t.typeOf=h,t.isString=m,t.isNumber=function(e){return"number"===h(e)},t.isBoolean=function(e){return"boolean"===h(e)},t.isArray=v,t.isFunction=g,t.isDate=y,t.isRegExp=function(e){return"regexp"===h(e)},t.isError=function(e){return"error"===h(e)},t.isnull=S,t.notnull=b,t.undef=C,t.notundef=_,t.exist=T,t.notexist=R,t.isObject=w,t.isEmpty=function(e){return R(e)||(m(e)||v(e))&&0===e.length},t.containsNode=function(e,t){if(e===t)return!0;for(;t.parentNode;){if(t.parentNode===e)return!0;t=t.parentNode}return!1},t.calcHeight=function(e){var t=e.parentNode||document.body;(e=e.cloneNode(!0)).style.display="block",e.style.opacity=0,e.style.height="auto",t.appendChild(e);var n=e.offsetHeight;return t.removeChild(e),n},t.remove=function(e){e.parentNode&&e.parentNode.removeChild(e)},t.dataset=function(e,t,n){if(!T(n))return e.getAttribute("data-"+t);e.setAttribute("data-"+t,n)},t.target=function(e){return e.target||e.srcElement},t.createIframe=function(e){var t;if((e=e||{}).name)try{(t=document.createElement('<iframe name="'+e.name+'"></iframe>')).frameBorder=0}catch(n){(t=document.createElement("iframe")).name=e.name}else t=document.createElement("iframe");e.visible||(t.style.display="none");g(e.onload)&&E(t,"load",function n(r){if(!t.src)return;e.multi||O(t,"load",n);e.onload(r)});(e.parent||document.body).appendChild(t);var n=e.src||"about:blank";return setTimeout(function(){t.src=n},0),t},t.html2node=function(e){var t=document.createElement("div");t.innerHTML=e;var n=[],r=void 0,i=void 0;if(t.children)for(r=0,i=t.children.length;r<i;r++)n.push(t.children[r]);else for(r=0,i=t.childNodes.length;r<i;r++){var o=t.childNodes[r];1===o.nodeType&&n.push(o)}return n.length>1?t:n[0]},t.scrollTop=function(e){T(e)&&(document.documentElement.scrollTop=document.body.scrollTop=e);return window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0},t.forOwn=I,t.mixin=A,t.isJSON=x,t.parseJSON=function e(t){try{x(t)&&(t=JSON.parse(t)),w(t)&&I(t,function(n,r){switch(h(r)){case"string":case"object":t[n]=e(r)}})}catch(e){console.error(e)}return t},t.simpleClone=function(e){var t=[],n=JSON.stringify(e,function(e,n){if("object"===(void 0===n?"undefined":(0,r.default)(n))&&null!==n){if(-1!==t.indexOf(n))return;t.push(n)}return n});return JSON.parse(n)},t.merge=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n.forEach(function(t){A(e,t)}),e},t.fillUndef=function(e,t){return I(t,function(t,n){C(e[t])&&(e[t]=n)}),e},t.checkWithDefault=function(e,t,n){var r=e[t]||e[t.toLowerCase()];R(r)&&(r=n,e[t]=r);return r},t.fetch=function(e,t){return I(e,function(n,r){T(t[n])&&(e[n]=t[n])}),e},t.string2object=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:",",n={};return e.split(t).forEach(function(e){var t=e.split("="),r=t.shift();r&&(n[decodeURIComponent(r)]=decodeURIComponent(t.join("=")))}),n},t.object2string=M,t.genUrlSep=function(e){return e.indexOf("?")<0?"?":"&"},t.object2query=function(e){return M(e,"&",!0)},t.isFileInput=D,t.getKeys=function(e,t){var n=Object.keys(e);t&&n.sort(function(t,n){var r=D(e[t]),i=D(e[n]);return r===i?0:r?1:-1});return n};t.o={},t.emptyObj={},t.f=function(){},t.emptyFunc=function(){},t.regBlank=/\s+/gi,t.regWhiteSpace=/\s+/gi;function i(){return"undefined"!=typeof window?window:void 0!==e?e:{}}function o(e,t){t=t||2;for(var n=""+e;n.length<t;)n="0"+n;return n}function a(e){return""+e.getFullYear()}function s(e){return o(e.getMonth()+1)}function c(e){return o(e.getDate())}function u(e){return o(e.getHours())}function d(e){return o(e.getMinutes())}function l(e){return o(e.getSeconds())}function p(e){return o(e.getMilliseconds(),3)}t.format=function(){var e=/yyyy|MM|dd|hh|mm|ss|SSS/g,t={yyyy:a,MM:s,dd:c,hh:u,mm:d,ss:l,SSS:p};return function(n,r){return n=new Date(n),isNaN(+n)?"invalid date":(r=r||"yyyy-MM-dd").replace(e,function(e){return t[e](n)})}}();function f(e){return Object.prototype.toString.call(e).slice(8,-1)}function h(e){return f(e).toLowerCase()}function m(e){return"string"===h(e)}function v(e){return"array"===h(e)}function g(e){return"function"===h(e)}function y(e){return"date"===h(e)}function S(e){return null===e}function b(e){return null!==e}function C(e){return void 0===e}function _(e){return void 0!==e}function T(e){return _(e)&&b(e)}function R(e){return C(e)||S(e)}function w(e){return T(e)&&"object"===h(e)}var k=t.addEventListener=function(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on"+t,n)},E=t.on=k,P=t.removeEventListener=function(e,t,n){e.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent&&e.detachEvent("on"+t,n)},O=t.off=P;function I(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},n=arguments[2];for(var r in e)e.hasOwnProperty(r)&&t.call(n,r,e[r])}function A(e,t){I(t,function(t,n){e[t]=n})}t.uniqueID=function(){var e=0;return function(){return""+e++}}();function x(e){return m(e)&&0===e.indexOf("{")&&e.lastIndexOf("}")===e.length-1}function M(e,t,n){if(!e)return"";var r=[];return I(e,function(e,t){g(t)||(y(t)?t=t.getTime():v(t)?t=t.join(","):w(t)&&(t=JSON.stringify(t)),n&&(t=encodeURIComponent(t)),r.push(encodeURIComponent(e)+"="+t))}),r.join(t||",")}t.url2origin=function(){var e=/^([\w]+?:\/\/.*?(?=\/|$))/i;return function(t){return e.test(t||"")?RegExp.$1.toLowerCase():""}}();function D(e){var t=i();return e.tagName&&"INPUT"===e.tagName.toUpperCase()||t.Blob&&e instanceof t.Blob}}).call(this,n(29))},function(e,t,n){"use strict";t.__esModule=!0;var r=function(e){return e&&e.__esModule?e:{default:e}}(n(5));t.default=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":(0,r.default)(t))&&"function"!=typeof t?e:t}},function(e,t,n){"use strict";t.__esModule=!0;var r=a(n(140)),i=a(n(144)),o=a(n(5));function a(e){return e&&e.__esModule?e:{default:e}}t.default=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":(0,o.default)(t)));e.prototype=(0,i.default)(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(r.default?(0,r.default)(e,t):e.__proto__=t)}},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},,function(e,t,n){var r=n(6).f,i=n(7),o=n(2)("toStringTag");e.exports=function(e,t,n){e&&!i(e=n?e:e.prototype,o)&&r(e,o,{configurable:!0,value:t})}},function(e,t){var n={}.toString;e.exports=function(e){return n.call(e).slice(8,-1)}},function(e,t){var n=Math.ceil,r=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?r:n)(e)}},function(e,t){e.exports=function(e){if(void 0==e)throw TypeError("Can't call method on  "+e);return e}},function(e,t,n){var r=n(11);e.exports=function(e,t){if(!r(e))return e;var n,i;if(t&&"function"==typeof(n=e.toString)&&!r(i=n.call(e)))return i;if("function"==typeof(n=e.valueOf)&&!r(i=n.call(e)))return i;if(!t&&"function"==typeof(n=e.toString)&&!r(i=n.call(e)))return i;throw TypeError("Can't convert object to primitive value")}},function(e,t,n){var r=n(37)("keys"),i=n(23);e.exports=function(e){return r[e]||(r[e]=i(e))}},function(e,t,n){var r=n(4),i=n(1),o=i["__core-js_shared__"]||(i["__core-js_shared__"]={});(e.exports=function(e,t){return o[e]||(o[e]=void 0!==t?t:{})})("versions",[]).push({version:r.version,mode:n(20)?"pure":"global",copyright:"© 2018 Denis Pushkarev (zloirock.ru)"})},function(e,t){e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(e,t,n){t.f=n(2)},function(e,t,n){var r=n(1),i=n(4),o=n(20),a=n(39),s=n(6).f;e.exports=function(e){var t=i.Symbol||(i.Symbol=o?{}:r.Symbol||{});"_"==e.charAt(0)||e in t||s(t,e,{value:a.f(e)})}},function(e,t){t.f=Object.getOwnPropertySymbols},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(127);Object.defineProperty(t,"ajax",{enumerable:!0,get:function(){return a(r).default}});var i=n(147);Object.defineProperty(t,"element",{enumerable:!0,get:function(){return a(i).default}});var o=n(128);function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"tool",{enumerable:!0,get:function(){return a(o).default}})},function(e,t,n){var r=n(59);e.exports=function(e,t,n){if(r(e),void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)}}return function(){return e.apply(t,arguments)}}},,function(e,t,n){var r=n(10),i=n(79),o=n(38),a=n(36)("IE_PROTO"),s=function(){},c=function(){var e,t=n(47)("iframe"),r=o.length;for(t.style.display="none",n(70).appendChild(t),t.src="javascript:",(e=t.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),c=e.F;r--;)delete c.prototype[o[r]];return c()};e.exports=Object.create||function(e,t){var n;return null!==e?(s.prototype=r(e),n=new s,s.prototype=null,n[a]=e):n=c(),void 0===t?n:i(n,t)}},,function(e,t,n){var r=n(11),i=n(1).document,o=r(i)&&r(i.createElement);e.exports=function(e){return o?i.createElement(e):{}}},function(e,t,n){var r=n(34);e.exports=function(e){return Object(r(e))}},,function(e,t,n){"use strict";t.__esModule=!0;var r=function(e){return e&&e.__esModule?e:{default:e}}(n(108));t.default=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),(0,r.default)(e,i.key,i)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}()},function(e,t,n){"use strict";var r=n(77)(!0);n(52)(String,"String",function(e){this._t=String(e),this._i=0},function(){var e,t=this._t,n=this._i;return n>=t.length?{value:void 0,done:!0}:(e=r(t,n),this._i+=e.length,{value:e,done:!1})})},function(e,t,n){"use strict";var r=n(20),i=n(13),o=n(54),a=n(9),s=n(17),c=n(78),u=n(31),d=n(82),l=n(2)("iterator"),p=!([].keys&&"next"in[].keys()),f=function(){return this};e.exports=function(e,t,n,h,m,v,g){c(n,t,h);var y,S,b,C=function(e){if(!p&&e in w)return w[e];switch(e){case"keys":case"values":return function(){return new n(this,e)}}return function(){return new n(this,e)}},_=t+" Iterator",T="values"==m,R=!1,w=e.prototype,k=w[l]||w["@@iterator"]||m&&w[m],E=k||C(m),P=m?T?C("entries"):E:void 0,O="Array"==t&&w.entries||k;if(O&&(b=d(O.call(new e)))!==Object.prototype&&b.next&&(u(b,_,!0),r||"function"==typeof b[l]||a(b,l,f)),T&&k&&"values"!==k.name&&(R=!0,E=function(){return k.call(this)}),r&&!g||!p&&!R&&w[l]||a(w,l,E),s[t]=E,s[_]=f,m)if(y={values:T?E:C("values"),keys:v?E:C("keys"),entries:P},g)for(S in y)S in w||o(w,S,y[S]);else i(i.P+i.F*(p||R),t,y);return y}},function(e,t,n){e.exports=!n(8)&&!n(15)(function(){return 7!=Object.defineProperty(n(47)("div"),"a",{get:function(){return 7}}).a})},function(e,t,n){e.exports=n(9)},function(e,t,n){var r=n(7),i=n(12),o=n(80)(!1),a=n(36)("IE_PROTO");e.exports=function(e,t){var n,s=i(e),c=0,u=[];for(n in s)n!=a&&r(s,n)&&u.push(n);for(;t.length>c;)r(s,n=t[c++])&&(~o(u,n)||u.push(n));return u}},function(e,t,n){var r=n(32);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==r(e)?e.split(""):Object(e)}},function(e,t,n){var r=n(55),i=n(38).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return r(e,i)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.constantBB=t.constantRtc=t.constantTool=void 0;var r,i,o,a,s=function(e){return e&&e.__esModule?e:{default:e}}(n(110));var c={HANGUP_TYPE_NORMAL:0,HANGUP_TYPE_TIMEOUT:-1},u={NETCALL_TYPE_AUDIO:1,NETCALL_TYPE_VIDEO:2,DEVICE_TYPE_AUDIO_IN:0,DEVICE_TYPE_AUDIO_OUT_LOCAL:1,DEVICE_TYPE_AUDIO_OUT_CHAT:2,DEVICE_TYPE_VIDEO:3,DEVICE_TYPE_DESKTOP_SCREEN:4,DEVICE_TYPE_DESKTOP_WINDOW:5,DEVICE_TYPE_DESKTOP_CHROME_SCREEN:6,DEVICE_TYPE_AUDIO_LOCAL:-2,DEVICE_TYPE_VIDEO_LOCAL:-1,CHAT_VIDEO_QUALITY_NORMAL:0,CHAT_VIDEO_QUALITY_LOW:1,CHAT_VIDEO_QUALITY_MEDIUM:2,CHAT_VIDEO_QUALITY_HIGH:3,CHAT_VIDEO_QUALITY_480P:4,CHAT_VIDEO_QUALITY_540P:5,CHAT_VIDEO_QUALITY_720P:6,CHAT_VIDEO_FRAME_RATE_NORMAL:0,CHAT_VIDEO_FRAME_RATE_5:1,CHAT_VIDEO_FRAME_RATE_10:2,CHAT_VIDEO_FRAME_RATE_15:3,CHAT_VIDEO_FRAME_RATE_20:4,CHAT_VIDEO_FRAME_RATE_25:5,LAYOUT_SPLITBOTTOMHORFLOATING:0,LAYOUT_SPLITTOPHORFLOATING:1,LAYOUT_SPLITLATTICETILE:2,LAYOUT_SPLITLATTICECUTTINGTILE:3,LAYOUT_SPLITCUSTOM:4,ROLE_PLAYER:0,ROLE_AUDIENCE:1};u.deviceTypeMap=(r={},(0,s.default)(r,u.DEVICE_TYPE_AUDIO_IN,"audioIn"),(0,s.default)(r,u.DEVICE_TYPE_AUDIO_OUT_CHAT,"audioOut"),(0,s.default)(r,u.DEVICE_TYPE_VIDEO,"video"),r),u.deviceTypeMap=(i={},(0,s.default)(i,u.DEVICE_TYPE_AUDIO_IN,"audioIn"),(0,s.default)(i,u.DEVICE_TYPE_AUDIO_OUT_LOCAL,"audioOut"),(0,s.default)(i,u.DEVICE_TYPE_AUDIO_OUT_CHAT,"audioOut"),(0,s.default)(i,u.DEVICE_TYPE_VIDEO,"video"),i),u.videoMap={frame:(o={},(0,s.default)(o,u.CHAT_VIDEO_QUALITY_NORMAL,"480x320"),(0,s.default)(o,u.CHAT_VIDEO_QUALITY_LOW,"176x144"),(0,s.default)(o,u.CHAT_VIDEO_QUALITY_MEDIUM,"352x288"),(0,s.default)(o,u.CHAT_VIDEO_QUALITY_HIGH,"480x320"),(0,s.default)(o,u.CHAT_VIDEO_QUALITY_480P,"640x480"),(0,s.default)(o,u.CHAT_VIDEO_QUALITY_540P,"960x540"),(0,s.default)(o,u.CHAT_VIDEO_QUALITY_720P,"1280x720"),o),frameRate:(a={},(0,s.default)(a,u.CHAT_VIDEO_FRAME_RATE_NORMAL,15),(0,s.default)(a,u.CHAT_VIDEO_FRAME_RATE_5,5),(0,s.default)(a,u.CHAT_VIDEO_FRAME_RATE_10,10),(0,s.default)(a,u.CHAT_VIDEO_FRAME_RATE_15,15),(0,s.default)(a,u.CHAT_VIDEO_FRAME_RATE_20,20),(0,s.default)(a,u.CHAT_VIDEO_FRAME_RATE_25,25),a)};var d={getVideoSessionConfig:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.quality,n=void 0===t?u.CHAT_VIDEO_QUALITY_NORMAL:t,r=e.frameRate,i=void 0===r?u.CHAT_VIDEO_FRAME_RATE_NORMAL:r,o={},a=u.videoMap.frame[n];return o.frameRate=u.videoMap.frameRate[i],o.width=+a.split("x")[0],o.height=+a.split("x")[1],o},getDeviceTypeStr:function(e){return u.deviceTypeMap[e]},getDeviceTypeMap:function(e){return u.deviceTypeMap[e]}},l=Object.assign(u,{NETCALL_CONTROL_COMMAND_NOTIFY_AUDIO_ON:1,NETCALL_CONTROL_COMMAND_NOTIFY_AUDIO_OFF:2,NETCALL_CONTROL_COMMAND_NOTIFY_VIDEO_ON:3,NETCALL_CONTROL_COMMAND_NOTIFY_VIDEO_OFF:4,NETCALL_CONTROL_COMMAND_SWITCH_AUDIO_TO_VIDEO:5,NETCALL_CONTROL_COMMAND_SWITCH_AUDIO_TO_VIDEO_AGREE:6,NETCALL_CONTROL_COMMAND_SWITCH_AUDIO_TO_VIDEO_REJECT:7,NETCALL_CONTROL_COMMAND_SWITCH_VIDEO_TO_AUDIO:8,NETCALL_CONTROL_COMMAND_BUSY:9,NETCALL_CONTROL_COMMAND_SELF_CAMERA_INVALID:10,NETCALL_CONTROL_COMMAND_SELF_AUDIO_INVALID:11,NETCALL_CONTROL_COMMAND_SELF_ON_BACKGROUND:12,NETCALL_CONTROL_COMMAND_START_NOTIFY_RECEIVED:13,NETCALL_CONTROL_COMMAND_NOTIFY_RECORD_START:14,NETCALL_CONTROL_COMMAND_NOTIFY_RECORD_STOP:15},c),p=Object.assign({WB_TYPE_TCP:2,WB_TYPE_UDP:3,CALL_TYPE_NONE:0,CALL_TYPE_AUDIO:1,HANGUP_TYPE_NORMAL:0,HANGUP_TYPE_TIMEOUT:-1},{CONTROL_COMMAND_BUSY:9,CONTROL_COMMAND_SELF_ON_BACKGROUND:12,CONTROL_COMMAND_START_NOTIFY_RECEIVED:13},c);t.constantTool=d,t.constantRtc=l,t.constantBB=p},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t,n){n(83);for(var r=n(1),i=n(9),o=n(17),a=n(2)("toStringTag"),s="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","),c=0;c<s.length;c++){var u=s[c],d=r[u],l=d&&d.prototype;l&&!l[a]&&i(l,a,u),o[u]=o.Array}},,,function(e,t,n){var r=n(33),i=Math.min;e.exports=function(e){return e>0?i(r(e),9007199254740991):0}},function(e,t,n){var r=n(24),i=n(21),o=n(12),a=n(35),s=n(7),c=n(53),u=Object.getOwnPropertyDescriptor;t.f=n(8)?u:function(e,t){if(e=o(e),t=a(t,!0),c)try{return u(e,t)}catch(e){}if(s(e,t))return i(!r.f.call(e,t),e[t])}},function(e,t,n){"use strict";t.__esModule=!0;var r=function(e){return e&&e.__esModule?e:{default:e}}(n(96));t.default=r.default||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}},,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(316);Object.defineProperty(t,"RtcUtil",{enumerable:!0,get:function(){return c(r).default}});var i=n(320);Object.defineProperty(t,"SdpUtil",{enumerable:!0,get:function(){return c(i).default}});var o=n(328);Object.defineProperty(t,"RtcStats",{enumerable:!0,get:function(){return c(o).default}});var a=n(329);Object.defineProperty(t,"RtcStatsNew",{enumerable:!0,get:function(){return c(a).default}});var s=n(206);function c(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"RtcSupport",{enumerable:!0,get:function(){return c(s).default}})},function(e,t,n){"use strict";var r=!0,i=!0,o={disableLog:function(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(r=e,e?"adapter.js logging disabled":"adapter.js logging enabled")},disableWarnings:function(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(i=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))},log:function(){if("object"==typeof window){if(r)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}},deprecated:function(e,t){i&&console.warn(e+" is deprecated, please use "+t+" instead.")},extractVersion:function(e,t,n){var r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)},detectBrowser:function(e){var t=e&&e.navigator,n={browser:null,version:null};if(void 0===e||!e.navigator)return n.browser="Not a browser.",n;if(t.mozGetUserMedia)n.browser="firefox",n.version=this.extractVersion(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia)if(e.webkitRTCPeerConnection)n.browser="chrome",n.version=this.extractVersion(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!t.userAgent.match(/Version\/(\d+).(\d+)/))return n.browser="Unsupported webkit-based browser with GUM support but no WebRTC support.",n;n.browser="safari",n.version=this.extractVersion(t.userAgent,/AppleWebKit\/(\d+)\./,1)}else if(t.mediaDevices&&t.userAgent.match(/Edge\/(\d+).(\d+)$/))n.browser="edge",n.version=this.extractVersion(t.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!t.mediaDevices||!t.userAgent.match(/AppleWebKit\/(\d+)\./))return n.browser="Not a supported browser.",n;n.browser="safari",n.version=this.extractVersion(t.userAgent,/AppleWebKit\/(\d+)\./,1)}return n}};e.exports={log:o.log,deprecated:o.deprecated,disableLog:o.disableLog,disableWarnings:o.disableWarnings,extractVersion:o.extractVersion,shimCreateObjectURL:o.shimCreateObjectURL,detectBrowser:o.detectBrowser.bind(o)}},function(e,t,n){var r=n(1).document;e.exports=r&&r.documentElement},function(e,t){},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i,o=function(e){return e&&e.__esModule?e:{default:e}}(n(110));var a={CURRENT:{SDK_TYPE:null},SDK_TYPE:{NETCALL:1,WEBRTC:2,WHITEBOARD:3,NRTC:4},SDK_NAME:{1:"Netcall",2:"WebRTC",3:"WhiteBoard",4:"NRTC"}};a.STATS_FUN=(r={},(0,o.default)(r,a.SDK_TYPE.NETCALL,1),(0,o.default)(r,a.SDK_TYPE.WEBRTC,1),(0,o.default)(r,a.SDK_TYPE.NRTC,1),(0,o.default)(r,a.SDK_TYPE.WHITEBOARD,0),r),a.STATS_RTC=(i={},(0,o.default)(i,a.SDK_TYPE.WEBRTC,1),(0,o.default)(i,a.SDK_TYPE.NRTC,1),(0,o.default)(i,a.SDK_TYPE.WHITEBOARD,0),i),t.default=a,e.exports=t.default},,function(e,t,n){e.exports={default:n(76),__esModule:!0}},function(e,t,n){n(51),n(60),e.exports=n(39).f("iterator")},function(e,t,n){var r=n(33),i=n(34);e.exports=function(e){return function(t,n){var o,a,s=String(i(t)),c=r(n),u=s.length;return c<0||c>=u?e?"":void 0:(o=s.charCodeAt(c))<55296||o>56319||c+1===u||(a=s.charCodeAt(c+1))<56320||a>57343?e?s.charAt(c):o:e?s.slice(c,c+2):a-56320+(o-55296<<10)+65536}}},function(e,t,n){"use strict";var r=n(45),i=n(21),o=n(31),a={};n(9)(a,n(2)("iterator"),function(){return this}),e.exports=function(e,t,n){e.prototype=r(a,{next:i(1,n)}),o(e,t+" Iterator")}},function(e,t,n){var r=n(6),i=n(10),o=n(22);e.exports=n(8)?Object.defineProperties:function(e,t){i(e);for(var n,a=o(t),s=a.length,c=0;s>c;)r.f(e,n=a[c++],t[n]);return e}},function(e,t,n){var r=n(12),i=n(63),o=n(81);e.exports=function(e){return function(t,n,a){var s,c=r(t),u=i(c.length),d=o(a,u);if(e&&n!=n){for(;u>d;)if((s=c[d++])!=s)return!0}else for(;u>d;d++)if((e||d in c)&&c[d]===n)return e||d||0;return!e&&-1}}},function(e,t,n){var r=n(33),i=Math.max,o=Math.min;e.exports=function(e,t){return(e=r(e))<0?i(e+t,0):o(e,t)}},function(e,t,n){var r=n(7),i=n(48),o=n(36)("IE_PROTO"),a=Object.prototype;e.exports=Object.getPrototypeOf||function(e){return e=i(e),r(e,o)?e[o]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?a:null}},function(e,t,n){"use strict";var r=n(84),i=n(85),o=n(17),a=n(12);e.exports=n(52)(Array,"Array",function(e,t){this._t=a(e),this._i=0,this._k=t},function(){var e=this._t,t=this._k,n=this._i++;return!e||n>=e.length?(this._t=void 0,i(1)):i(0,"keys"==t?n:"values"==t?e[n]:[n,e[n]])},"values"),o.Arguments=o.Array,r("keys"),r("values"),r("entries")},function(e,t){e.exports=function(){}},function(e,t){e.exports=function(e,t){return{value:t,done:!!e}}},function(e,t,n){e.exports={default:n(87),__esModule:!0}},function(e,t,n){n(88),n(71),n(93),n(94),e.exports=n(4).Symbol},function(e,t,n){"use strict";var r=n(1),i=n(7),o=n(8),a=n(13),s=n(54),c=n(89).KEY,u=n(15),d=n(37),l=n(31),p=n(23),f=n(2),h=n(39),m=n(40),v=n(90),g=n(91),y=n(10),S=n(11),b=n(12),C=n(35),_=n(21),T=n(45),R=n(92),w=n(64),k=n(6),E=n(22),P=w.f,O=k.f,I=R.f,A=r.Symbol,x=r.JSON,M=x&&x.stringify,D=f("_hidden"),L=f("toPrimitive"),j={}.propertyIsEnumerable,N=d("symbol-registry"),V=d("symbols"),U=d("op-symbols"),F=Object.prototype,B="function"==typeof A,H=r.QObject,G=!H||!H.prototype||!H.prototype.findChild,W=o&&u(function(){return 7!=T(O({},"a",{get:function(){return O(this,"a",{value:7}).a}})).a})?function(e,t,n){var r=P(F,t);r&&delete F[t],O(e,t,n),r&&e!==F&&O(F,t,r)}:O,Y=function(e){var t=V[e]=T(A.prototype);return t._k=e,t},z=B&&"symbol"==typeof A.iterator?function(e){return"symbol"==typeof e}:function(e){return e instanceof A},K=function(e,t,n){return e===F&&K(U,t,n),y(e),t=C(t,!0),y(n),i(V,t)?(n.enumerable?(i(e,D)&&e[D][t]&&(e[D][t]=!1),n=T(n,{enumerable:_(0,!1)})):(i(e,D)||O(e,D,_(1,{})),e[D][t]=!0),W(e,t,n)):O(e,t,n)},J=function(e,t){y(e);for(var n,r=v(t=b(t)),i=0,o=r.length;o>i;)K(e,n=r[i++],t[n]);return e},Q=function(e){var t=j.call(this,e=C(e,!0));return!(this===F&&i(V,e)&&!i(U,e))&&(!(t||!i(this,e)||!i(V,e)||i(this,D)&&this[D][e])||t)},q=function(e,t){if(e=b(e),t=C(t,!0),e!==F||!i(V,t)||i(U,t)){var n=P(e,t);return!n||!i(V,t)||i(e,D)&&e[D][t]||(n.enumerable=!0),n}},$=function(e){for(var t,n=I(b(e)),r=[],o=0;n.length>o;)i(V,t=n[o++])||t==D||t==c||r.push(t);return r},X=function(e){for(var t,n=e===F,r=I(n?U:b(e)),o=[],a=0;r.length>a;)!i(V,t=r[a++])||n&&!i(F,t)||o.push(V[t]);return o};B||(s((A=function(){if(this instanceof A)throw TypeError("Symbol is not a constructor!");var e=p(arguments.length>0?arguments[0]:void 0),t=function(n){this===F&&t.call(U,n),i(this,D)&&i(this[D],e)&&(this[D][e]=!1),W(this,e,_(1,n))};return o&&G&&W(F,e,{configurable:!0,set:t}),Y(e)}).prototype,"toString",function(){return this._k}),w.f=q,k.f=K,n(57).f=R.f=$,n(24).f=Q,n(41).f=X,o&&!n(20)&&s(F,"propertyIsEnumerable",Q,!0),h.f=function(e){return Y(f(e))}),a(a.G+a.W+a.F*!B,{Symbol:A});for(var Z="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),ee=0;Z.length>ee;)f(Z[ee++]);for(var te=E(f.store),ne=0;te.length>ne;)m(te[ne++]);a(a.S+a.F*!B,"Symbol",{for:function(e){return i(N,e+="")?N[e]:N[e]=A(e)},keyFor:function(e){if(!z(e))throw TypeError(e+" is not a symbol!");for(var t in N)if(N[t]===e)return t},useSetter:function(){G=!0},useSimple:function(){G=!1}}),a(a.S+a.F*!B,"Object",{create:function(e,t){return void 0===t?T(e):J(T(e),t)},defineProperty:K,defineProperties:J,getOwnPropertyDescriptor:q,getOwnPropertyNames:$,getOwnPropertySymbols:X}),x&&a(a.S+a.F*(!B||u(function(){var e=A();return"[null]"!=M([e])||"{}"!=M({a:e})||"{}"!=M(Object(e))})),"JSON",{stringify:function(e){for(var t,n,r=[e],i=1;arguments.length>i;)r.push(arguments[i++]);if(n=t=r[1],(S(t)||void 0!==e)&&!z(e))return g(t)||(t=function(e,t){if("function"==typeof n&&(t=n.call(this,e,t)),!z(t))return t}),r[1]=t,M.apply(x,r)}}),A.prototype[L]||n(9)(A.prototype,L,A.prototype.valueOf),l(A,"Symbol"),l(Math,"Math",!0),l(r.JSON,"JSON",!0)},function(e,t,n){var r=n(23)("meta"),i=n(11),o=n(7),a=n(6).f,s=0,c=Object.isExtensible||function(){return!0},u=!n(15)(function(){return c(Object.preventExtensions({}))}),d=function(e){a(e,r,{value:{i:"O"+ ++s,w:{}}})},l=e.exports={KEY:r,NEED:!1,fastKey:function(e,t){if(!i(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!o(e,r)){if(!c(e))return"F";if(!t)return"E";d(e)}return e[r].i},getWeak:function(e,t){if(!o(e,r)){if(!c(e))return!0;if(!t)return!1;d(e)}return e[r].w},onFreeze:function(e){return u&&l.NEED&&c(e)&&!o(e,r)&&d(e),e}}},function(e,t,n){var r=n(22),i=n(41),o=n(24);e.exports=function(e){var t=r(e),n=i.f;if(n)for(var a,s=n(e),c=o.f,u=0;s.length>u;)c.call(e,a=s[u++])&&t.push(a);return t}},function(e,t,n){var r=n(32);e.exports=Array.isArray||function(e){return"Array"==r(e)}},function(e,t,n){var r=n(12),i=n(57).f,o={}.toString,a="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.f=function(e){return a&&"[object Window]"==o.call(e)?function(e){try{return i(e)}catch(e){return a.slice()}}(e):i(r(e))}},function(e,t,n){n(40)("asyncIterator")},function(e,t,n){n(40)("observable")},,function(e,t,n){e.exports={default:n(97),__esModule:!0}},function(e,t,n){n(98),e.exports=n(4).Object.assign},function(e,t,n){var r=n(13);r(r.S+r.F,"Object",{assign:n(99)})},function(e,t,n){"use strict";var r=n(22),i=n(41),o=n(24),a=n(48),s=n(56),c=Object.assign;e.exports=!c||n(15)(function(){var e={},t={},n=Symbol(),r="abcdefghijklmnopqrst";return e[n]=7,r.split("").forEach(function(e){t[e]=e}),7!=c({},e)[n]||Object.keys(c({},t)).join("")!=r})?function(e,t){for(var n=a(e),c=arguments.length,u=1,d=i.f,l=o.f;c>u;)for(var p,f=s(arguments[u++]),h=d?r(f).concat(d(f)):r(f),m=h.length,v=0;m>v;)l.call(f,p=h[v++])&&(n[p]=f[p]);return n}:c},,,,,,function(e,t,n){var r=n(32),i=n(2)("toStringTag"),o="Arguments"==r(function(){return arguments}());e.exports=function(e){var t,n,a;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),i))?n:o?r(t):"Object"==(a=r(t))&&"function"==typeof t.callee?"Arguments":a}},,,function(e,t,n){e.exports={default:n(148),__esModule:!0}},,function(e,t,n){"use strict";t.__esModule=!0;var r=function(e){return e&&e.__esModule?e:{default:e}}(n(108));t.default=function(e,t,n){return t in e?(0,r.default)(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},function(e,t,n){var r=n(105),i=n(2)("iterator"),o=n(17);e.exports=n(4).getIteratorMethod=function(e){if(void 0!=e)return e[i]||e["@@iterator"]||o[r(e)]}},,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){return e&&e.__esModule?e:{default:e}}(n(14)),i=n(42);var o=n(3).info.nrtcVersion,a=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,r.default)(this,e);var n=t.appkey,i=t.platform;this.apis={},this.isRtc=/WebRTC/.test(i),this.init(n,i),this.resetStatus()};t.default=a;var s=a.prototype;s.init=function(e,t){this.apis=Object.assign(this.apis,{ver:2,platform:t,sdk_ver:o||"v4.4.0",uid:null,appkey:e,time:null})},s.start=function(e){this.calling=!0,this.apis=Object.assign(this.apis,e)},s.resetStatus=function(){this.calling=!1,this.apis=Object.assign(this.apis,{p2p:{value:0},meeting:{value:0},bypass:{value:0},call_control_type:{value:0},self_mute:{value:-1},self_mic_mute:{value:-1},switch_p2p_type:{value:0},set_speaker:{value:-1},net_detect:{value:this.isRtc?-1:0},beautify:{value:-1},water_mark:{value:-1},audio_samples:{value:-1},video_samples:{value:-1},pre_view_mirror:{value:-1},code_mirror:{value:-1},custom_audio:{value:-1},custom_video:{value:-1},audio_mix:{value:-1},snap_shot:{value:-1},record:{value:0},audio_record:{value:0},display:{value:0},android_compatibility:{value:-1},hd_audio:{value:0},video_quality:{value:0},fps:{value:0},prefered_video_encoder:{value:-1},prefered_video_decoder:{value:-1},video_max_encode_bitrate:{value:this.isRtc?-1:0},audio_scene:{value:-1},video_adaptive_strategy:{value:this.isRtc?-1:0},ans:{value:this.isRtc?-1:0},agc:{value:-1},dtx:{value:-1},aec:{value:this.isRtc?-1:0},awc:{value:this.isRtc?-1:0},video_crop:{value:0},set_all_user_audio_mute:{value:0},server_record_audio:{value:0},server_record_video:{value:0},server_record_single_user:{value:0},always_keep_calling:{value:0},actor:{value:0},pure_video:{value:-1},screen_sharing_module:{value:0}})},s.update=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments[1],n=e.key,r=e.ext;e.constructor===String&&(n=e),r=r||t,this.apis[n]&&(this.apis[n].value=1,void 0!==r&&(this.apis[n].ext=r),/(p2p|meeting)/.test(n)&&(this.calling=!0))},s.send=function(){var e=this;this.calling&&(this.calling=!1,this.apis.time=Date.now(),(0,i.ajax)({type:"post",url:"https://statistic.live.126.net/statistic/realtime/sdkFunctioninfo",data:this.apis}).then(function(t){e.resetStatus()}).catch(function(t){console.log("err",t),e.resetStatus()}))},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(150);Object.defineProperty(t,"Device",{enumerable:!0,get:function(){return s(r).default}});var i=n(314);Object.defineProperty(t,"MDevices",{enumerable:!0,get:function(){return s(i).default}});var o=n(315);Object.defineProperty(t,"Recorder",{enumerable:!0,get:function(){return s(o).default}});var a=n(331);function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"MStream",{enumerable:!0,get:function(){return s(a).default}})},function(e,t,n){e.exports=n(300)},function(e,t,n){"use strict";t.__esModule=!0;var r=function(e){return e&&e.__esModule?e:{default:e}}(n(302));t.default=function(e){return function(){var t=e.apply(this,arguments);return new r.default(function(e,n){return function i(o,a){try{var s=t[o](a),c=s.value}catch(e){return void n(e)}if(!s.done)return r.default.resolve(c).then(function(e){i("next",e)},function(e){i("throw",e)});e(c)}("next")})}}},,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(!e.url||!e.data)return Promise.reject("参数不完整，无法发起请求");e.dataType=e.dataType||"json";var t=new XMLHttpRequest;return t.open(e.type||"GET",e.url,!0),t.responseType=""+e.dataType,t.setRequestHeader("Content-type","application/json;charset=UTF-8"),e.header&&Object.keys(e.header).map(function(n){t.setRequestHeader(n,e.header[n])}),new Promise(function(n,r){t.onload=function(){var e=t.response;n(e)},t.onerror=function(e){r(e)},t.send(JSON.stringify(e.data))})};e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={merge:function(){var e=arguments;return e[0]=Object.assign.apply(Object.assign,arguments),e[0]},verifyOptions:function(){var e=arguments;if(e[0]&&e[0].constructor===Object)for(var t=1;t<arguments.length;t++){var n=e[t];(n=n.split(" ")).map(function(t){if(!e[0][t])throw Error("参数缺失 "+t)})}},guid:function(){var e=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return function(){return e()+e()+e()+e()+e()+e()+e()+e()}}()},e.exports=t.default},,,,,,function(e,t,n){var r=n(10);e.exports=function(e,t,n,i){try{return i?t(r(n)[0],n[1]):t(n)}catch(t){var o=e.return;throw void 0!==o&&r(o.call(e)),t}}},function(e,t,n){var r=n(17),i=n(2)("iterator"),o=Array.prototype;e.exports=function(e){return void 0!==e&&(r.Array===e||o[i]===e)}},function(e,t,n){var r=n(2)("iterator"),i=!1;try{var o=[7][r]();o.return=function(){i=!0},Array.from(o,function(){throw 2})}catch(e){}e.exports=function(e,t){if(!t&&!i)return!1;var n=!1;try{var o=[7],a=o[r]();a.next=function(){return{done:n=!0}},o[r]=function(){return a},e(o)}catch(e){}return n}},,,function(e,t,n){"use strict";var r=n(26),i=n(16),o=r.getGlobal();function a(e,t){for(var n in t)e[n]=t[n];return e}o.Object.assign||(console.log("Object.assign polyfill"),o.Object.assign=function(){for(var e=arguments,t=1;t<e.length;t++)e[0]=a(e[0],e[t]);return e[0]}),o.platform=i},function(e,t,n){e.exports={default:n(141),__esModule:!0}},function(e,t,n){n(142),e.exports=n(4).Object.setPrototypeOf},function(e,t,n){var r=n(13);r(r.S,"Object",{setPrototypeOf:n(143).set})},function(e,t,n){var r=n(11),i=n(10),o=function(e,t){if(i(e),!r(t)&&null!==t)throw TypeError(t+": can't set as prototype!")};e.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(e,t,r){try{(r=n(43)(Function.call,n(64).f(Object.prototype,"__proto__").set,2))(e,[]),t=!(e instanceof Array)}catch(e){t=!0}return function(e,n){return o(e,n),t?e.__proto__=n:r(e,n),e}}({},!1):void 0),check:o}},function(e,t,n){e.exports={default:n(145),__esModule:!0}},function(e,t,n){n(146);var r=n(4).Object;e.exports=function(e,t){return r.create(e,t)}},function(e,t,n){var r=n(13);r(r.S,"Object",{create:n(45)})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={html2node:function(e){var t=document.createElement("div");t.innerHTML=e;var n,r,i=[];if(t.children)for(n=0,r=t.children.length;n<r;n++)i.push(t.children[n]);else for(n=0,r=t.childNodes.length;n<r;n++){var o=t.childNodes[n];1===o.nodeType&&i.push(o)}return i.length>1?t:i[0]},n2node:function(e){return e?/HTML.+Element/gi.test(e)?e:e[0]&&/HTML.+Element/gi.test(e[0])?e[0]:null:null}},e.exports=t.default},function(e,t,n){n(149);var r=n(4).Object;e.exports=function(e,t,n){return r.defineProperty(e,t,n)}},function(e,t,n){var r=n(13);r(r.S+r.F*!n(8),"Object",{defineProperty:n(6).f})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o(n(118)),i=o(n(119));function o(e){return e&&e.__esModule?e:{default:e}}t.default={getDevices:function(){var e=this;return(0,i.default)(r.default.mark(function t(){var n;return r.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("开始获取设备列表"),n=null,navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices){e.next=4;break}return e.abrupt("return",Promise.reject("your browser not support this feature, see https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/enumerateDevices"));case 4:return e.next=6,navigator.mediaDevices.enumerateDevices().then(function(e){0!==e.length&&(n={video:[],audioIn:[],audioOut:[]},e.forEach(function(e){"videoinput"===e.kind?n.video.push({deviceId:e.deviceId,label:e.label?e.label:"camera "+(n.video.length+1)}):"audioinput"===e.kind?n.audioIn.push({deviceId:e.deviceId,label:e.label?e.label:"microphone "+(n.audioIn.length+1)}):"audiooutput"===e.kind&&n.audioOut.push({deviceId:e.deviceId,label:e.label?e.label:"speaker "+(n.audioOut.length+1)})}))});case 6:return e.abrupt("return",n);case 7:case"end":return e.stop()}},t,e)}))()}},e.exports=t.default},function(e,t,n){"use strict";var r=n(59);e.exports.f=function(e){return new function(e){var t,n;this.promise=new e(function(e,r){if(void 0!==t||void 0!==n)throw TypeError("Bad Promise constructor");t=e,n=r}),this.resolve=r(t),this.reject=r(n)}(e)}},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a(n(116)),i=a(n(197)),o=a(n(198));function a(e){return e&&e.__esModule?e:{default:e}}t.default={DataApi:function(e){return new r.default(e)},DataRtc:function(e){return new i.default(e)},DataStats:function(e){return new o.default(e)}},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=c(n(14)),i=c(n(27)),o=c(n(28)),a=c(n(73)),s=n(155);function c(e){return e&&e.__esModule?e:{default:e}}var u=n(25),d=n(16),l=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,r.default)(this,t);var n=(0,i.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.info=Object.assign({},e),n.init(),n.logger=e.logger||window.console,n.autoReconnect=e.autoReconnect||!0,n.isDestroy=!1,n.reConnectCount=0,n.wssUrl=null,n}return(0,o.default)(t,e),t}(u),p=l.prototype;p.init=function(){this.reset()},p.reset=function(){this.imInfo={}},p.connect=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.url,r=void 0===n?this.wssUrl:n,i=t.imInfo;return this.imInfo=i||this.imInfo,r?new Promise(function(t,n){e.url=r;var i=void 0;try{i=e.ws=new WebSocket("wss://"+r);var o=e;i.onopen=function(n){e.wssUrl=r,o.initSignal(),o.signalConnected=!0,console.log("signalConnected",r),o.emit("signalConnected"),t(o),e.heartbeat()},i.onclose=i.onerror=function(e){o.signalConnected=!1,n(e)}}catch(t){e.logger.error("信令连接建立失败",t),n(t)}}):Promise.reject("信令地址缺失")},p.initSignal=function(){var e=this,t=this.ws,n=t.send;t.send=function(e){n.call(this,JSON.stringify(e))},t.onmessage=function(t){var n=JSON.parse(t.data||null);n&&(!e.isHeartBeating||"keep_alive_ack"!==n.type&&n.type!==s.serializeWb.gateWay.keep_alive_ack?e.emit("message",n):e.onHeartBeat(n))},t.onclose=function(t){e.signalConnected=!1,e.emit("signalTimeout",t)},t.onerror=function(t){e.signalConnected=!1,e.emit("signalTimeout",event)}},p.send=function(e){var t=this;e.type,this.ws&&this.signalConnected&&this.ws.readyState===this.ws.OPEN?(e.browser={},e.browser.name=d.name,e.browser.version=d.version,this.ws.send(e)):this.once("signalConnected",function(){t.send(e)})},p.heartbeat=function(){this.socketData=this.socketData||{uid:this.imInfo.uid,cid:this.imInfo.cid},this.heartBeatList=[],this.bindHearBeat(5)},p.onHeartBeat=function(e){this.heartBeatList.shift(),this.bindHearBeat(5)},p.heartBeatHandler=function(){var e=this.socketData,t=this.heartBeatList;if(t){var n=Date.now(),r=n;if(a.default.CURRENT.SDK_TYPE===a.default.SDK_TYPE.WHITEBOARD&&(r=+n.toString().slice(0,-3)),t.constructor===Array&&0===t.length){t.push(n);var i=this.getContentData({type:"keep_alive",uid:a.default.CURRENT.SDK_TYPE===a.default.SDK_TYPE.WHITEBOARD?+e.uid:e.uid+"",cid:a.default.CURRENT.SDK_TYPE===a.default.SDK_TYPE.WHITEBOARD?+e.cid:e.cid+""},r);return this.send(i),void this.bindHearBeat(5)}var o=Date.now()-t[0];if(o>3e4)this.logger.error("socket error: heartbeat timeout"),this.emit("signalTimeout");else if(o>2e3&&o<3e4){this.logger.warn("socket error: no response, keep heartbeat"),t.push(n);var s=this.getContentData({type:"keep_alive",uid:e.uid,cid:e.cid},r);this.send(s),this.bindHearBeat(2)}}},p.getContentData=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments[1];return a.default.CURRENT.SDK_TYPE===a.default.SDK_TYPE.WHITEBOARD?(e.version=31,e.type=s.serializeWb.gateWay[e.type],e.content={params:{timestamp:+t}}):e.params={content:{timestamp:t+""}},e},p.bindHearBeat=function(e){this.isHeartBeating&&clearTimeout(this.isHeartBeating),this.isHeartBeating=setTimeout(this.heartBeatHandler.bind(this),1e3*e)},p.stopHeartBeat=function(){this.isHeartBeating&&(this.isHeartBeating&&clearTimeout(this.isHeartBeating),this.heartBeatTimer&&clearInterval(this.heartBeatTimer),this.isHeartBeating=null,this.heartBeatTimer=null,this.heartBeatList=null,this.heartBeatCount=0)},p.logout=function(){var e=this.socketData,t=Date.now().toString(),n=this.getContentData({type:"logout",uid:e.uid,cid:e.cid},t);this.send(n)},p.destroy=function(){this.logger.log("signal close -> signal.js"),this.stopHeartBeat(),this.isDestroy=!0,this.ws&&(this.ws.onopen=null,this.ws.onmessage=null,this.ws.onerror=null,this.ws.onclose=null,this.ws.readyState===WebSocket.OPEN&&this.ws.close(),this.ws=null)},t.default=l,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.serializeWb={gateWay:{login:1,loginAck:2,join:3,keep_alive:4,keep_alive_ack:5,keep_alive_node:6,broadcast:7,toUser:8,logout:9}},t.unserializeWb={gateWay:{1:"login",2:"loginAck",3:"join",4:"keep_alive",5:"keep_alive_ack",6:"keep_alive_node",7:"broadcast",8:"toUser",9:"logout"}}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=e.util;return r=t.notundef,i};var r=void 0;function i(e){r(e.enable)&&(this.enable=e.enable?1:0),r(e.needBadge)&&(this.needBadge=e.needBadge?1:0),r(e.needPushNick)&&(this.needPushNick=e.needPushNick?1:0),r(e.pushContent)&&(this.pushContent=""+e.pushContent),r(e.custom)&&(this.custom=""+e.custom),r(e.pushPayload)&&(this.pushPayload=""+e.pushPayload),r(e.sound)&&(this.sound=""+e.sound),r(e.webrtcEnable)&&(this.webrtcEnable=e.webrtcEnable?1:0),r(e.forceKeepCalling)&&(this.forceKeepCalling=e.forceKeepCalling?1:0)}e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){return e&&e.__esModule?e:{default:e}}(n(14)),i=n(42);var o=n(3).info.nrtcVersion,a=n(16),s=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,r.default)(this,e);var n=t.appkey;this.infos={},this.userlist=[],this.localVolumn=0,this.local={},this.remote={},this.init(n),this.resetStatus()};t.default=s;var c=s.prototype;c.init=function(e){this.infos=Object.assign(this.infos,{ver:2,device:-1,isp:-1,platform:u.convertPlatform(a.os.family)+"-"+a.os.version,browser:a.name+"-"+a.version,sdk_ver:o||"3.6.0",appkey:e,interval:60,samples:30,time:null,qos_algorithm:-1,fec_algorithm:-1,qos_scene:-1,qos_strategy:-1})},c.resetStatus=function(){this.infos=Object.assign(this.infos,{uid:null,cid:null,push_url:null,turn_ip:null,proxy_ip:null,meeting:!1,live:!1}),this.clearInfoData(),this.uidSsrcMap={},this.userlist=[]},c.initInfoData=function(e){var t={uid:e,cid:this.imInfo&&this.imInfo.cid||-1,push_url:this.sessionConfig&&this.sessionConfig.rtmpUrl||-1,turn_ip:this.imInfo&&this.imInfo.turnMap||-1,proxy_ip:this.imInfo&&this.imInfo.turnMap||-1,meeting:/^meeting$/gi.test(this.imInfo.sessionMode),live:this.sessionConfig&&this.sessionConfig.liveEnable||!1,p2p:!1,isp:-1,net:-1,connect_state:this.imInfo&&this.imInfo.code||200,signalling_time:(this.sessionConfig&&this.sessionConfig.signalEndTime||0)-(this.sessionConfig&&this.sessionConfig.signalStartTime||0),connect_time:(this.sessionConfig&&this.sessionConfig.rtcEndTime||0)-(this.sessionConfig&&this.sessionConfig.rtcStartTime||0)};this.infos=Object.assign(this.infos,t)},c.clearInfoData=function(){this.localVolumn=0,this.infos=Object.assign(this.infos,{rx:{audio:[],video:[]},tx:{a_lost:[],v_lost:[],rtt:[],rtt_mdev:[],set_v_fps:[],qos_v_fps:[],v_fps:[],set_v_quality:[],real_v_res:[],real_v_kbps:[],real_v_kbps_n:[],real_a_kbps:[],real_a_kbps_n:[],set_v_kbps:[],qos_v_kbps:[],tx_bw_kbps:[],a_volume:[]}})},c.start=function(e){var t=e.info,n=e.imInfo,r=e.sessionConfig,i=e.videoConfig;n&&(this.infos.appkey=t.appKey||this.infos.appkey,this.imInfo=n||{},this.infos.cid=this.imInfo.cid,this.infos.uid=this.imInfo.uid,this.sessionConfig=r||{},this.videoConfig=i||{},this.clearSecond(),this.getTurnMap(),this.initInfoData(this.infos.uid))},c.stop=function(){this.statsTimer&&(clearInterval(this.statsTimer),this.statsTimer=null,this.resetStatus())},c.clearSecond=function(){this.paramSecond={packetsLostAudio:"",packetsLostAudioList:[],packetsSentPerSecondAudio:[],packetsLostVideo:"",packetsLostVideoList:[],packetsSentPerSecondVideo:[],googInterframeDelayMaxList:[],vrdolr:"",vrdohr:""}},c.update=function(e,t){var n=[],r=[],i=[],o=[];for(var a in e)-1!==a.indexOf("_send_")&&-1!==a.indexOf("_audio")?n.push(e[a]):-1!==a.indexOf("_send_")&&-1!==a.indexOf("_video")?r.push(e[a]):-1!==a.indexOf("_recv_")&&-1!==a.indexOf("_audio")?i.push(e[a]):-1!==a.indexOf("_recv_")&&-1!==a.indexOf("_video")?o.push(e[a]):this.network=e[a]&&e[a].network;if(3===this.paramSecond.packetsLostAudioList.length&&this.paramSecond.packetsLostAudioList.shift(),3===this.paramSecond.packetsLostVideoList.length&&this.paramSecond.packetsLostVideoList.shift(),3===this.paramSecond.packetsSentPerSecondAudio.length&&this.paramSecond.packetsSentPerSecondAudio.shift(),3===this.paramSecond.packetsSentPerSecondVideo.length&&this.paramSecond.packetsSentPerSecondVideo.shift(),3===this.paramSecond.googInterframeDelayMaxList.length&&this.paramSecond.googInterframeDelayMaxList.shift(),this.paramSecond.packetsLostAudioList.push(parseFloat(n[0]&&n[0].packetsLost||0)),this.paramSecond.packetsLostVideoList.push(parseFloat(r[0]&&r[0].packetsLost||0)),this.paramSecond.packetsSentPerSecondAudio.push(parseFloat(n[0]&&n[0].packetsSentPerSecond||0)),this.paramSecond.packetsSentPerSecondVideo.push(parseFloat(r[0]&&r[0].packetsSentPerSecond||0)),this.paramSecond.googInterframeDelayMaxList.push(parseFloat(o[0]&&o[0].googInterframeDelayMax||0)),1!==t){if(2===t){this.paramSecond.packetsLostAudio=(this.paramSecond.packetsLostAudioList[1]-this.paramSecond.packetsLostAudioList[0])/(this.paramSecond.packetsSentPerSecondAudio[0]+this.paramSecond.packetsSentPerSecondAudio[1])/2*100,this.paramSecond.packetsLostVideo=(this.paramSecond.packetsLostVideoList[1]-this.paramSecond.packetsLostVideoList[0])/(this.paramSecond.packetsSentPerSecondVideo[0]+this.paramSecond.packetsSentPerSecondVideo[1])/2*100;var s=0,c=0,u=0,d=0;this.paramSecond.googInterframeDelayMaxList[0]>200&&this.paramSecond.googInterframeDelayMaxList[0]<400&&(s=this.paramSecond.googInterframeDelayMaxList[0]/2e3),this.paramSecond.googInterframeDelayMaxList[1]>200&&this.paramSecond.googInterframeDelayMaxList[1]<400&&(c=this.paramSecond.googInterframeDelayMaxList[1]/2e3),this.paramSecond.googInterframeDelayMaxList[0]>400&&(u=this.paramSecond.googInterframeDelayMaxList[0]/2e3),this.paramSecond.googInterframeDelayMaxList[1]>400&&(d=this.paramSecond.googInterframeDelayMaxList[0]/2e3),this.paramSecond.vrdolr=s+c,this.paramSecond.vrdohr=u+d}else if(t%2==1){this.paramSecond.packetsLostAudio=(this.paramSecond.packetsLostAudioList[2]-this.paramSecond.packetsLostAudioList[0])/(this.paramSecond.packetsSentPerSecondAudio[1]+this.paramSecond.packetsSentPerSecondAudio[2])/2*100||0,this.paramSecond.packetsLostVideo=(this.paramSecond.packetsLostVideoList[2]-this.paramSecond.packetsLostVideoList[0])/(this.paramSecond.packetsSentPerSecondVideo[1]+this.paramSecond.packetsSentPerSecondVideo[2])/2*100||0;var l=0,p=0,f=0,h=0;this.paramSecond.googInterframeDelayMaxList[1]>200&&this.paramSecond.googInterframeDelayMaxList[1]<400&&(l=this.paramSecond.googInterframeDelayMaxList[1]/2e3),this.paramSecond.googInterframeDelayMaxList[2]>200&&this.paramSecond.googInterframeDelayMaxList[2]<400&&(p=this.paramSecond.googInterframeDelayMaxList[2]/2e3),this.paramSecond.googInterframeDelayMaxList[1]>400&&(f=this.paramSecond.googInterframeDelayMaxList[1]/2e3),this.paramSecond.googInterframeDelayMaxList[2]>400&&(h=this.paramSecond.googInterframeDelayMaxList[2]/2e3),this.paramSecond.vrdolr=l+p,this.paramSecond.vrdohr=f+h}t%2==0&&(this.updateTxMediaInfo(n,r),this.updateRxMediaInfo(i,o),Object.keys(this.infos.rx.audio).length===this.infos.interval/2&&this.send())}},c.updateOnce=function(e){var t=e.imInfo,n=e.sessionConfig,r=e.rtcConnection;t&&(this.imInfo=t||{},this.sessionConfig=n||{},this.rtcConnection=r||{},this.videoConfig=e.videoConfig||{},this.getTurnMap(),this.initInfoData(),this.send())},c.updateLocalVolumn=function(e){this.localVolumn=e},c.updateRxMediaInfo=function(e,t){var n=this,r={u:[],g:[],c:[],bn:[],bc:[]},i={u:[],i:[],bn:[],bc:[],r:[],f:[],vrdolr:[],vrdohr:[]};e.map(function(e){r.u.push(parseFloat(e.id.split("_")[1])),r.g.push(-1),r.c.push(-1),r.bn.push(parseFloat((e.bitsReceivedPerSecond/1024).toFixed(1))||0),r.bc.push(-1)}),t.map(function(e){i.u.push(parseFloat(e.id.split("_")[1])),i.i.push(parseFloat(e.googInterframeDelayMax)),i.bn.push(parseFloat((e.bitsReceivedPerSecond/1024).toFixed(1))||0),i.bc.push(-1),i.r.push((e.googFrameWidthReceived||0)+"x"+(e.googFrameHeightReceived||0)),i.f.push(parseFloat(e.googFrameRateReceived)),i.vrdolr.push(n.paramSecond.vrdolr||-1),i.vrdohr.push(n.paramSecond.vrdohr||-1)}),this.infos.rx.audio.push(r),this.infos.rx.video.push(i)},c.getLocalMediaStats=function(e,t){return{a_lost:this.paramSecond.packetsLostAudio||0,v_lost:this.paramSecond.packetsLostVideo||0,rtt:parseFloat(e[0]&&e[0].googRtt||0)||0,rtt_mdev:-1,set_v_fps:this.videoConfig.frameRate||0,qos_v_fps:parseFloat(t[0]&&t[0].googFrameRateInput||0)||0,v_fps:parseFloat(t[0]&&t[0].googFrameRateSent||0)||0,set_v_quality:this.sessionConfig.videoQuality,real_v_res:(t[0]&&t[0].googFrameWidthSent||0)+"x"+(t[0]&&t[0].googFrameHeightSent||0),real_v_kbps:parseFloat(t[0]&&t[0].googEncodeUsagePercent||0)||0,real_v_kbps_n:parseFloat(((t[0]&&t[0].bitsSentPerSecond||0)/1024).toFixed(1))||0,real_a_kbps:-1,real_a_kbps_n:parseFloat(((e[0]&&e[0].bitsSentPerSecond||0)/1024).toFixed(1))||0,set_v_kbps:-1,qos_v_kbps:0,tx_bw_kbps:parseFloat(((t[0]&&t[0].bitsSentPerSecond||0)/1024).toFixed(1))||0,a_volume:parseFloat(this.localVolumn)||0}},c.updateTxMediaInfo=function(e,t){var n=this.getLocalMediaStats(e,t);for(var r in n)this.infos.tx[r].push(n[r]);var i=((navigator.connection||{}).type||"unknown").toString().toLowerCase();this.infos.net=u.convertNetwork(this.network||i)},c.getTurnMap=function(){if(this.imInfo){var e=this.imInfo;e.serverMap&&(e.serverMap.constructor===Object?e.turnMap=e.serverMap||null:e.turnMap=JSON.parse(e.serverMap||null),e.turnMap=e.turnMap&&e.turnMap.turnaddrs,e.turnMap=e.turnMap&&e.turnMap[0],e.turnMap=e.turnMap.constructor===Array?e.turnMap[0]:e.turnMap,e.turnMap=e.turnMap&&e.turnMap.match(/\d+\.\d+.\d+\.\d+/),e.turnMap=e.turnMap[0])}else console.warn("尚未连接网关，不统计")},c.send=function(){var e=this;this.infos.uid&&this.infos.cid&&(this.infos.time=Date.now(),this.infos.samples=this.infos.rx.audio.length,(0,i.ajax)({type:"post",url:"https://statistic.live.126.net/statistic/realtime/sdkinfo",data:this.infos}).then(function(t){e.clearInfoData()}).catch(function(t){e.clearInfoData()}))};var u={convertNetwork:function(e){return{wlan:"wifi",lan:"ethernet"}[e]||"unknown"},convertPlatform:function(e){var t=void 0;return t=/Windows/i.test(e)?"Win":e,t=/OS X/i.test(t)?"Mac":t}};e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a(n(14)),i=a(n(50)),o=n(42);function a(e){return e&&e.__esModule?e:{default:e}}var s=n(3).info.nrtcVersion,c=n(16),u=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,r.default)(this,e);var n=t.appkey;this.infos={},this.init(n),this.resetStatus()}return(0,i.default)(e,[{key:"resetStatus",value:function(){}},{key:"init",value:function(e){this.infos=Object.assign(this.infos,{interval:30,ver:2,platform:d.convertPlatform(c.os.family)+"-"+c.os.version,browser:c.name+"-"+c.version,sdk_ver:s||"3.6.0",uid:null,appkey:e,time:null,data:{}})}},{key:"clear",value:function(){this.infos.data={}}},{key:"start",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.infos.appkey=e.appKey||e.appkey||this.infos.appkey,this.infos.cid=e.cid,this.infos.uid=e.uid}},{key:"stop",value:function(){this.clear()}},{key:"update",value:function(e){this.infos.data["stat_"+Date.now()]=e,Object.keys(this.infos.data).length===this.infos.interval&&this.send()}},{key:"send",value:function(){var e=this;0!==Object.keys(this.infos.data).length&&(this.infos.time=Date.now(),(0,o.ajax)({type:"post",url:"//statistic.live.126.net/webrtc/stat",data:this.infos}).then(function(t){e.clear()}).catch(function(e){console.log("err",e)}))}}]),e}();t.default=u;var d={convertNetwork:function(e){return{wlan:"wifi",lan:"ethernet"}[e]||"unknown"},convertPlatform:function(e){var t=void 0;return t=/Windows/i.test(e)?"Win":e,t=/OS X/i.test(t)?"Mac":t}};e.exports=t.default},function(e,t,n){"use strict";var r=s(n(14)),i=s(n(27)),o=s(n(28)),a=n(42);function s(e){return e&&e.__esModule?e:{default:e}}var c=n(25),u=n(16),d=function(e){function t(e){(0,r.default)(this,t);var n=(0,i.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.container=a.element.n2node(e.container),e.remoteContainer=a.element.n2node(e.remoteContainer),a.tool.merge(n,e),n.init(),n}return(0,o.default)(t,e),t}(c),l=d.prototype;l.init=function(){var e=this;this.resetStatus(),/safari/gi.test(u.name)?window.addEventListener("pagehide",this.beforeunload.bind(this)):window.addEventListener("beforeunload",this.beforeunload.bind(this));var t=this.nim&&this.nim.logger||window.console;this.logger={log:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];e.debug&&t.log.apply(t,arguments)},error:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];e.debug&&t.error.apply(t,arguments)},warn:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];e.debug&&t.warn.apply(t,arguments)}}},l.resetStatus=function(){this.signalInited=!1,this.channelId=null,this.type=null,this.target={account:null,uid:null},this.sessionConfig={},this.sessionMode=null,this.imInfo={},this.calling=!1,this.isCaller=!1,this.callee=null,this.callAccepted=!1,this.callerInfo=null,this.beCalledInfo=null,this.nim&&(this.nim.protocol&&this.nim.protocol.setCurrentNetcall&&this.nim.protocol.setCurrentNetcall(),this.nim.protocol&&this.nim.protocol.setCurrentWhiteBoard&&this.nim.protocol.setCurrentWhiteBoard()),this.needQueryAccountMap={},this.accountUidMap={},this.uidAccountMap={},this.isOnHangup=!1},l.beforeunload=function(){this.signalInited&&(this.callerInfo||this.beCalledInfo?this.hangup():this.leaveChannel())},l.baseGetAccount=function(){return this.nim&&this.nim.account},l.baseGetUid=function(){return this.accountUidMap&&this.accountUidMap[this.nim.account]||"-1"},l.parseAccountUidMap=function(e){var t=this;Object.keys(e).forEach(function(n){t.addAccountUidMap({account:n,uid:e[n]})})},l.addAccountUidMap=function(e){var t=e.account,n=e.uid;this.uidAccountMap||(this.uidAccountMap={}),this.uidAccountMap[n]=t,this.accountUidMap||(this.accountUidMap={}),this.accountUidMap[t]=n},l.getAccountWithUid=function(e){if(this.uidAccountMap)return this.uidAccountMap[e]},l.getUidWithAccount=function(e){if(this.accountUidMap)return this.accountUidMap[e]},l.baseIsCurrentChannelId=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.channelId&&this.channelId===e.channelId},l.baseNotCurrentChannelId=function(e){return!this.baseIsCurrentChannelId(e)},l.baseResponse=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.fn||"calleeAck",r=t.beCalledInfo||this.beCalledInfo,i=r.accepted=!1!==t.accepted;return i?(this.sessionMode="p2p",this.type=r.type,this.channelId=r.channelId,this.target.account=r.account,this.calling=!0,this.imInfo=r,this.imInfo.sessionMode=this.sessionMode,this.imInfo.role=0,this.setSessionConfig({signalStartTime:Date.now()})):(this.logger.log("reject call",r),this.packNetcallRecord({type:r.type,channelId:r.channelId,isCaller:!1,target:r.account,recordType:"rejectNetcall"})),this.nim[n](r).then(function(){i&&(t.sessionConfig&&e.setSessionConfig(t.sessionConfig),e.beCalledInfo=r,e.initSession({beCalledInfo:r}))},function(t){throw e.logger.log(t),t})},l.baseControl=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(t.channelId=t.channelId||this.channelId,t.command&&t.channelId){this.controller.uploadDataApi("update",{key:"call_control_type"});var n=t.fn||"netcallControl";return t.type=t.command,this.nim[n](t).catch(function(t){e.logger.log(t)})}},l.baseHangup=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.controller.uploadDataApi("send");var t=e.channelId,n=void 0===t?this.channelId:t,r=e.recordType;if(n){var i=e.fn||"hangup";this.nim[i]({channelId:n})}n===this.channelId&&(this.isCaller&&!this.callAccepted&&(this.logger.log(r,{channelId:n}),this.packNetcallRecord({recordType:r})),this.resetWhenHangup())},l.baseStartSession=function(){this.imInfo.cid=this.imInfo.cid||this.imInfo.channelId;var e=this.sessionMode=this.sessionMode||"p2p";this.imInfo.sessionMode=e,this.imInfo.sessionConfig=this.sessionConfig,this.imInfo.serverMap&&this.imInfo.serverMap.constructor===String&&(this.imInfo.serverMap=JSON.parse(this.imInfo.serverMap))},l.packNetcallRecord=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.recordType,n=e.type||this.type,r=e.channelId||this.channelId,i=e.duration||0,o=e.isCaller||this.isCaller,s=e.target||this.target.account,c=this.baseGetAccount(),u=o?c:s,d=o?s:c,l=+new Date;this.nim.protocol.onMsg({content:{msg:{attach:JSON.stringify({data:{calltype:n,channel:r,duration:i,ids:[c,s],time:l},id:t}),from:u,fromClientType:o?16:0,fromDeviceId:"",fromNick:"",idClient:a.tool.guid(),idServer:a.tool.guid(),scene:0,time:l,to:d,type:5}}})},l.setSessionConfig=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a.tool.merge(this.sessionConfig,e)},l.initSignal=function(){return Promise.resolve()},l.initSession=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.sessionMode="p2p";var n=this.isCaller?this.callerInfo:t.beCalledInfo;this.parseAccountUidMap(n.accountUidMap),!n.account&&n.uid&&(n.account=this.getAccountWithUid(n.uid)),this.callAccepted=!0,this.signalInited=!0,this.setSessionConfig({signalEndTime:Date.now()}),this.controller.uploadDataApi("start",{uid:n.uid}),this.target.uid=this.getUidWithAccount(this.target.account);var r={type:n.type,account:this.target&&this.target.account||n.account,channelId:n.channelId};n.netcallType&&(r.netcallType=n.netcallType),this.imInfo.target=this.target,setTimeout(function(){e.emit("callAccepted",r)},1)},l.onBeCalled=function(e){this.signalInited=!0,this.channelId=e.channelId,this.beCalledInfo=e,this.logger.log("beCalling",e),this.emit("beCalling",e)},l.onUserJoin=function(e){if(this.logger.log("client on userJoined",e),e.type=e.type||this.type,e.account=this.getAccountWithUid(e.uid),e.mode=this.sessionMode,e.account!==this.baseGetAccount()){if(e.account)return this.logger.log("userjoin ----\x3e from signal",e),void this.emit("joinChannel",e);this.needQueryAccountMap[e.uid]=e,(this.nim.queryAccountUidMap||this.nim.wbQueryAccountUidMap).call(this.nim,this.channelName,[e.uid])}},l.onUserLeft=function(e){var t=this;this.imInfo.channelId&&(this.logger.log("leave channel from signal"),"p2p"===this.imInfo.sessionMode?(this.controller.uploadDataApi("send"),setTimeout(function(){t.logger.log("超时处理 onUserLeft"),t.resetWhenHangup()},1e3),this.emit("hangup",{channelId:e.channelId||e.cid,account:this.target.account,type:e.type||0})):this.emit("leaveChannel",{channelId:e.channelId||e.cid,account:this.getAccountWithUid(e.uid),type:e.type||0}))},l.onNotifyJoin=function(e){if(this.logger){this.logger.log("join channel from IM");var t=e.accountUidMap,n=this.needQueryAccountMap;for(var r in this.parseAccountUidMap(t),t){var i=r,o=t[r];if(o in n){var a=n[o];a.account=i,delete n[o],this.logger.log("userjoin ----\x3e from IM",e),this.emit("joinChannel",a)}}}},l.onCalleeAck=function(e){if(this.logger.log("收到被叫的通知",e),!this.baseNotCurrentChannelId(e)){var t=e.account,n=this.beCalledInfo||this.callerInfo;this.target.account=t,this.setSessionConfig({signalEndTime:Date.now()}),e.accepted?(this.callAccepted=!0,this.initSession()):(this.logger.log("call Rejected",e),this.packNetcallRecord({type:e.type,channelId:e.channelId,isCaller:!0,target:e.account,recordType:"netcallRejected"}),this.resetWhenHangup(),this.emit("callRejected",{type:n.type,account:t}))}},l.onHangup=function(e){var t=this;this.channelId&&"p2p"===this.sessionMode&&(this.logger.log("on hangup from IM"),this.controller.uploadDataApi("send"),setTimeout(function(){t.logger.log("超时处理 onHangup"),t.resetWhenHangup()},1e3),this.emit("hangup",{channelId:e.channelId,account:e.account,type:0}))},l.onControl=function(e){this.emit("control",e)},l.onCalleeAckSync=function(e){this.emit("callerAckSync",e),this.baseIsCurrentChannelId(e)&&this.resetWhenHangup()},l.baseCreateChannel=function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return a.tool.verifyOptions(n,"channelName"),n.custom=n.custom||"",this.setSessionConfig({signalStartTime:Date.now()}),this.nim[e](n).then(function(e){return Promise.resolve(e)}).catch(function(e){return t.setSessionConfig({signalEndTime:Date.now()}),Promise.reject(e)})},l.baseJoinChannel=function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.nim[e](n).then(function(e){return t.setSessionConfig({signalEndTime:Date.now()}),t.signalInited=!0,t.sessionMode=e.sessionMode="meeting",t.parseAccountUidMap(e.accountUidMap),e.uid=t.getUidWithAccount(t.nim.account),Promise.resolve(e)}).catch(function(e){return t.setSessionConfig({signalEndTime:Date.now()}),Promise.reject(e)})},l.format=function(e){return e.rtcServerMap&&(e.rtcServerMap=JSON.parse(e.rtcServerMap),e.rtcServerMap=e.rtcServerMap.webrtcarray||[e.rtcServerMap.webrtc]||e.rtcServerMap),e.wbServerMap&&(e.wbServerMap=JSON.parse(e.wbServerMap),e.wbServerMap=e.wbServerMap.webrtcarray||[e.wbServerMap.webrtc]||e.wbServerMap),e},l.resetWhenHangup=function(){},e.exports=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=d(n(14)),i=d(n(50)),o=d(n(27)),a=d(n(28)),s=d(n(154)),c=d(n(73)),u=d(n(116));function d(e){return e&&e.__esModule?e:{default:e}}var l=function(e){function t(e){(0,r.default)(this,t);var n=(0,o.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.info={},n._init(e),n._reset(),n}return(0,a.default)(t,e),(0,i.default)(t,[{key:"_init",value:function(e){this.info=Object.assign(this.info,e),this.logger=e.logger||window.console,c.default.STATS_RTC[c.default.CURRENT.SDK_TYPE]&&(this.dataApi=function(e){return new u.default(e)}({appkey:this.info.appKey,platform:c.default.SDK_NAME[c.default.CURRENT.SDK_TYPE]}))}},{key:"_reset",value:function(){this.signal&&(this.signal.destroy(),this.signal=null),this.sessionConfig={},this.imInfo={},this.target={},this.userJoinTimeoutId=0,this.remoteNodeStatus={}}},{key:"resetStatus",value:function(){this._reset()}},{key:"_startSession",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.imInfo||e;t.uid=+t.uid,t.cid=+t.cid,this.setSessionConfig(t.sessionConfig);var n=t.serverMap||{};t.urlArray=t.serverAddrs&&JSON.parse(JSON.stringify(t.serverAddrs))||n.webrtcarray&&JSON.parse(JSON.stringify(n.webrtcarray))||[n.webrtc];return this.signal?Promise.resolve(this.signal):this._initSignal()}},{key:"_initSignal",value:function(){var e=this;if(this.signal)return Promise.resolve();var t=new s.default({logger:this.logger}),n=this.imInfo.urlArray;if(n){var r=n.shift();return r?t.connect({url:r,imInfo:this.imInfo}).then(function(t){return e.signal=t,e._initSignalEvent(),t.emit("connected"),Promise.resolve(t.url)}).catch(function(t){return e._initSignal()}):Promise.reject("无可用的网关服务器地址, 如果当前应用是WebRTC音视频, 请确保对方打开了WebRTC兼容开关")}}},{key:"_initSignalEvent",value:function(){var e=this,t=this.signal;t.on("signalTimeout",this.onSignalTimeout.bind(this)),t.on("message",this.onSignalMessage.bind(this)),t.on("connected",function(){e.emit("connected")}),t.on("signalClosed",function(){e.emit("signalClosed"),e.resetStatus()}),this.signal.on("signalError",function(t){e.emit("signalClosed"),e._stopSignal()})}},{key:"_stopSignal",value:function(){this.signal&&(this.signal.destroy(),this.signal=null)}},{key:"_stopSession",value:function(){this._stopSignal(),this._reset()}},{key:"_logout",value:function(){this.signal&&this.signal.logout()}},{key:"setAppKey",value:function(e){e&&(this.info.appKey=e)}},{key:"setSessionConfig",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.sessionConfig=Object.assign(this.sessionConfig,e)}},{key:"onSignalMessage",value:function(e){}},{key:"onSignalTimeout",value:function(e){}},{key:"uploadDataApi",value:function(e,t){c.default.STATS_FUN[c.default.CURRENT.SDK_TYPE]&&this.info.appKey&&("start"===e&&(t.appkey=this.info.appKey),this.dataApi[e]&&this.dataApi[e](t))}}]),t}(n(25));t.default=l,e.exports=t.default},function(e,t,n){var r=n(10),i=n(59),o=n(2)("species");e.exports=function(e,t){var n,a=r(e).constructor;return void 0===a||void 0==(n=r(a)[o])?t:i(n)}},function(e,t,n){var r,i,o,a=n(43),s=n(307),c=n(70),u=n(47),d=n(1),l=d.process,p=d.setImmediate,f=d.clearImmediate,h=d.MessageChannel,m=d.Dispatch,v=0,g={},y=function(){var e=+this;if(g.hasOwnProperty(e)){var t=g[e];delete g[e],t()}},S=function(e){y.call(e.data)};p&&f||(p=function(e){for(var t=[],n=1;arguments.length>n;)t.push(arguments[n++]);return g[++v]=function(){s("function"==typeof e?e:Function(e),t)},r(v),v},f=function(e){delete g[e]},"process"==n(32)(l)?r=function(e){l.nextTick(a(y,e,1))}:m&&m.now?r=function(e){m.now(a(y,e,1))}:h?(o=(i=new h).port2,i.port1.onmessage=S,r=a(o.postMessage,o,1)):d.addEventListener&&"function"==typeof postMessage&&!d.importScripts?(r=function(e){d.postMessage(e+"","*")},d.addEventListener("message",S,!1)):r="onreadystatechange"in u("script")?function(e){c.appendChild(u("script")).onreadystatechange=function(){c.removeChild(this),y.call(e)}}:function(e){setTimeout(a(y,e,1),0)}),e.exports={set:p,clear:f}},function(e,t){e.exports=function(e){try{return{e:!1,v:e()}}catch(e){return{e:!0,v:e}}}},function(e,t,n){var r=n(10),i=n(11),o=n(151);e.exports=function(e,t){if(r(e),i(t)&&t.constructor===e)return t;var n=o.f(e);return(0,n.resolve)(t),n.promise}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=i;var r=n(68).RtcSupport.checkWebAudio();function i(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.stream,n=e.uid,i=e.isAnalyze,o=e.isRemote;this.support=r.WebAudio&&r.MediaStream,this.gain=1,this.stream=t,this.support&&(this.audioIn={},this.uid=n||0,this.isAnalyze=i,this.isRemote=o||!1,this.instant=0,this.slow=0,this.clip=0,this.init())}i.ac=r.WebAudio&&r.MediaStream?new window.AudioContext:{},i.destination=i.ac.createMediaStreamDestination?i.ac.createMediaStreamDestination():{};var o=i.prototype;o.context=i.ac,o.init=function(){this.validateInput()&&(this.isAnalyze&&this.initMonitor(),this.formatStreams(),this.initWebAudio(),this.initAudioIn())},o.validateInput=function(){return/(Array|MediaStream|LocalMediaStream)/.test(this.stream.constructor)},o.initMonitor=function(){var e=this;(this.script=this.context.createScriptProcessor(0,1,1)).onaudioprocess=function(t){var n,r=t.inputBuffer.getChannelData(0),i=0,o=0;for(n=0;n<r.length;++n)i+=Math.abs(r[n]),Math.abs(r[n])>.99&&(o+=1);e.instant=Math.sqrt(i/r.length),e.slow=.95*e.slow+.05*e.instant,e.clip=o/r.length}},o.initWebAudio=function(){var e=this.context;this.gainFilter=e.createGain(),this.destination=this.isRemote?i.destination:e.createMediaStreamDestination(),this.gainFilter.gain.value=this.gain,this.gainFilter.connect(this.destination)},o.initAudioIn=function(){var e=this,t=this,n=this.stream,r=this.context,i=void 0;if(/(MediaStream|LocalMediaStream)/.test(n.constructor))return o(n),void(this.outputStream=this.destination.stream);function o(e){if(!/(MediaStream|LocalMediaStream)/.test(e.constructor))return null;if(0===e.getAudioTracks().length)return null;var n=r.createMediaStreamSource(e);return t.isAnalyze&&t.script&&(n.connect(t.script),t.script.connect(t.gainFilter)),n.connect(t.gainFilter),n}n.constructor===Array&&(n.forEach(function(t){(i=o(t))&&(e.audioIn[t.id]=i)}),this.outputStream=this.destination.stream)},o.formatStreams=function(){var e=this.stream,t=[];if(/(MediaStream|LocalMediaStream)/.test(e.constructor))return e.getAudioTracks().map(function(e){t.push(new MediaStream([e]))}),void(this.stream=t);e.constructor===Array&&(e.map(function(e){e.getAudioTracks().map(function(e){t.push(new MediaStream([e]))})}),this.stream=t)},o.addStream=function(e){var t=this.context;if(0!==e.getAudioTracks().length){var n=t.createMediaStreamSource(e);this.isAnalyze&&this.script&&n.connect(this.script),n.connect(this.gainFilter),this.audioIn[e.id]=n,this.outputStream=this.destination.stream}},o.updateStream=function(e){if(this.audioIn)for(var t in this.audioIn)this.audioIn[t]&&this.audioIn[t].disconnect(0),this.audioIn[t]=null;this.audioIn={},this.stream=e,this.initAudioIn()},o.setGain=function(e){this.support&&(this.gainFilter.gain.value=e,this.gain=e)},o.getGain=function(){return this.gain},o.off=function(){return this.setGain(0)},o.on=function(){this.setGain(1)},o.destroy=function(){if(this.instant=0,this.slow=0,this.clip=0,this.gainFilter&&this.gainFilter.disconnect(0),this.script&&this.script.disconnect(0),this.audioIn)for(var e in this.audioIn)this.audioIn[e]&&this.audioIn[e].disconnect(0);this.audioIn={};var t=this.stream;function n(e){e&&e.getTracks().forEach(function(t){e.removeTrack(t)})}/(MediaStream|LocalMediaStream)/.test(t.constructor)&&n(t),t.constructor===Array&&t.forEach(function(e){n(e)}),this.stream=null,this.outputStream=null},o.getVolumeData=function(){return this.instant.toFixed(2)},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a(n(118)),i=a(n(119)),o=a(n(150));function a(e){return e&&e.__esModule?e:{default:e}}var s=n(16),c=navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,u=window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext,d=window.RTCPeerConnection=window.RTCPeerConnection||window.webkitRTCPeerConnection||window.mozRTCPeerConnection,l=window.RTCDataChannel=window.RTCDataChannel||window.DataChannel,p=(window.RTCSessionDescription=window.RTCSessionDescription||window.mozRTCSessionDescription,window.RTCIceCandidate=window.RTCIceCandidate||window.mozRTCIceCandidate,window.MediaStream=window.MediaStream||window.webkitMediaStream);function f(e){var t=void 0;return t||(t=document.createElement("video")),!!t.canPlayType({ogg:'video/ogg; codecs="theora"',h264:'video/mp4; codecs="avc1.42E01E"',webm:'video/webm; codecs="vp8, vorbis"',vp9:'video/webm; codecs="vp9"',hls:'application/x-mpegURL; codecs="avc1.42E01E"'}[e]||e)}var h={WebRTC:!!d&&!!p,RTCPeerConnection:!!d,Vp8:f("webm"),Vp9:f("vp9"),H264:f("h264"),GetUserMedia:!!c&&!!navigator.mediaDevices,DataChannel:!!(d&&l&&d.prototype&&d.prototype.createDataChannel),WebAudio:!(!u||!u.prototype.createMediaStreamSource),MediaStream:!!p};function m(){var e=s&&s.name,t=s&&s.version;return console.log("platform",s),{prefix:e,version:t=(t=t&&t.match(/(\d|\.)+/)[0])&&t.match(/\d+/)[0]}}t.default={checkWebAudio:function(){return{WebAudio:h.WebAudio,MediaStream:h.MediaStream}},checkCompatibility:function(){var e=Object.assign(m(),{system:s&&s.os.family+" "+s.os.version,browser:s&&s.name,version:s&&s.version});return new Promise(function(t,n){var a=this;(0,i.default)(r.default.mark(function n(){var i,s;return r.default.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return i=Object.assign(e,h,{ScreenSharing:!1}),n.next=3,o.default.getDevices().catch(function(e){return console.warn(e),t(i)});case 3:return s=n.sent,i.MicrophoneList=s&&s.audioIn||[],i.CameraList=s&&s.video||[],i.Microphone=s&&s.audioIn&&s.audioIn.length>0||!1,i.Camera=s&&s.video&&s.video.length>0||!1,n.abrupt("return",t(i));case 9:case"end":return n.stop()}},n,a)}))()})},checkVersion:function(){return m()}},e.exports=t.default},function(e,t){var n=e.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w\/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-\.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcpxr",reg:/^rtcp-xr:(.*)/,format:"rtcp-xr:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%d trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))? (\S*)(?: (\S*))?/,names:["value","direction","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+" %s"+(e.config?" %s":"")}},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),t+=null!=e["network-id"]?" network-id %d":"%v",t+=null!=e["network-cost"]?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_\/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{push:"invalid",names:["value"]}]};Object.keys(n).forEach(function(e){n[e].forEach(function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")})})},function(e,t,n){"use strict";var r={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};r.localCName=r.generateIdentifier(),r.splitLines=function(e){return e.trim().split("\n").map(function(e){return e.trim()})},r.splitSections=function(e){return e.split("\nm=").map(function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"})},r.getDescription=function(e){var t=r.splitSections(e);return t&&t[0]},r.getMediaSections=function(e){var t=r.splitSections(e);return t.shift(),t},r.matchPrefix=function(e,t){return r.splitLines(e).filter(function(e){return 0===e.indexOf(t)})},r.parseCandidate=function(e){for(var t,n={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],port:parseInt(t[5],10),type:t[7]},r=8;r<t.length;r+=2)switch(t[r]){case"raddr":n.relatedAddress=t[r+1];break;case"rport":n.relatedPort=parseInt(t[r+1],10);break;case"tcptype":n.tcpType=t[r+1];break;case"ufrag":n.ufrag=t[r+1],n.usernameFragment=t[r+1];break;default:n[t[r]]=t[r+1]}return n},r.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.ip),t.push(e.port);var n=e.type;return t.push("typ"),t.push(n),"host"!==n&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},r.parseIceOptions=function(e){return e.substr(14).split(" ")},r.parseRtpMap=function(e){var t=e.substr(9).split(" "),n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.channels=3===t.length?parseInt(t[2],10):1,n.numChannels=n.channels,n},r.writeRtpMap=function(e){var t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);var n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==n?"/"+n:"")+"\r\n"},r.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},r.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},r.parseFmtp=function(e){for(var t,n={},r=e.substr(e.indexOf(" ")+1).split(";"),i=0;i<r.length;i++)n[(t=r[i].trim().split("="))[0].trim()]=t[1];return n},r.writeFmtp=function(e){var t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var r=[];Object.keys(e.parameters).forEach(function(t){e.parameters[t]?r.push(t+"="+e.parameters[t]):r.push(t)}),t+="a=fmtp:"+n+" "+r.join(";")+"\r\n"}return t},r.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},r.writeRtcpFb=function(e){var t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(e){t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},r.parseSsrcMedia=function(e){var t=e.indexOf(" "),n={ssrc:parseInt(e.substr(7,t-7),10)},r=e.indexOf(":",t);return r>-1?(n.attribute=e.substr(t+1,r-t-1),n.value=e.substr(r+1)):n.attribute=e.substr(t+1),n},r.getMid=function(e){var t=r.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)},r.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}},r.getDtlsParameters=function(e,t){return{role:"auto",fingerprints:r.matchPrefix(e+t,"a=fingerprint:").map(r.parseFingerprint)}},r.writeDtlsParameters=function(e,t){var n="a=setup:"+t+"\r\n";return e.fingerprints.forEach(function(e){n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),n},r.getIceParameters=function(e,t){var n=r.splitLines(e);return{usernameFragment:(n=n.concat(r.splitLines(t))).filter(function(e){return 0===e.indexOf("a=ice-ufrag:")})[0].substr(12),password:n.filter(function(e){return 0===e.indexOf("a=ice-pwd:")})[0].substr(10)}},r.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},r.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},n=r.splitLines(e)[0].split(" "),i=3;i<n.length;i++){var o=n[i],a=r.matchPrefix(e,"a=rtpmap:"+o+" ")[0];if(a){var s=r.parseRtpMap(a),c=r.matchPrefix(e,"a=fmtp:"+o+" ");switch(s.parameters=c.length?r.parseFmtp(c[0]):{},s.rtcpFeedback=r.matchPrefix(e,"a=rtcp-fb:"+o+" ").map(r.parseRtcpFb),t.codecs.push(s),s.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(s.name.toUpperCase())}}}return r.matchPrefix(e,"a=extmap:").forEach(function(e){t.headerExtensions.push(r.parseExtmap(e))}),t},r.writeRtpDescription=function(e,t){var n="";n+="m="+e+" ",n+=t.codecs.length>0?"9":"0",n+=" UDP/TLS/RTP/SAVPF ",n+=t.codecs.map(function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType}).join(" ")+"\r\n",n+="c=IN IP4 0.0.0.0\r\n",n+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach(function(e){n+=r.writeRtpMap(e),n+=r.writeFmtp(e),n+=r.writeRtcpFb(e)});var i=0;return t.codecs.forEach(function(e){e.maxptime>i&&(i=e.maxptime)}),i>0&&(n+="a=maxptime:"+i+"\r\n"),n+="a=rtcp-mux\r\n",t.headerExtensions&&t.headerExtensions.forEach(function(e){n+=r.writeExtmap(e)}),n},r.parseRtpEncodingParameters=function(e){var t,n=[],i=r.parseRtpParameters(e),o=-1!==i.fecMechanisms.indexOf("RED"),a=-1!==i.fecMechanisms.indexOf("ULPFEC"),s=r.matchPrefix(e,"a=ssrc:").map(function(e){return r.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute}),c=s.length>0&&s[0].ssrc,u=r.matchPrefix(e,"a=ssrc-group:FID").map(function(e){return e.substr(17).split(" ").map(function(e){return parseInt(e,10)})});u.length>0&&u[0].length>1&&u[0][0]===c&&(t=u[0][1]),i.codecs.forEach(function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var r={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10)};c&&t&&(r.rtx={ssrc:t}),n.push(r),o&&((r=JSON.parse(JSON.stringify(r))).fec={ssrc:t,mechanism:a?"red+ulpfec":"red"},n.push(r))}}),0===n.length&&c&&n.push({ssrc:c});var d=r.matchPrefix(e,"b=");return d.length&&(d=0===d[0].indexOf("b=TIAS:")?parseInt(d[0].substr(7),10):0===d[0].indexOf("b=AS:")?1e3*parseInt(d[0].substr(5),10)*.95-16e3:void 0,n.forEach(function(e){e.maxBitrate=d})),n},r.parseRtcpParameters=function(e){var t={},n=r.matchPrefix(e,"a=ssrc:").map(function(e){return r.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute})[0];n&&(t.cname=n.value,t.ssrc=n.ssrc);var i=r.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=i.length>0,t.compound=0===i.length;var o=r.matchPrefix(e,"a=rtcp-mux");return t.mux=o.length>0,t},r.parseMsid=function(e){var t,n=r.matchPrefix(e,"a=msid:");if(1===n.length)return{stream:(t=n[0].substr(7).split(" "))[0],track:t[1]};var i=r.matchPrefix(e,"a=ssrc:").map(function(e){return r.parseSsrcMedia(e)}).filter(function(e){return"msid"===e.attribute});return i.length>0?{stream:(t=i[0].value.split(" "))[0],track:t[1]}:void 0},r.generateSessionId=function(){return Math.random().toString().substr(2,21)},r.writeSessionBoilerplate=function(e,t){var n=void 0!==t?t:2;return"v=0\r\no=thisisadapterortc "+(e||r.generateSessionId())+" "+n+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},r.writeMediaSection=function(e,t,n,i){var o=r.writeRtpDescription(e.kind,t);if(o+=r.writeIceParameters(e.iceGatherer.getLocalParameters()),o+=r.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":"active"),o+="a=mid:"+e.mid+"\r\n",e.direction?o+="a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?o+="a=sendrecv\r\n":e.rtpSender?o+="a=sendonly\r\n":e.rtpReceiver?o+="a=recvonly\r\n":o+="a=inactive\r\n",e.rtpSender){var a="msid:"+i.id+" "+e.rtpSender.track.id+"\r\n";o+="a="+a,o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+a,e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+a,o+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+r.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+r.localCName+"\r\n"),o},r.getDirection=function(e,t){for(var n=r.splitLines(e),i=0;i<n.length;i++)switch(n[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[i].substr(2)}return t?r.getDirection(t):"sendrecv"},r.getKind=function(e){return r.splitLines(e)[0].split(" ")[0].substr(2)},r.isRejected=function(e){return"0"===e.split(" ",2)[1]},r.parseMLine=function(e){var t=r.splitLines(e)[0].substr(2).split(" ");return{kind:t[0],port:parseInt(t[1],10),protocol:t[2],fmt:t.slice(3).join(" ")}},r.parseOLine=function(e){var t=r.matchPrefix(e,"o=")[0].substr(2).split(" ");return{username:t[0],sessionId:t[1],sessionVersion:parseInt(t[2],10),netType:t[3],addressType:t[4],address:t[5]}},e.exports=r},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";var r=n(196),i={install:function(e){var t=e.fn,n=e.util,i=r({util:n});t.initNetcall=function(e){return n.verifyOptions(e,"type accounts","netcall::initNetcall"),e.pushContent="",e.custom="",e.pushConfig||(e.pushConfig={}),e.pushConfig.webrtcEnable=e.webrtcEnable,e.pushConfig=new i(e.pushConfig),this.cbAndSendCmd("initNetcall",e)},t.keepCalling=function(e){return n.verifyOptions(e,"type accounts channelId","netcall::keepCalling"),this.cbAndSendCmd("keepCalling",e)},t.calleeAck=function(e){return n.verifyOptions(e,"account channelId type accepted","netcall::calleeAck"),this.cbAndSendCmd("calleeAck",e)},t.hangup=function(e){return n.verifyOptions(e,"channelId","netcall::hangup"),this.cbAndSendCmd("hangup",e)},t.netcallControl=function(e){return n.verifyOptions(e,"channelId type","netcall::netcallControl"),this.cbAndSendCmd("netcallControl",e)},t.createChannel=function(e){return this.cbAndSendCmd("createChannel",e)},t.joinChannel=function(e){return n.verifyOptions(e,"channelName","netcall::joinChannel"),n.verifyBooleanWithDefault(e,"liveEnable",!1,"","netcall::joinChannel"),n.verifyBooleanWithDefault(e,"webrtcEnable",!1,"","netcall::joinChannel"),this.cbAndSendCmd("joinChannel",{channelName:e.channelName,liveOption:{liveEnable:e.liveEnable?1:0,webrtcEnable:e.webrtcEnable?1:0}})},t.queryAccountUidMap=function(e,t){return this.cbAndSendCmd("queryAccountUidMap",{channelName:e,uids:t})}}};e.exports=i},function(e,t,n){"use strict";var r={install:function(e){var t=e.Protocol.fn;t.processNetcall=function(e){switch(e.cmd){case"initNetcall":this.onInitNetcall(e);break;case"beCalled":this.onBeCalled(e);break;case"keepCalling":this.onKeepCalling(e);break;case"calleeAck":break;case"notifyCalleeAck":this.onNotifyCalleeAck(e);break;case"hangup":break;case"notifyHangup":this.onNotifyHangup(e);break;case"notifyNetcallControl":this.onNetcallControl(e);break;case"notifyCalleeAckSync":this.onNotifyCalleeAckSync(e);break;case"notifyNetcallRecord":this.onMsg(e);break;case"createChannel":break;case"joinChannel":this.joinChannel(e);break;case"notifyJoin":this.notifyJoin(e)}},t.onInitNetcall=function(e){if(!e.error){var t=e.obj.type;e.obj=e.content,e.obj.type=t,e.obj.accounts=e.obj.keepCallingAccounts,this.setCurrentNetcall(e.obj.channelId),this.keepCalling(e)}},t.setCurrentNetcall=function(e){this.currentNetcallChannelId=e},t.onKeepCalling=function(e){e.error||e.content.accounts.length&&this.keepCalling(e)},t.keepCalling=function(e){var t=this,n=e.obj,r=n.type,i=n.accounts,o=n.channelId;i&&i.length&&setTimeout(function(){t.currentNetcallChannelId&&t.currentNetcallChannelId===o&&t.api.keepCalling({type:r,accounts:i,channelId:o}).catch(function(){})},3e3)},t.onBeCalled=function(e){e.error||this.emitAPI({type:"beCalled",obj:e.content})},t.onNotifyCalleeAck=function(e){e.error||this.emitAPI({type:"notifyCalleeAck",obj:e.content})},t.onNotifyHangup=function(e){e.error||this.emitAPI({type:"notifyHangup",obj:e.content})},t.onNetcallControl=function(e){e.error||this.emitAPI({type:"netcallControl",obj:e.content})},t.onNotifyCalleeAckSync=function(e){e.error||this.emitAPI({type:"notifyCalleeAckSync",obj:e.content})},t.notifyJoin=function(e){e.error||this.emitAPI({type:"notifyJoin",obj:e.content})},t.joinChannel=function(e){e.obj=e.content}}};e.exports=r},function(e,t,n){"use strict";var r={netcall:{id:9,initNetcall:1,keepCalling:3,calleeAck:4,notifyCalleeAck:5,hangup:6,notifyHangup:7,netcallControl:8,notifyNetcallControl:9,verifyChannelId:10,createChannel:13,joinChannel:14,queryAccountUidMap:16}},i={initNetcall:{sid:9,cid:r.netcall.initNetcall,params:[{type:"byte",name:"type"},{type:"StrArray",name:"accounts"},{type:"String",name:"pushContent"},{type:"String",name:"custom"},{type:"Property",name:"pushConfig"}]},keepCalling:{sid:9,cid:r.netcall.keepCalling,params:[{type:"byte",name:"type"},{type:"StrArray",name:"accounts"},{type:"long",name:"channelId"}]},calleeAck:{sid:9,cid:r.netcall.calleeAck,params:[{type:"string",name:"account"},{type:"long",name:"channelId"},{type:"byte",name:"type"},{type:"bool",name:"accepted"}]},hangup:{sid:9,cid:r.netcall.hangup,params:[{type:"long",name:"channelId"}]},netcallControl:{sid:9,cid:r.netcall.netcallControl,params:[{type:"long",name:"channelId"},{type:"byte",name:"type"}]},verifyChannelId:{sid:9,cid:r.netcall.verifyChannelId,params:[{type:"long",name:"channelId"},{type:"String",name:"account"}]},createChannel:{sid:9,cid:r.netcall.createChannel,params:[{type:"String",name:"channelName"},{type:"String",name:"custom"},{type:"String",name:"webrtcEnable"}]},joinChannel:{sid:9,cid:r.netcall.joinChannel,params:[{type:"String",name:"channelName"},{type:"Property",name:"liveOption"}]},queryAccountUidMap:{sid:9,cid:r.netcall.queryAccountUidMap,params:[{type:"String",name:"channelName"},{type:"LongArray",name:"uids"}]}},o={"9_1":{service:"netcall",cmd:"initNetcall",response:[{type:"Number",name:"timetag"},{type:"Number",name:"uid"},{type:"Number",name:"channelId"},{type:"StrArray",name:"turnServerList"},{type:"StrArray",name:"sturnServerList"},{type:"StrArray",name:"proxyServerList"},{type:"StrArray",name:"keepCallingAccounts"},{type:"StrLongMap",name:"accountUidMap"},{type:"String",name:"clientConfig"},{type:"String",name:"serverMap"}]},"9_2":{service:"netcall",cmd:"beCalled",response:[{type:"Number",name:"timetag"},{type:"Number",name:"type"},{type:"Number",name:"channelId"},{type:"String",name:"account"},{type:"Number",name:"uid"},{type:"StrArray",name:"turnServerList"},{type:"StrArray",name:"sturnServerList"},{type:"StrArray",name:"proxyServerList"},{type:"StrLongMap",name:"accountUidMap"},{type:"String",name:"clientConfig"},{type:"String",name:"custom"},{type:"Property",name:"pushConfig"},{type:"String",name:"serverMap"}]},"9_3":{service:"netcall",cmd:"keepCalling",response:[{type:"StrArr",name:"accounts"}]},"9_4":{service:"netcall",cmd:"calleeAck",response:[]},"9_5":{service:"netcall",cmd:"notifyCalleeAck",response:[{type:"String",name:"account"},{type:"long",name:"channelId"},{type:"byte",name:"type"},{type:"bool",name:"accepted"}]},"9_6":{service:"netcall",cmd:"hangup",response:[]},"9_7":{service:"netcall",cmd:"notifyHangup",response:[{type:"long",name:"channelId"},{type:"String",name:"account"},{type:"long",name:"timetag"}]},"9_8":{service:"netcall",cmd:"netcallControl",response:[]},"9_9":{service:"netcall",cmd:"notifyNetcallControl",response:[{type:"String",name:"account"},{type:"byte",name:"type"},{type:"long",name:"channelId"}]},"9_10":{service:"netcall",cmd:"verifyChannelId",response:[]},"9_11":{service:"netcall",cmd:"notifyNetcallRecord",response:[{type:"Property",name:"msg"}]},"9_12":{service:"netcall",cmd:"notifyCalleeAckSync",response:[{type:"String",name:"timetag"},{type:"long",name:"channelId"},{type:"byte",name:"type"},{type:"bool",name:"accepted"},{type:"byte",name:"fromClientType"}]},"9_13":{service:"netcall",cmd:"createChannel",response:[{type:"long",name:"timetag"}]},"9_14":{service:"netcall",cmd:"joinChannel",response:[{type:"long",name:"timetag"},{type:"long",name:"channelId"},{type:"StrLongMap",name:"accountUidMap"},{type:"String",name:"serverMap"},{type:"String",name:"clientConfig"},{type:"String",name:"custom"}]},"9_15":{service:"netcall",cmd:"notifyJoin",response:[{type:"Long",name:"channelId"},{type:"StrLongMap",name:"accountUidMap"}]},"9_16":{service:"netcall",cmd:"queryAccountUidMap",response:[]}};e.exports={idMap:r,cmdConfig:i,packetConfig:o}},function(e,t,n){"use strict";e.exports={pushConfig:{enable:1,needBadge:2,needPushNick:3,pushContent:4,custom:5,pushPayload:6,sound:7,forceKeepCalling:9,webrtcEnable:10},liveOption:{liveEnable:1,webrtcEnable:2}}},function(e,t,n){"use strict";e.exports={pushConfig:{1:"enable",2:"needBadge",3:"needPushNick",4:"pushContent",5:"custom",6:"pushPayload",7:"sound",9:"forceKeepCalling",10:"webrtcEnable"},liveOption:{1:"liveEnable",2:"webrtcEnable"}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=g(n(14)),i=g(n(50)),o=g(n(27)),a=g(n(28)),s=g(n(200)),c=n(117),u=n(58),d=n(68),l=g(n(332)),p=g(n(344)),f=g(n(345)),h=g(n(346)),m=g(n(347)),v=g(n(348));function g(e){return e&&e.__esModule?e:{default:e}}var y=null,S=function(e){function t(e){(0,r.default)(this,t);var n=(0,o.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.logger=e.logger||{},n.resetStatus(),n.init(),n}return(0,a.default)(t,e),(0,i.default)(t,[{key:"resetStatus",value:function(){this.rtc&&"closed"!==this.rtc.signalingState&&this.rtc.close(),this.stopStats(),this.stopAudioMonitor(),this.destroyLocalMediaStream(),this.destroyRemoteNode(),this._reset(),this.currRmoteOffer=null,this.rtc=null,this.rtcLogined=!1,this.rtcConnected=!1,this.reConnectCount=0,this.remote_SdpOffers=[],this.remoteStreams={},this.remoteNode={},this.currRemoteTrack={},this.deviceVideoStatus=!1,this.deviceAudioStatus=!1,this.monitorRemoteStreamStartTime=null,this.userJoinTimeoutId=null}},{key:"destroy",value:function(){this.stopSession(),this.resetStatus(),this.mediaDevices=null,this.rtcRecorder=null,this.stats=null,this.statsNew=null,this.dataStats=null,this.dataRtc=null}},{key:"init",value:function(){this.mediaDevices=new c.MDevices,this.mediaDevices.on("deviceStatus",this.onDeviceStatusChange.bind(this)),this.mediaDevices.on("deviceAdd",this.onDeviceAdd.bind(this)),this.mediaDevices.on("deviceRemove",this.onDeviceRemove.bind(this)),this.rtcRecorder=new c.Recorder,this.initStats(),d.RtcUtil.init(this.logger),c.Recorder.init(this.logger),c.MStream.init(this.logger),y||(y=d.RtcSupport.checkVersion())}},{key:"startSession",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.imInfo=t,this.sessionConfig=Object.assign(this.sessionConfig,t.sessionConfig);var n=u.constantTool.getVideoSessionConfig({quality:this.sessionConfig.videoQuality,frameRate:this.sessionConfig.videoFrameRate});return this.imInfo=Object.assign(this.imInfo,{videoConfig:n}),this._startSession().then(function(t){return e.rtcLogin()}).then(function(t){e.startStats(),e.rtcLogined=!0;var n=e.mediaDevices.getDeviceStatus(),r=e.deviceAudioStatus&&n.hasAudio&&!e.imInfo.role||!1,i=e.deviceVideoStatus&&n.hasVideo&&!e.imInfo.role||!1;console.log("this.deviceAudioStatus",e.deviceAudioStatus),console.log("deviceStatus.hasAudio",n.hasAudio),console.log("this.imInfo.role",e.imInfo.role),(r||i)&&e.initRtc(),e.startAudioMonitor()}).catch(function(e){return Promise.reject(e)})}},{key:"stopSession",value:function(){var e=this;return this.stopStats(),this.rtcLogout(),this._stopSession(),this.stopRecord().catch(function(t){return e.logger.warn("webrtc-controller::停止音视频录制相关工作")}),this.resetStatus(),Promise.resolve()}},{key:"initRtcEvent",value:function(e){var t=this;e&&(e.on("sessionConnected",function(){t.emit("sessionConnected")}),e.on("getRemoteStream",this.onRemoteStream.bind(this)),e.on("iceCandidate",this.onLocalIceCandidate.bind(this)),e.on("negotiationneeded",this.onNegotiationNeeded.bind(this)),e.on("icestatechange",this.onIceStateChange.bind(this)),this.mediaDevices.getDevices().then(function(e){t.emit("devices",e)}))}},{key:"rtcLogin",value:function(){var e=this;return console.log("rtcLogin"),this.sendLocalMessage({isLogin:!0}),new Promise(function(t,n){e.once("LoginSuccess",function(n){e.logger.log("once LoginSuccess--\x3e",n),t()}),e.once("LoginFailed",function(t){e.logger.log("once LoginFailed--\x3e",t),n(t)})})}},{key:"rtcLogout",value:function(){var e={params:{content:{timestamp:Date.now()}}};this.sendMsg("logout",e)}},{key:"initRtc",value:function(e){return console.log("initRtc"),this.rtc?Promise.resolve():(this.rtc=new l.default({imInfo:this.imInfo,logger:this.logger,sessionConfig:this.sessionConfig,controller:this}),this.initRtcEvent(this.rtc),this.uploadDataRtcStart(),this.updateRtcStream(),this.startRtc(e))}},{key:"updateRtc",value:function(e){return 0===this.imInfo.role||"p2p"===this.imInfo.sessionMode||this.rtc?this.rtc?(this.updateRtcStream(),this.createOffer({isUpdate:!0,chromeShare:e&&e.chromeShare})):this.initRtc({isUpdate:!0,chromeShare:e&&e.chromeShare}):Promise.resolve()}},{key:"startRtc",value:function(e){var t=this,n=this.imInfo.sessionMode;return this.createOffer(e).then(function(){return new Promise(function(e,r){t.once("sessionConnected",function(n){t.logger.log("rtc connect success"),t.rtcConnected=!0,t.setSessionConfig({rtcEndTime:Date.now()}),e(n)}),t.once("rtcConnectError",function(e){t.uploadDataRtcStop(),r(e)}),"p2p"===n&&(t.userJoinTimeoutId=setTimeout(function(){r("user join timeout")},5e4))})}).catch(function(e){return Promise.reject(e)})}},{key:"sendMsg",value:function(e,t){var n={type:e,uid:this.imInfo.uid+"",cid:this.imInfo.cid+""};this.sessionDuration(e),n=Object.assign(n,t),this.signal&&this.logger.log("webrtc-controller::sendMsg ---\x3e "+e,n),this.signal&&this.signal.send(n)}},{key:"onSignalMessage",value:function(e){if(e&&e.cid&&e.uid&&(e.cid=+e.cid,e.uid=+e.uid),e.cid!==this.imInfo.cid)return this.logger.error("webrtc-controller::websocket message not belong to this session");var t=e.type;this["on"+t]&&this["on"+t](e)}},{key:"hangup",value:function(){this.stopSession(),null!==this.userJoinTimeoutId&&(clearTimeout(this.userJoinTimeoutId),this.userJoinTimeoutId=null),this.resetStatus()}},{key:"sessionDuration",value:function(e){if("client_login"===e&&"meeting"===this.imInfo.sessionMode&&(this.startSessionTime=this.startSessionTime?this.startSessionTime:Date.now()),"logout"===e){if(!this.startSessionTime)return void this.logger.log("没有通话开始时间异常");this.endSessionTime=Date.now();var t=this.endSessionTime-this.startSessionTime;this.emit("sessionDuration",t),this.startSessionTime=0,this.endSessionTime=0}}},{key:"resetReconnect",value:function(){this._stopSignal(),this.rtc&&"closed"!==this.rtc.signalingState&&this.rtc.close(),this.stopStats(),this.stopAudioMonitor(),this.destroyRemoteNode(),this.currRmoteOffer=null,this.rtc=null,this.rtcLogined=!1,this.rtcConnected=!1,this.remote_SdpOffers=[],this.remoteStreams={},this.remoteNode={},this.currRemoteTrack={},this.monitorRemoteStreamStartTime=null,this.userJoinTimeoutId=null}},{key:"onSignalTimeout",value:function(e){var t=this;if(this.logger.log("网络断开了!"),this.reConnectCount>=2)return this.logger.log("重连次数用尽失败!"),this.emit("reconnectFailed",0),this.stopSession(),void this.emit("signalClosed");this.reConnectCount++,this.emit("willReconnect",this.reConnectCount),this.resetReconnect(),1===this.reConnectCount?(this.logger.log("立即尝试第"+this.reConnectCount+"次重连服务器"),this.reConnectFc()):(this.logger.log("15s后尝试第"+this.reConnectCount+"次重连服务器"),setTimeout(function(){t.reConnectFc()},15e3))}},{key:"reConnectFc",value:function(){var e=this;return this.logger.log("开始重连"),this.imInfo&&this.imInfo.cid?this._startSession().then(function(t){return e.rtcLogin()}).then(function(t){e.startStats(),e.rtcLogined=!0;var n=e.mediaDevices.getDeviceStatus(),r=e.deviceAudioStatus&&n.hasAudio&&!e.imInfo.role||!1,i=e.deviceVideoStatus&&n.hasVideo&&!e.imInfo.role||!1;console.log("this.deviceAudioStatus",e.deviceAudioStatus),console.log("deviceStatus.hasAudio",n.hasAudio),console.log("this.imInfo.role",e.imInfo.role),(r||i)&&e.initRtc(),e.startAudioMonitor(),e.reConnectCount=0,e.logger.log("重连成功!"),e.emit("reconnectSuccess")}).catch(function(t){return e.emit("reconnectFailed",1),e.onSignalTimeout(),Promise.reject(t)}):(this.logger.log("缺失imInfocid,重连失败!",this.imInfo),this.stopSession(),void this.emit("signalClosed"))}},{key:"onlogin_ack",value:function(e){this.logger.log("onlogin_ack--\x3e",e);var t=e.params.auth_res-0;if(200!==t)return this.logger.warn("服务器验证不通过, 断开连接"),this.emit("LoginFailed",{code:t,error:"服务器验证不通过, 断开连接"}),void this.stopSession();this.logger.log("音视频服务器登录成功",e),this.emit("LoginSuccess")}},{key:"onclient_join",value:function(e){console.log("onclient_join, ",e),"p2p"===this.imInfo.sessionMode&&(this.userJoinTimeoutId&&clearTimeout(this.userJoinTimeoutId),this.userJoinTimeoutId=0,this.startSessionTime=Date.now()),this.emit("userJoined",{uid:e.params.client_id,cid:this.imInfo.cid})}},{key:"_onclient_join",value:function(e){if(this.remoteNode[e])return this._onclient_update(e,!0);var t=new l.default({imInfo:this.imInfo,logger:this.logger,sessionConfig:this.sessionConfig,targetUid:e,controller:this});this.initRtcEvent(t),this.remoteNode[e]={isAudioEnable:!1,isVideoEnable:!1,container:this.info.remoteContainer,rtc:t},this.createOffer({rtc:t})}},{key:"onclient_update",value:function(e){console.log("onclient_update, ",e,this.remoteNode[t]);var t=e.params.client_id,n=e.params,r=n.has_video,i=n.has_audio;if(this.emit("remoteStreamUpdate",{uid:t,audio:i,video:r}),this.remoteNode[t])return"Firefox"===y.prefix&&y.version-0>=59?this._delayVideoShow(t,r):this._onclient_update(t,r);!i&&!r||this.remoteNode[t]||this._onclient_join(t)}},{key:"_onclient_update",value:function(e,t){if(this.remoteNode[e]){var n=this.remoteNode[e].rtc;n&&(t?this.createOffer({rtc:n}):this.delayVideoShow(e,t))}else this._onclient_join(e)}},{key:"onclient_logout",value:function(e){var t=e.params.content.logout_type;t="normal"===t?u.constantRtc.HANGUP_TYPE_NORMAL:u.constantRtc.HANGUP_TYPE_TIMEOUT;var n=e.uid,r=e.cid;this.emit("leaveChannel",{uid:n,cid:r,type:t}),this.remoteNode.hasOwnProperty(n)&&(this.destroyRemoteNode(n),this.removeRemoteUserStream(n),this.rtcRecorder&&this.rtcRecorder.leave({uid:n}))}},{key:"startAudioMonitor",value:function(){var e=this.audioMonitorTimer;e||(e=this.audioMonitorTimer=setInterval(function(){var e={},t=0;this.localAudioStream&&(t=this.localAudioStream.getAudioVolume());e.self={status:t},this.uploadDataRtc("volume",e.self.status);var n=this.remoteNode;for(var r in n){var i=this.info.client.getAccountWithUid(r);t=n[r]&&n[r].remoteAudioStream?n[r].remoteAudioStream.getAudioVolume():0,e[i||r]={status:t}}this.emit("audioVolume",e)}.bind(this),500))}},{key:"stopAudioMonitor",value:function(){var e=this.audioMonitorTimer;e&&(clearInterval(e),e=this.audioMonitorTimer=null)}}]),t}(s.default),b=S.prototype;b=Object.assign(b,p.default),b=Object.assign(b,f.default),b=Object.assign(b,m.default),b=Object.assign(b,h.default),b=Object.assign(b,v.default),t.default=S,e.exports=t.default},function(e,t,n){var r=function(){return this}()||Function("return this")(),i=r.regeneratorRuntime&&Object.getOwnPropertyNames(r).indexOf("regeneratorRuntime")>=0,o=i&&r.regeneratorRuntime;if(r.regeneratorRuntime=void 0,e.exports=n(301),i)r.regeneratorRuntime=o;else try{delete r.regeneratorRuntime}catch(e){r.regeneratorRuntime=void 0}},function(e,t){!function(t){"use strict";var n,r=Object.prototype,i=r.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag",u="object"==typeof e,d=t.regeneratorRuntime;if(d)u&&(e.exports=d);else{(d=t.regeneratorRuntime=u?e.exports:{}).wrap=b;var l="suspendedStart",p="suspendedYield",f="executing",h="completed",m={},v={};v[a]=function(){return this};var g=Object.getPrototypeOf,y=g&&g(g(A([])));y&&y!==r&&i.call(y,a)&&(v=y);var S=R.prototype=_.prototype=Object.create(v);T.prototype=S.constructor=R,R.constructor=T,R[c]=T.displayName="GeneratorFunction",d.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===T||"GeneratorFunction"===(t.displayName||t.name))},d.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,R):(e.__proto__=R,c in e||(e[c]="GeneratorFunction")),e.prototype=Object.create(S),e},d.awrap=function(e){return{__await:e}},w(k.prototype),k.prototype[s]=function(){return this},d.AsyncIterator=k,d.async=function(e,t,n,r){var i=new k(b(e,t,n,r));return d.isGeneratorFunction(t)?i:i.next().then(function(e){return e.done?e.value:i.next()})},w(S),S[c]="Generator",S[a]=function(){return this},S.toString=function(){return"[object Generator]"},d.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},d.values=A,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=n,this.done=!1,this.delegate=null,this.method="next",this.arg=n,this.tryEntries.forEach(O),!e)for(var t in this)"t"===t.charAt(0)&&i.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=n)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(r,i){return s.type="throw",s.arg=e,t.next=r,i&&(t.method="next",t.arg=n),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var c=i.call(a,"catchLoc"),u=i.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,m):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),O(n),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;O(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:A(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=n),m}}}function b(e,t,n,r){var i=t&&t.prototype instanceof _?t:_,o=Object.create(i.prototype),a=new I(r||[]);return o._invoke=function(e,t,n){var r=l;return function(i,o){if(r===f)throw new Error("Generator is already running");if(r===h){if("throw"===i)throw o;return x()}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var s=E(a,n);if(s){if(s===m)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===l)throw r=h,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=f;var c=C(e,t,n);if("normal"===c.type){if(r=n.done?h:p,c.arg===m)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r=h,n.method="throw",n.arg=c.arg)}}}(e,n,a),o}function C(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}function _(){}function T(){}function R(){}function w(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function k(e){var t;this._invoke=function(n,r){function o(){return new Promise(function(t,o){!function t(n,r,o,a){var s=C(e[n],e,r);if("throw"!==s.type){var c=s.arg,u=c.value;return u&&"object"==typeof u&&i.call(u,"__await")?Promise.resolve(u.__await).then(function(e){t("next",e,o,a)},function(e){t("throw",e,o,a)}):Promise.resolve(u).then(function(e){c.value=e,o(c)},a)}a(s.arg)}(n,r,t,o)})}return t=t?t.then(o,o):o()}}function E(e,t){var r=e.iterator[t.method];if(r===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=n,E(e,t),"throw"===t.method))return m;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return m}var i=C(r,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,m;var o=i.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=n),t.delegate=null,m):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,m)}function P(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function O(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(P,this),this.reset(!0)}function A(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,o=function t(){for(;++r<e.length;)if(i.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=n,t.done=!0,t};return o.next=o}}return{next:x}}function x(){return{value:n,done:!0}}}(function(){return this}()||Function("return this")())},function(e,t,n){e.exports={default:n(303),__esModule:!0}},function(e,t,n){n(71),n(51),n(60),n(304),n(312),n(313),e.exports=n(4).Promise},function(e,t,n){"use strict";var r,i,o,a,s=n(20),c=n(1),u=n(43),d=n(105),l=n(13),p=n(11),f=n(59),h=n(305),m=n(306),v=n(201),g=n(202).set,y=n(308)(),S=n(151),b=n(203),C=n(309),_=n(204),T=c.TypeError,R=c.process,w=R&&R.versions,k=w&&w.v8||"",E=c.Promise,P="process"==d(R),O=function(){},I=i=S.f,A=!!function(){try{var e=E.resolve(1),t=(e.constructor={})[n(2)("species")]=function(e){e(O,O)};return(P||"function"==typeof PromiseRejectionEvent)&&e.then(O)instanceof t&&0!==k.indexOf("6.6")&&-1===C.indexOf("Chrome/66")}catch(e){}}(),x=function(e){var t;return!(!p(e)||"function"!=typeof(t=e.then))&&t},M=function(e,t){if(!e._n){e._n=!0;var n=e._c;y(function(){for(var r=e._v,i=1==e._s,o=0,a=function(t){var n,o,a,s=i?t.ok:t.fail,c=t.resolve,u=t.reject,d=t.domain;try{s?(i||(2==e._h&&j(e),e._h=1),!0===s?n=r:(d&&d.enter(),n=s(r),d&&(d.exit(),a=!0)),n===t.promise?u(T("Promise-chain cycle")):(o=x(n))?o.call(n,c,u):c(n)):u(r)}catch(e){d&&!a&&d.exit(),u(e)}};n.length>o;)a(n[o++]);e._c=[],e._n=!1,t&&!e._h&&D(e)})}},D=function(e){g.call(c,function(){var t,n,r,i=e._v,o=L(e);if(o&&(t=b(function(){P?R.emit("unhandledRejection",i,e):(n=c.onunhandledrejection)?n({promise:e,reason:i}):(r=c.console)&&r.error&&r.error("Unhandled promise rejection",i)}),e._h=P||L(e)?2:1),e._a=void 0,o&&t.e)throw t.v})},L=function(e){return 1!==e._h&&0===(e._a||e._c).length},j=function(e){g.call(c,function(){var t;P?R.emit("rejectionHandled",e):(t=c.onrejectionhandled)&&t({promise:e,reason:e._v})})},N=function(e){var t=this;t._d||(t._d=!0,(t=t._w||t)._v=e,t._s=2,t._a||(t._a=t._c.slice()),M(t,!0))},V=function(e){var t,n=this;if(!n._d){n._d=!0,n=n._w||n;try{if(n===e)throw T("Promise can't be resolved itself");(t=x(e))?y(function(){var r={_w:n,_d:!1};try{t.call(e,u(V,r,1),u(N,r,1))}catch(e){N.call(r,e)}}):(n._v=e,n._s=1,M(n,!1))}catch(e){N.call({_w:n,_d:!1},e)}}};A||(E=function(e){h(this,E,"Promise","_h"),f(e),r.call(this);try{e(u(V,this,1),u(N,this,1))}catch(e){N.call(this,e)}},(r=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=n(310)(E.prototype,{then:function(e,t){var n=I(v(this,E));return n.ok="function"!=typeof e||e,n.fail="function"==typeof t&&t,n.domain=P?R.domain:void 0,this._c.push(n),this._a&&this._a.push(n),this._s&&M(this,!1),n.promise},catch:function(e){return this.then(void 0,e)}}),o=function(){var e=new r;this.promise=e,this.resolve=u(V,e,1),this.reject=u(N,e,1)},S.f=I=function(e){return e===E||e===a?new o(e):i(e)}),l(l.G+l.W+l.F*!A,{Promise:E}),n(31)(E,"Promise"),n(311)("Promise"),a=n(4).Promise,l(l.S+l.F*!A,"Promise",{reject:function(e){var t=I(this);return(0,t.reject)(e),t.promise}}),l(l.S+l.F*(s||!A),"Promise",{resolve:function(e){return _(s&&this===a?E:this,e)}}),l(l.S+l.F*!(A&&n(136)(function(e){E.all(e).catch(O)})),"Promise",{all:function(e){var t=this,n=I(t),r=n.resolve,i=n.reject,o=b(function(){var n=[],o=0,a=1;m(e,!1,function(e){var s=o++,c=!1;n.push(void 0),a++,t.resolve(e).then(function(e){c||(c=!0,n[s]=e,--a||r(n))},i)}),--a||r(n)});return o.e&&i(o.v),n.promise},race:function(e){var t=this,n=I(t),r=n.reject,i=b(function(){m(e,!1,function(e){t.resolve(e).then(n.resolve,r)})});return i.e&&r(i.v),n.promise}})},function(e,t){e.exports=function(e,t,n,r){if(!(e instanceof t)||void 0!==r&&r in e)throw TypeError(n+": incorrect invocation!");return e}},function(e,t,n){var r=n(43),i=n(134),o=n(135),a=n(10),s=n(63),c=n(111),u={},d={};(t=e.exports=function(e,t,n,l,p){var f,h,m,v,g=p?function(){return e}:c(e),y=r(n,l,t?2:1),S=0;if("function"!=typeof g)throw TypeError(e+" is not iterable!");if(o(g)){for(f=s(e.length);f>S;S++)if((v=t?y(a(h=e[S])[0],h[1]):y(e[S]))===u||v===d)return v}else for(m=g.call(e);!(h=m.next()).done;)if((v=i(m,y,h.value,t))===u||v===d)return v}).BREAK=u,t.RETURN=d},function(e,t){e.exports=function(e,t,n){var r=void 0===n;switch(t.length){case 0:return r?e():e.call(n);case 1:return r?e(t[0]):e.call(n,t[0]);case 2:return r?e(t[0],t[1]):e.call(n,t[0],t[1]);case 3:return r?e(t[0],t[1],t[2]):e.call(n,t[0],t[1],t[2]);case 4:return r?e(t[0],t[1],t[2],t[3]):e.call(n,t[0],t[1],t[2],t[3])}return e.apply(n,t)}},function(e,t,n){var r=n(1),i=n(202).set,o=r.MutationObserver||r.WebKitMutationObserver,a=r.process,s=r.Promise,c="process"==n(32)(a);e.exports=function(){var e,t,n,u=function(){var r,i;for(c&&(r=a.domain)&&r.exit();e;){i=e.fn,e=e.next;try{i()}catch(r){throw e?n():t=void 0,r}}t=void 0,r&&r.enter()};if(c)n=function(){a.nextTick(u)};else if(!o||r.navigator&&r.navigator.standalone)if(s&&s.resolve){var d=s.resolve(void 0);n=function(){d.then(u)}}else n=function(){i.call(r,u)};else{var l=!0,p=document.createTextNode("");new o(u).observe(p,{characterData:!0}),n=function(){p.data=l=!l}}return function(r){var i={fn:r,next:void 0};t&&(t.next=i),e||(e=i,n()),t=i}}},function(e,t,n){var r=n(1).navigator;e.exports=r&&r.userAgent||""},function(e,t,n){var r=n(9);e.exports=function(e,t,n){for(var i in t)n&&e[i]?e[i]=t[i]:r(e,i,t[i]);return e}},function(e,t,n){"use strict";var r=n(1),i=n(4),o=n(6),a=n(8),s=n(2)("species");e.exports=function(e){var t="function"==typeof i[e]?i[e]:r[e];a&&t&&!t[s]&&o.f(t,s,{configurable:!0,get:function(){return this}})}},function(e,t,n){"use strict";var r=n(13),i=n(4),o=n(1),a=n(201),s=n(204);r(r.P+r.R,"Promise",{finally:function(e){var t=a(this,i.Promise||o.Promise),n="function"==typeof e;return this.then(n?function(n){return s(t,e()).then(function(){return n})}:e,n?function(n){return s(t,e()).then(function(){throw n})}:e)}})},function(e,t,n){"use strict";var r=n(13),i=n(151),o=n(203);r(r.S,"Promise",{try:function(e){var t=i.f(this),n=o(e);return(n.e?t.reject:t.resolve)(n.v),t.promise}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=u(n(118)),i=u(n(119)),o=u(n(14)),a=u(n(27)),s=u(n(28)),c=u(n(150));function u(e){return e&&e.__esModule?e:{default:e}}var d=function(e){function t(){(0,o.default)(this,t);var e=(0,a.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.init(),e}return(0,s.default)(t,e),t}(n(25));t.default=d;var l=d.prototype;l.init=function(){if(this.getDevices().catch(function(e){console.warn(e)}),navigator.mediaDevices&&navigator.mediaDevices.addEventListener){var e=void 0,t=this;navigator.mediaDevices.ondevicechange=function(n){e&&(clearTimeout(e),e=null);var r=Object.assign({},t.devicesCache);e=setTimeout(function(){e=null,t.getDevices(!0).then(function(){t.emit("deviceStatus",t.devicesCache),t.filterDeviceChange(t.devicesCache,r)}).catch(function(){})},500)}}},l.filterDeviceChange=function(e,t){function n(e){var t={};return Object.keys(e).forEach(function(n){e[n].forEach(function(e){t[n+e.deviceId]=Object.assign({},e,{type:n})})}),t}var r=n(e),i=n(t),o=Object.keys(r),a=Object.keys(i);if(o.length>a.length){var s=[];o.forEach(function(e){-1===a.indexOf(e)&&s.push(r[e])}),s.length&&this.emit("deviceAdd",s)}else{var c=[];a.forEach(function(e){-1===o.indexOf(e)&&c.push(i[e])}),c.length&&this.emit("deviceRemove",c)}},l.getDevicesOfType=function(e){return void 0!==e?this.getDevices().then(function(t){return[t[e]]}):this.getDevices()},l.getDevices=function(e){var t=this,n=void 0;return!e&&this.devicesCache?Promise.resolve(this.devicesCache):new Promise(function(e,o){var a=this;(0,i.default)(r.default.mark(function i(){return r.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,c.default.getDevices().catch(function(e){return o(e)});case 2:if(n=r.sent){r.next=5;break}return r.abrupt("return",o("没有找到可用设备"));case 5:return t.devicesCache=n,r.abrupt("return",e(n));case 7:case"end":return r.stop()}},i,a)}))()})},l.getDeviceStatus=function(){return{hasAudio:this.devicesCache&&this.devicesCache.audioIn.length>0||!1,hasVideo:this.devicesCache&&this.devicesCache.video.length>0||!1}},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=c(n(14)),i=c(n(50)),o=c(n(27)),a=c(n(28)),s=c(n(205));function c(e){return e&&e.__esModule?e:{default:e}}var u={},d=function(e){function t(){(0,r.default)(this,t);var e=(0,o.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.recordedChunks=[],e.isRecording=!1,e.contentTypes=["video/mp4;codecs=opus","video/webm","video/webm;codecs=h264","video/x-matroska;codecs=opus","video/invalid"],e}return(0,a.default)(t,e),(0,i.default)(t,[{key:"validation",value:function(e){return e.filter(function(e){return MediaRecorder.isTypeSupported(e)})}},{key:"format",value:function(){var e=this,t=this.stream,n=this.option;return new Promise(function(r,i){if(/(LocalMediaStream|MediaStream)/.test(t.constructor)&&(t=[t]),t.constructor!==Array)return i("音视频录制输入错误");if("audio"===n.type)return e.audioController=new s.default({stream:t,uid:e.uid}),e.opStream=e.audioController.outputStream,window.audios=e.opStream,r();var o=new MediaStream;if(t.forEach(function(e){e&&/(LocalMediaStream|MediaStream)/.test(e.constructor)&&e.getTracks().forEach(function(e){o.addTrack(e)})}),0===o.getTracks().length)return i("当前没有任何音视频数据，无法进行录制");e.opStream=o,r()})}},{key:"start",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{type:"video"};return n.uid||n.account?e?window.MediaRecorder&&MediaRecorder.isTypeSupported?(this.stream=e,this.option=n,"audio"===n.type&&(this.contentTypes=["audio/wav","audio/ogg","audio/pcm","audio/webm"]),(this.mimeType=this.validation(this.contentTypes)[0])?this.isRecording?Promise.reject("音视频正在录制中，请勿重复操作"):this.format().then(function(){return t._start()}).catch(function(e){return Promise.reject(e)}):Promise.reject("当前浏览器不支持对应格式的视频录制")):Promise.reject("当前浏览器不支持音视频录制功能"):Promise.reject("获取视频流失败"):Promise.reject("需要录制的帐号缺失")}},{key:"_start",value:function(){var e={audioBitsPerSecond:128e3,videoBitsPerSecond:25e5,mimeType:this.mimeType},t=this.recorder=new MediaRecorder(this.opStream,e);return t.ondataavailable=this.ondataavailable.bind(this),t.onstop=this.onstop.bind(this),this.isRecording=!0,this.status="started",this.recorder.start(),this.startTimer(),Promise.resolve(this.option)}},{key:"stop",value:function(e){if(!this.isRecording||!this.recorder)return Promise.reject("请先开启音视频录制");if(this.status="stopped",u.log("MediaRecorder: stop event",this.recorder.state),"inactive"===this.recorder.state)return u.warn("MediaRecorder already stopped:",this.recorder.state),Promise.reject("音视频录制已结束，请勿重复操作");var t=(this.option.account||this.option.uid)+"--"+Date.now()+"--"+(this.option.type||"video");return this.fileName=e||t,this.recorder.stop(),Promise.resolve()}},{key:"leave",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.isRecording&&this.recorder){var t=e.uid;t&&this.option&&this.option&&t===+this.option.uid&&this.stop()}}},{key:"ondataavailable",value:function(e){if(u.log("MediaRecorder: data received"),!(e.data.size>0))return this.stop(),Promise.reject("获取视频流失败");this.recordedChunks.push(e.data)}},{key:"onstop",value:function(){if(u.log("MediaRecorder: onstop"),"stopped"!==this.status)return this._start();var e=new Blob(this.recordedChunks,{type:this.mimeType}),t=URL.createObjectURL(e),n=document.createElement("a");document.body.appendChild(n),n.style="display: none",n.href=t,n.download=(this.fileName||Date.now())+".webm",n.click(),window.URL.revokeObjectURL(t),this.destroy(),this.clearTimer(),this.emit("stopRecord")}},{key:"pause",value:function(){this.recorder&&this.recorder.pause()}},{key:"resume",value:function(){this.recorder&&this.recorder.resume()}},{key:"destroy",value:function(){this.stream=null,this.recorder=null,this.recordedChunks=[],this.isRecording=!1,this.audioController&&this.audioController.destroy(),this.audioController=null,this.fileName=this.fileNameDefault="",this.option={},this.status=""}},{key:"startTimer",value:function(){var e=this;this.timer||(this.timer=setInterval(function(){u.log((new Date).toLocaleString()+" --\x3e MediaRecorder status: "+e.recorder.state)},2e3))}},{key:"clearTimer",value:function(){this.timer&&(clearInterval(this.timer),this.timer=null)}}],[{key:"init",value:function(e){u=e||window.Logger}}]),t}(n(25));t.default=d,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){return e&&e.__esModule?e:{default:e}}(n(206));var i=n(317),o=null,a={},s={};t.default={init:function(e){o=r.default.checkVersion(),s=e||window.console},fnShake:function(e){var t=this,n=e.fn,r=e.peer,i=void 0===r?{}:r;if(n)return i.id||(i.id=Object.keys(a).length+1),n="_"+n,a[i.id]||(a[i.id]={}),a[i.id]&&a[i.id][n]&&(s.log("destroy "+n+" timer"),clearTimeout(a[i.id][n]),a[i.id][n]=null),s.log("create "+n+" timer"),new Promise(function(r,o){a[i.id][n]=setTimeout(function(){a[i.id][n]=null,r(t[n](e))},200)})},createOffer:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.fnShake({peer:e,fn:"createOffer"})},_createOffer:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).peer;s.log("------ do createoffer ------");if(e.uid-e.targetUid!=0){var t=e.getLocalStreams(),n=t[0]&&t[0].getTracks()||!1;n&&0!==n.length||e.addTransceiver&&"Safari"===o.prefix&&(e.addTransceiver("audio"),e.addTransceiver("video"))}return e.createOffer({offerToReceiveVideo:1,offerToReceiveAudio:1})},formatSdp:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.offerOrAnswer,r=t.uid,o=t.highAudio,a=t.stero,c=t.targetUid,u=t.isHight,d=t.stream||new MediaStream,l=n.sdp,p=n.type,f=[],h=[];!/h264/i.test(l)&&/Chrome/gi.test(navigator.userAgent)&&alert("该机型不支持H264编码");var m=i.parse(l);s.log(c+" 原始sdp "+p+" \n",l),s.log(m);var v=d.getAudioTracks()[0],g=d.getVideoTracks()[0];return m.rtcpxr="rcvr-rtt=all:10000",m.media&&m.media.map(function(t,i){if(t.candidates&&delete t.candidates,t.direction=c!==r?"recvonly":/recvonly/.test(t.direction)?"recvonly":"sendonly",(/audio/.test(t.type)&&!v||/video/.test(t.type)&&!g)&&delete t.ssrcs&&delete t.ssrcGroups&&delete t.msid,"audio"===t.type&&(h.push(t.mid),t),"video"===t.type&&g){var s=[];t.rtp&&t.rtp.length&&t.rtp.map(function(e){"H264"===e.codec&&s.push(e.payload)}),t.fmtp&&t.fmtp.length&&t.fmtp.map(function(e){-1!=s.indexOf(e.payload)&&e.config&&-1===e.config.indexOf("x-google-min-bitrate=1024")&&u&&(e.config+=";x-google-min-bitrate=1024"),-1!=s.indexOf(e.payload)&&e.config&&-1!==e.config.indexOf("x-google-min-bitrate=1024")&&!u&&(e.config=e.config.replace(";x-google-min-bitrate=1024",""))}),t.ssrcs.map(function(e){/^label$/.test(e.attribute)&&e.value!==g.id&&f.push(e.id)})}if("audio"===t.type&&(t.ptime=60,t.maxptime=60,t.fmtp&&t.fmtp.length)){var d=!1,l=o?48e3:16e3,p={payload:"",type:"nack"};t.rtp.map(function(e){"opus"===e.codec&&(p.payload=e.payload)}),t.rtcpFb&&t.rtcpFb.length?t.rtcpFb.push(p):t.rtcpFb=[p],t.fmtp.map(function(e){e.config&&-1!==e.config.indexOf("minptime=")&&(e.config=e.config.replace(/minptime=\d+/,"minptime=60")),e.config&&-1!==e.config.indexOf("sprop-maxcapturerate=")&&-1!==e.config.indexOf("maxplaybackrate")&&(d=!0,e.config=e.config.replace(/sprop-maxcapturerate=\d+/,"sprop-maxcapturerate="+l),e.config=e.config.replace(/maxplaybackrate=\d+/,"maxplaybackrate="+l)),d||(e.config+=";maxplaybackrate="+l+";sprop-maxcapturerate="+l),a&&(e.config+=";maxaveragebitrate=131072;stereo=1;sprop-stereo=1;cbr=1")})}if("offer"===n.type){var y=t.mid;m.groups&&m.groups.map(function(e){var n=e.mids.split(" ");-1!==n.indexOf(y)&&(n.splice(n.indexOf(y),1,t.mid),e.mids=n.join(" "))})}t.fmtp=e.limitFrame(t.fmtp)}),n.sdp=i.write(m),f.length>0&&f.map(function(e){var t=new RegExp("a=ssrc:"+e+".+\\r\\n","gi");n.sdp=n.sdp.replace(t,"")}),n},limitFrame:function(e){return e.map(function(e){/42e01f/gi.test(e.config)&&(e.config+=";max-fs=12288")}),e},setMediaBitrates:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.sdp,n=e.bit,r=void 0===n?{}:n,o=r.video,a=void 0===o?500:o,s=r.audio,c=void 0===s?500:s,u=i.parse(t);return u.media&&u.media.map(function(e,t){e.bandwidth=[{type:navigator.mozGetUserMedia?"TIAS":"AS",limit:"audio"===e.type?c:a}]}),i.write(u)},formatSSRCChrome:function(e,t,n){return e.map(function(e,r){return e.id=t+"0"+n+"0"+Math.floor(r/4),e.id-=0,e})},formatSSRCFirefox:function(e,t,n){return e.map(function(e,r){return e.id=t+"0"+n+"0"+Math.floor(r/4),e.id-=0,e})},formatSdpRemote:function(e,t,n){return/Chrome/gi.test(navigator.userAgent)?this.formatSdpRemoteChrome(e,t,n):this.formatSdpRemoteFirefox(e,t,n)},formatSdpRemoteChrome:function(e,t,n){return-1===(e=e.replace(/a=msid:.+\r\na=ssrc:\d+ cname:.+/gi,function(e,t){var n=e.match(/a=ssrc:(\d+)/),r=e.match(/a=msid:(.+) (.+)/);return n[1]&&(e=e.replace("a=msid","a=ssrc:"+n[1]+" msid")),r[1]&&n[1]&&(e=e+"\r\na=ssrc:"+n[1]+" mslabel:"+r[1]),r[2]&&n[1]&&(e=e+"\r\na=ssrc:"+n[1]+" label:"+r[2]),e})).indexOf("b=AS:1024")&&n&&(e+="b=AS:1024\r\n"),s.log("formated: \n",e),e},formatSdpRemoteFirefox:function(e,t,n){if(e=e.replace(/\r\na=msid:.+\r\na=ssrc:\d+ cname:.+/gi,function(e,t){var n=e.match(/\r\na=ssrc:\d+ cname:.+/);return e=(e=e.replace(/a=ssrc:\d+ cname:.+/,"")).replace("a=msid",n[0]+"\r\na=msid")}),t&&t.sdp){var r=i.parse(e),o=i.parse(t.sdp);r.media.length,o.media.length}return s.log("formated: \n",e),e},parse:function(e){var t=i.parse(e);s.log(t)},updateMediaStream:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.fn="updateMediaStream",this.fnShake(e)},_updateMediaStream:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.peer,n=e.currStream,r=e.streams,i=void 0===r?[]:r,o=this.checkCurrStream(t),a={},c=t,u=n||new MediaStream;i.map(function(e){e.getTracks().map(function(e){console.log("_updateMediaStream newTracks",e),a[e.id]=e})});var d=Object.keys(o.tracks).filter(function(e){return!a[e]});console.warn("webrtc-rtc::获取移除的列表",d);var l=Object.keys(a).filter(function(e){return!o.tracks[e]});return console.log("webrtc-rtc::获取新加的列表",l),d&&d.map(function(e){var t=o.tracks[e].sender,n=o.tracks[e].track;s.warn("remove old track",t,n),u.removeTrack(n),c.removeTrack(t)}),l&&l.map(function(e){var t=a[e];s.log("add new track",t),u.addTrack(t),c.addTrack(t,u)}),this.checkCurrStream(t),Promise.resolve(u)},removeTrack:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.peer,n=e.currStream,r=e.tracks,i=void 0===r?[]:r;if(0!==i.length){var o=this.checkCurrStream(t);i.map(function(e){o.tracks[e.id]&&(console.log("====remove track",e,e.readyState,o.tracks[e.id].sender),n.removeTrack(e),t.removeTrack(o.tracks[e.id].sender))})}},checkCurrStream:function(e){var t={},n=[],r=e.getSenders();return r.map(function(e){var r=e.track;r?(t[r.id]={sender:e,track:r},s.log(" --\x3e track id:",r.kind+":"+r.id)):n.push(e)}),{tracks:t,empty:n}},checkMediaStatus:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.audio,n=e.video,r=e.sdp,o=e.uid,a={audio:!1,video:!1},c=i.parse(r),u=t&&t.getAudioTracks()[0],d=n&&n.getVideoTracks()[0];return s.log(o+" checkMediaStatus ----\x3e track status",c),u&&s.log("webrtc::checkMediaStatus audioTrack ----\x3e ",u),d&&s.log("webrtc::checkMediaStatus videoTrack ----\x3e ",d),a.audio=u&&"ended"!==u.readyState&&new RegExp(u.id).test(r),a.video=d&&"ended"!==d.readyState&&new RegExp(d.id).test(r),a},validMediaStream:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.sdp,n=e.msid,r=e.trackid;if(!n||!r)return!1;var i=!1;return n&&(i=new RegExp(n).test(t)),i?(r&&(i=new RegExp(r).test(t)),i):i}},e.exports=t.default},function(e,t,n){var r=n(318),i=n(319);t.write=i,t.parse=r.parse,t.parseFmtpConfig=r.parseFmtpConfig,t.parseParams=r.parseParams,t.parsePayloads=r.parsePayloads,t.parseRemoteCandidates=r.parseRemoteCandidates,t.parseImageAttributes=r.parseImageAttributes,t.parseSimulcastStreamList=r.parseSimulcastStreamList},function(e,t,n){var r=function(e){return String(Number(e))===e?Number(e):e},i=function(e,t,n){var i=e.name&&e.names;e.push&&!t[e.push]?t[e.push]=[]:i&&!t[e.name]&&(t[e.name]={});var o=e.push?{}:i?t[e.name]:t;!function(e,t,n,i){if(i&&!n)t[i]=r(e[1]);else for(var o=0;o<n.length;o+=1)null!=e[o+1]&&(t[n[o]]=r(e[o+1]))}(n.match(e.reg),o,e.names,e.name),e.push&&t[e.push].push(o)},o=n(207),a=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(e){var t={},n=[],r=t;return e.split(/(\r\n|\r|\n)/).filter(a).forEach(function(e){var t=e[0],a=e.slice(2);"m"===t&&(n.push({rtp:[],fmtp:[]}),r=n[n.length-1]);for(var s=0;s<(o[t]||[]).length;s+=1){var c=o[t][s];if(c.reg.test(a))return i(c,r,a)}}),t.media=n,t};var s=function(e,t){var n=t.split(/=(.+)/,2);return 2===n.length&&(e[n[0]]=r(n[1])),e};t.parseParams=function(e){return e.split(/\;\s?/).reduce(s,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(e){return e.split(" ").map(Number)},t.parseRemoteCandidates=function(e){for(var t=[],n=e.split(" ").map(r),i=0;i<n.length;i+=3)t.push({component:n[i],ip:n[i+1],port:n[i+2]});return t},t.parseImageAttributes=function(e){return e.split(" ").map(function(e){return e.substring(1,e.length-1).split(",").reduce(s,{})})},t.parseSimulcastStreamList=function(e){return e.split(";").map(function(e){return e.split(",").map(function(e){var t,n=!1;return"~"!==e[0]?t=r(e):(t=r(e.substring(1,e.length)),n=!0),{scid:t,paused:n}})})}},function(e,t,n){var r=n(207),i=/%[sdv%]/g,o=function(e,t,n){var r=[e+"="+(t.format instanceof Function?t.format(t.push?n:n[t.name]):t.format)];if(t.names)for(var o=0;o<t.names.length;o+=1){var a=t.names[o];t.name?r.push(n[t.name][a]):r.push(n[t.names[o]])}else r.push(n[t.name]);return function(e){var t=1,n=arguments,r=n.length;return e.replace(i,function(e){if(t>=r)return e;var i=n[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(i);case"%d":return Number(i);case"%v":return""}})}.apply(null,r)},a=["v","o","s","i","u","e","p","c","b","t","r","z","a"],s=["i","c","b","a"];e.exports=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach(function(e){null==e.payloads&&(e.payloads="")});var n=t.outerOrder||a,i=t.innerOrder||s,c=[];return n.forEach(function(t){r[t].forEach(function(n){n.name in e&&null!=e[n.name]?c.push(o(t,n,e)):n.push in e&&null!=e[n.push]&&e[n.push].forEach(function(e){c.push(o(t,n,e))})})}),e.media.forEach(function(e){c.push(o("m",r.m[0],e)),i.forEach(function(t){r[t].forEach(function(n){n.name in e&&null!=e[n.name]?c.push(o(t,n,e)):n.push in e&&null!=e[n.push]&&e[n.push].forEach(function(e){c.push(o(t,n,e))})})})}),c.join("\r\n")+"\r\n"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){return e&&e.__esModule?e:{default:e}}(n(321));t.default={randomSSRC:function(){var e=Math.floor(1e8*Math.random())+1e7;return e>1e8?99999999:e},_createLocalDescription:function(e,t){var n={},i=this._iceGatherer.getLocalParameters(),o=this._iceGatherer.getLocalCandidates(),a=this._dtlsTransport.getLocalParameters(),s=this._dtlsTransport.getRemoteParameters(),c=this._localCapabilities,u=this._localTrackInfos;"offer"===t&&this._sdpGlobalFields.version++,n.version=0,n.origin={address:"127.0.0.1",ipVer:4,netType:"IN",sessionId:this._sdpGlobalFields.id,sessionVersion:this._sdpGlobalFields.version,username:"jitsi-ortc-webrtc-shim"},n.name="-",n.timing={start:0,stop:0},n.msidSemantic={semantic:"WMS",token:"*"},n.groups=[{mids:Array.from(this._mids.keys()).join(" "),type:"BUNDLE"}],n.media=[],n.fingerprint={hash:a.fingerprints[0].value,type:a.fingerprints[0].algorithm};var d=!1,l=!0,p=!1,f=void 0;try{for(var h,m=c.codecs[Symbol.iterator]();!(l=(h=m.next()).done);l=!0){var v=h.value;if("video"===v.kind&&"rtx"===v.name){d=!0;break}}}catch(e){p=!0,f=e}finally{try{!l&&m.return&&m.return()}finally{if(p)throw f}}var g=!0,y=!1,S=void 0;try{for(var b,C=this._mids[Symbol.iterator]();!(g=(b=C.next()).done);g=!0){var _=b.value,T=(0,r.default)(_,2),R=T[0],w=T[1];k.call(this,R,w)}}catch(e){y=!0,S=e}finally{try{!g&&C.return&&C.return()}finally{if(y)throw S}}return new RTCSessionDescription({type:t,_sdpObject:n});function k(e,r){var a={};switch(a.type=r,r){case"audio":case"video":a.protocol="RTP/SAVPF",a.port=9,a.direction="sendrecv";break;case"application":a.protocol="DTLS/SCTP",a.port=0,a.payloads="0",a.direction="inactive"}a.connection={ip:"127.0.0.1",version:4},a.mid=e,a.iceUfrag=i.usernameFragment,a.icePwd=i.password,a.candidates=[];var l=!0,p=!1,f=void 0;try{for(var h,m=o[Symbol.iterator]();!(l=(h=m.next()).done);l=!0){var v=h.value,g={component:1};g.foundation=v.foundation,g.ip=v.ip,g.port=v.port,g.priority=v.priority,g.transport=v.protocol.toLowerCase(),g.type=v.type,"tcp"===g.transport&&(g.tcptype=v.tcpType),a.candidates.push(g)}}catch(e){p=!0,f=e}finally{try{!l&&m.return&&m.return()}finally{if(p)throw f}}if(a.endOfCandidates="end-of-candidates",a.setup="offer"===t?"actpass":"server"===s.role?"active":"passive","audio"===r||"video"===r){a.rtp=[],a.rtcpFb=[],a.fmtp=[];var y=[],S=!0,b=!1,C=void 0;try{for(var _,T=c.codecs[Symbol.iterator]();!(S=(_=T.next()).done);S=!0){var R=_.value;if(!R.kind||R.kind===r){y.push(R.preferredPayloadType);var w={codec:R.name,payload:R.preferredPayloadType,rate:R.clockRate};if(R.numChannels>1&&(w.encoding=R.numChannels),a.rtp.push(w),R.parameters){var k={config:"",payload:R.preferredPayloadType},E=!0,P=!1,O=void 0;try{for(var I,A=Object.keys(R.parameters)[Symbol.iterator]();!(E=(I=A.next()).done);E=!0){var x=I.value;k.config&&(k.config+=";"),k.config+=x+"="+R.parameters[x]}}catch(e){P=!0,O=e}finally{try{!E&&A.return&&A.return()}finally{if(P)throw O}}k.config&&a.fmtp.push(k)}var M=!0,D=!1,L=void 0;try{for(var j,N=(R.rtcpFeedback||[])[Symbol.iterator]();!(M=(j=N.next()).done);M=!0){var V=j.value;a.rtcpFb.push({payload:R.preferredPayloadType,subtype:V.parameter||void 0,type:V.type})}}catch(e){D=!0,L=e}finally{try{!M&&N.return&&N.return()}finally{if(D)throw L}}}}}catch(e){b=!0,C=e}finally{try{!S&&T.return&&T.return()}finally{if(b)throw C}}0===y.length?(a.payloads="9",a.port=0,a.direction="inactive"):a.payloads=y.join(" "),a.ssrcs=[],a.ssrcGroups=[];var U=!0,F=!1,B=void 0;try{for(var H,G=u.values()[Symbol.iterator]();!(U=(H=G.next()).done);U=!0){var W=H.value,Y=W.rtpSender,z=W.stream.id,K=Y.track;if("ended"!==K.readyState&&K.kind===r){W.ssrc||(W.ssrc=this.randomSSRC());var J=d&&"video"===K.kind;J&&!W.rtxSsrc&&(W.rtxSsrc=W.ssrc+1),a.ssrcs.push({attribute:"cname",id:W.ssrc,value:CNAME}),a.ssrcs.push({attribute:"msid",id:W.ssrc,value:z+" "+K.id}),a.ssrcs.push({attribute:"mslabel",id:W.ssrc,value:z}),a.ssrcs.push({attribute:"label",id:W.ssrc,value:K.id}),J&&(a.ssrcs.push({attribute:"cname",id:W.rtxSsrc,value:CNAME}),a.ssrcs.push({attribute:"msid",id:W.rtxSsrc,value:z+" "+K.id}),a.ssrcs.push({attribute:"mslabel",id:W.rtxSsrc,value:z}),a.ssrcs.push({attribute:"label",id:W.rtxSsrc,value:K.id}),a.ssrcGroups.push({semantics:"FID",ssrcs:W.ssrc+" "+W.rtxSsrc}))}}}catch(e){F=!0,B=e}finally{try{!U&&G.return&&G.return()}finally{if(F)throw B}}a.ext=[];var Q=!0,q=!1,$=void 0;try{for(var X,Z=c.headerExtensions[Symbol.iterator]();!(Q=(X=Z.next()).done);Q=!0){var ee=X.value;ee.kind&&ee.kind!==r||a.ext.push({value:ee.preferredId,uri:ee.uri})}}catch(e){q=!0,$=e}finally{try{!Q&&Z.return&&Z.return()}finally{if(q)throw $}}a.rtcpMux="rtcp-mux",a.rtcpRsize="rtcp-rsize"}n.media.push(a)}},mergeConstraints:function(e,t){if(!e||!t)return e||t;var n=e;for(var r in t)n[r]=t[r];return n},iceCandidateType:function(e){return e.split(" ")[7]},formatTypePreference:function(e){if(/Chrome\/\d+/.test(navigator.userAgent))switch(e){case 0:return"TURN/TLS";case 1:return"TURN/TCP";case 2:return"TURN/UDP"}else if(/Firefox\/\d+/.test(navigator.userAgent))switch(e){case 0:return"TURN/TCP";case 5:return"TURN/UDP"}return""},maybeSetOpusOptions:function(e,t){return"true"===t.opusStereo?e=this.setCodecParam(e,"opus/48000","stereo","1"):"false"===t.opusStereo&&(e=this.removeCodecParam(e,"opus/48000","stereo")),"true"===t.opusFec?e=this.setCodecParam(e,"opus/48000","useinbandfec","1"):"false"===t.opusFec&&(e=this.removeCodecParam(e,"opus/48000","useinbandfec")),"true"===t.opusDtx?e=this.setCodecParam(e,"opus/48000","usedtx","1"):"false"===t.opusDtx&&(e=this.removeCodecParam(e,"opus/48000","usedtx")),t.opusMaxPbr&&(e=this.setCodecParam(e,"opus/48000","maxplaybackrate",t.opusMaxPbr)),e},maybeSetAudioSendBitRate:function(e,t){return t.audioSendBitrate?(console.log("Prefer audio send bitrate: "+t.audioSendBitrate),this.preferBitRate(e,t.audioSendBitrate,"audio")):e},maybeSetAudioReceiveBitRate:function(e,t){return t.audioRecvBitrate?(console.log("Prefer audio receive bitrate: "+t.audioRecvBitrate),this.preferBitRate(e,t.audioRecvBitrate,"audio")):e},maybeSetVideoSendBitRate:function(e,t){return t.videoSendBitrate?(console.log("Prefer video send bitrate: "+t.videoSendBitrate),this.preferBitRate(e,t.videoSendBitrate,"video")):e},maybeSetVideoReceiveBitRate:function(e,t){return t.videoRecvBitrate?(console.log("Prefer video receive bitrate: "+t.videoRecvBitrate),this.preferBitRate(e,t.videoRecvBitrate,"video")):e},preferBitRate:function(e,t,n){var r=e.split("\r\n"),i=this.findLine(r,"m=",n);if(null===i)return console.log("Failed to add bandwidth line to sdp, as no m-line found"),e;var o=this.findLineInRange(r,i+1,-1,"m=");null===o&&(o=r.length);var a=this.findLineInRange(r,i+1,o,"c=");if(null===a)return console.log("Failed to add bandwidth line to sdp, as no c-line found"),e;var s=this.findLineInRange(r,a+1,o,"b=AS");s&&r.splice(s,1);var c="b=AS:"+t;return r.splice(a+1,0,c),e=r.join("\r\n")},maybeSetVideoSendInitialBitRate:function(e,t){var n=t.videoSendInitialBitrate;if(!n)return e;var r=n,i=t.videoSendBitrate;i&&(n>i&&(console.log("Clamping initial bitrate to max bitrate of "+i+" kbps."),n=i,t.videoSendInitialBitrate=n),r=i);var o=e.split("\r\n");if(null===this.findLine(o,"m=","video"))return console.log("Failed to find video m-line"),e;var a=t.videoRecvCodec;return e=this.setCodecParam(e,a,"x-google-min-bitrate",t.videoSendInitialBitrate.toString()),e=this.setCodecParam(e,a,"x-google-max-bitrate",r.toString())},removePayloadTypeFromMline:function(e,t){e=e.split(" ");for(var n=0;n<e.length;++n)e[n]===t.toString()&&e.splice(n,1);return e.join(" ")},removeCodecByName:function(e,t){var n=this.findLine(e,"a=rtpmap",t);if(null===n)return e;var r=this.getCodecPayloadTypeFromLine(e[n]);e.splice(n,1);var i=this.findLine(e,"m=","video");return null===i?e:(e[i]=this.removePayloadTypeFromMline(e[i],r),e)},removeCodecByPayloadType:function(e,t){var n=this.findLine(e,"a=rtpmap",t.toString());if(null===n)return e;e.splice(n,1);var r=this.findLine(e,"m=","video");return null===r?e:(e[r]=this.removePayloadTypeFromMline(e[r],t),e)},maybeRemoveVideoFec:function(e,t){if("false"!==t.videoFec)return e;var n=e.split("\r\n"),r=this.findLine(n,"a=rtpmap","red");if(null===r)return e;var i=this.getCodecPayloadTypeFromLine(n[r]);if(n=this.removeCodecByPayloadType(n,i),n=this.removeCodecByName(n,"ulpfec"),null===(r=this.findLine(n,"a=fmtp",i.toString())))return e;var o=this.parseFmtpLine(n[r]).pt;return null===o?e:(n.splice(r,1),(n=this.removeCodecByPayloadType(n,o)).join("\r\n"))},maybePreferAudioSendCodec:function(e,t){return this.maybePreferCodec(e,"audio","send",t.audioSendCodec)},maybePreferAudioReceiveCodec:function(e,t){return this.maybePreferCodec(e,"audio","receive",t.audioRecvCodec)},maybePreferVideoSendCodec:function(e,t){return this.maybePreferCodec(e,"video","send",t.videoSendCodec)},maybePreferVideoReceiveCodec:function(e,t){return this.maybePreferCodec(e,"video","receive",t.videoRecvCodec)},maybePreferCodec:function(e,t,n,r){var i=t+" "+n+" codec";if(!r)return console.log("No preference on "+i+"."),e;console.log("Prefer "+i+": "+r);var o=e.split("\r\n"),a=this.findLine(o,"m=",t);if(null===a)return e;var s=this.getCodecPayloadType(o,r);return s?o[a]=this.setDefaultCodec(o[a],s):console.error("no prefered codec found for ",r),e=o.join("\r\n")},setCodecParam:function(e,t,n,r){var i=e.split("\r\n"),o=this.findFmtpLine(i,t),a={};if(null===o){var s=this.findLine(i,"a=rtpmap",t);if(null===s)return e;var c=this.getCodecPayloadTypeFromLine(i[s]);a.pt=c.toString(),a.params={},a.params[n]=r,i.splice(s+1,0,this.writeFmtpLine(a))}else(a=this.parseFmtpLine(i[o])).params[n]=r,i[o]=this.writeFmtpLine(a);return e=i.join("\r\n")},removeCodecParam:function(e,t,n){var r=e.split("\r\n"),i=this.findFmtpLine(r,t);if(null===i)return e;var o=this.parseFmtpLine(r[i]);delete o.params[n];var a=this.writeFmtpLine(o);return null===a?r.splice(i,1):r[i]=a,e=r.join("\r\n")},parseFmtpLine:function(e){var t={},n=e.indexOf(" "),r=e.substring(n+1).split("; "),i=new RegExp("a=fmtp:(\\d+)"),o=e.match(i);if(!o||2!==o.length)return null;t.pt=o[1];for(var a={},s=0;s<r.length;++s){var c=r[s].split("=");2===c.length&&(a[c[0]]=c[1])}return t.params=a,t},writeFmtpLine:function(e){if(!e.hasOwnProperty("pt")||!e.hasOwnProperty("params"))return null;var t=e.pt,n=e.params,r=[],i=0;for(var o in n)r[i]=o+"="+n[o],++i;return 0===i?null:"a=fmtp:"+t.toString()+" "+r.join("; ")},findFmtpLine:function(e,t){var n=this.getCodecPayloadType(e,t);return n?this.findLine(e,"a=fmtp:"+n.toString()):null},findLine:function(e,t,n){return this.findLineInRange(e,0,-1,t,n)},findLineInRange:function(e,t,n,r,i){for(var o=-1!==n?n:e.length,a=t;a<o;++a)if(0===e[a].indexOf(r)&&(!i||-1!==e[a].toLowerCase().indexOf(i.toLowerCase())))return a;return null},getCodecPayloadType:function(e,t){var n=this.findLine(e,"a=rtpmap",t);return n?this.getCodecPayloadTypeFromLine(e[n]):null},getCodecPayloadTypeFromLine:function(e){var t=new RegExp("a=rtpmap:(\\d+) [a-zA-Z0-9-]+\\/\\d+"),n=e.match(t);return n&&2===n.length?n[1]:null},setDefaultCodec:function(e,t){var n=e.split(" "),r=n.slice(0,3);r.push(t);for(var i=3;i<n.length;i++)n[i]!==t&&r.push(n[i]);return r.join(" ")}},e.exports=t.default},function(e,t,n){"use strict";t.__esModule=!0;var r=o(n(322)),i=o(n(325));function o(e){return e&&e.__esModule?e:{default:e}}t.default=function(){return function(e,t){if(Array.isArray(e))return e;if((0,r.default)(Object(e)))return function(e,t){var n=[],r=!0,o=!1,a=void 0;try{for(var s,c=(0,i.default)(e);!(r=(s=c.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(e){o=!0,a=e}finally{try{!r&&c.return&&c.return()}finally{if(o)throw a}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}()},function(e,t,n){e.exports={default:n(323),__esModule:!0}},function(e,t,n){n(60),n(51),e.exports=n(324)},function(e,t,n){var r=n(105),i=n(2)("iterator"),o=n(17);e.exports=n(4).isIterable=function(e){var t=Object(e);return void 0!==t[i]||"@@iterator"in t||o.hasOwnProperty(r(t))}},function(e,t,n){e.exports={default:n(326),__esModule:!0}},function(e,t,n){n(60),n(51),e.exports=n(327)},function(e,t,n){var r=n(10),i=n(111);e.exports=n(4).getIterator=function(e){var t=i(e);if("function"!=typeof t)throw TypeError(e+" is not iterable!");return r(t.call(e))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=s(n(14)),i=s(n(50)),o=s(n(27)),a=s(n(28));function s(e){return e&&e.__esModule?e:{default:e}}var c=function(e){function t(e){(0,r.default)(this,t);var n=(0,o.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.peer=e.peer,n.mediaStreamTrack=e.mediaStreamTrack,n.interval=5e3,n.init(),n}return(0,a.default)(t,e),(0,i.default)(t,[{key:"init",value:function(){this.reset(),this.initStatsResult(),this.initStatsParser(),this.initStatsParserFn()}},{key:"reset",value:function(){this.nomore=!1,this.AUDIO_codecs=["opus","isac","ilbc"],this.VIDEO_codecs=["vp9","vp8","h264"],this.SSRC={audio:{send:[],recv:[]},video:{send:[],recv:[]}},this.LOCAL_candidateType=[],this.LOCAL_transport=[],this.LOCAL_ipAddress=[],this.LOCAL_networkType=[],this.REMOTE_candidateType=[],this.REMOTE_transport=[],this.REMOTE_ipAddress=[],this.REMOTE_networkType=[]}},{key:"initStatsResult",value:function(){var e=((navigator.connection||{}).type||"unknown").toString().toLowerCase();this.statsResult={encryption:"sha-256",audio:{send:{tracks:[],codecs:[],availableBandwidth:0,streams:0},recv:{tracks:[],codecs:[],availableBandwidth:0,streams:0},bytesSent:0,bytesReceived:0},video:{send:{tracks:[],codecs:[],availableBandwidth:0,streams:0},recv:{tracks:[],codecs:[],availableBandwidth:0,streams:0},bytesSent:0,bytesReceived:0},results:{},connectionType:{systemNetworkType:e,systemIpAddress:"192.168.1.2",local:{candidateType:[],transport:[],ipAddress:[],networkType:[]},remote:{candidateType:[],transport:[],ipAddress:[],networkType:[]}},resolutions:{send:{width:0,height:0},recv:{width:0,height:0}},internal:{audio:{send:{},recv:{}},video:{send:{},recv:{}},candidates:{}},nomore:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){nomore=!0})}}},{key:"initStatsParser",value:function(){var e=this;this.statsParser={checkIfOfferer:function(t){"googLibjingleSession"===t.type&&(e.statsResult.isOfferer=t.googInitiator)}}}},{key:"initStatsParserFn",value:function(){var e=this.AUDIO_codecs,t=this.VIDEO_codecs,n=this.SSRC,r=this.statsParser,i=this.statsResult,o=this.LOCAL_candidateType,a=this.LOCAL_transport,s=this.LOCAL_ipAddress,c=this.LOCAL_networkType,u=this.REMOTE_candidateType,d=this.REMOTE_transport,l=this.REMOTE_ipAddress,p=this.REMOTE_networkType;r.datachannel=function(e){"datachannel"===e.type&&(i.datachannel={state:e.state})},r.googCertificate=function(e){"googCertificate"===e.type&&(i.encryption=e.googFingerprintAlgorithm)},r.checkAudioTracks=function(t){if(t.googCodecName&&"audio"===t.mediaType&&-1!==e.indexOf(t.googCodecName.toLowerCase())){var n=t.id.split("_").pop();if(-1===i.audio[n].codecs.indexOf(t.googCodecName)&&i.audio[n].codecs.push(t.googCodecName),t.bytesSent){var r=0;if(t.bytesSent){i.internal.audio[n].prevBytesSent||(i.internal.audio[n].prevBytesSent=t.bytesSent);var o=t.bytesSent-i.internal.audio[n].prevBytesSent;i.internal.audio[n].prevBytesSent=t.bytesSent,r=o/1024}i.audio[n].availableBandwidth=r.toFixed(1)}if(t.bytesReceived){r=0;if(t.bytesReceived){i.internal.audio[n].prevBytesReceived||(i.internal.audio[n].prevBytesReceived=t.bytesReceived);o=t.bytesReceived-i.internal.audio[n].prevBytesReceived;i.internal.audio[n].prevBytesReceived=t.bytesReceived,r=o/1024}t.availableBandwidth=r.toFixed(1),i.audio[n].availableBandwidth=t.availableBandwidth}-1===i.audio[n].tracks.indexOf(t.googTrackId)&&i.audio[n].tracks.push(t.googTrackId)}},r.checkVideoTracks=function(e){if(e.googCodecName&&"video"===e.mediaType&&-1!==t.indexOf(e.googCodecName.toLowerCase())){var n=e.id.split("_").pop();if(-1===i.video[n].codecs.indexOf(e.googCodecName)&&i.video[n].codecs.push(e.googCodecName),e.bytesSent){var r=0;i.internal.video[n].prevBytesSent||(i.internal.video[n].prevBytesSent=e.bytesSent);var o=e.bytesSent-i.internal.video[n].prevBytesSent;i.internal.video[n].prevBytesSent=e.bytesSent,r=o/1024}if(e.bytesReceived){r=0;i.internal.video[n].prevBytesReceived||(i.internal.video[n].prevBytesReceived=e.bytesReceived);o=e.bytesReceived-i.internal.video[n].prevBytesReceived;i.internal.video[n].prevBytesReceived=e.bytesReceived,r=o/1024}e.availableBandwidth=r.toFixed(1),i.video[n].availableBandwidth=e.availableBandwidth,e.googFrameHeightReceived&&e.googFrameWidthReceived&&(i.resolutions[n].width=e.googFrameWidthReceived,i.resolutions[n].height=e.googFrameHeightReceived),e.googFrameHeightSent&&e.googFrameWidthSent&&(i.resolutions[n].width=e.googFrameWidthSent,i.resolutions[n].height=e.googFrameHeightSent),-1===i.video[n].tracks.indexOf(e.googTrackId)&&i.video[n].tracks.push(e.googTrackId)}},r.bweforvideo=function(e){"VideoBwe"===e.type&&(i.video.bandwidth={googActualEncBitrate:e.googActualEncBitrate,googAvailableSendBandwidth:e.googAvailableSendBandwidth,googAvailableReceiveBandwidth:e.googAvailableReceiveBandwidth,googRetransmitBitrate:e.googRetransmitBitrate,googTargetEncBitrate:e.googTargetEncBitrate,googBucketDelay:e.googBucketDelay,googTransmitBitrate:e.googTransmitBitrate})},r.googCandidatePair=function(e){if("googCandidatePair"===e.type&&(i.connectionType.bitsSentPerSecond=8*(e.bytesSent-(i.connectionType.prevBytesSent||0))/1024/2,i.connectionType.bitsReceivedPerSecond=8*(e.bytesReceived-(i.connectionType.prevBytesReceived||0))/1024/2,i.connectionType.bitsSentPerSecond=i.connectionType.bitsSentPerSecond.toFixed(1),i.connectionType.bitsReceivedPerSecond=i.connectionType.bitsReceivedPerSecond.toFixed(1),i.connectionType.prevBytesSent=e.bytesSent,i.connectionType.prevBytesReceived=e.bytesReceived,"true"===e.googActiveConnection)){i.connectionType.local.ipAddress=e.googLocalAddress,i.connectionType.remote.ipAddress=e.googRemoteAddress,i.connectionType.transport=e.googTransportType;var t=i.internal.candidates[e.localCandidateId];t&&t.ipAddress&&(i.connectionType.systemIpAddress=t.ipAddress);var n=i.internal.candidates[e.remoteCandidateId];n&&n.ipAddress&&(i.connectionType.systemIpAddress=n.ipAddress)}},r.localcandidate=function(e){"localcandidate"===e.type&&(e.candidateType&&-1===o.indexOf(e.candidateType)&&o.push(e.candidateType),e.transport&&-1===a.indexOf(e.transport)&&a.push(e.transport),e.ipAddress&&-1===s.indexOf(e.ipAddress+":"+e.portNumber)&&s.push(e.ipAddress+":"+e.portNumber),e.networkType&&-1===c.indexOf(e.networkType)&&c.push(e.networkType),i.internal.candidates[e.id]={candidateType:o,ipAddress:s,portNumber:e.portNumber,networkType:c,priority:e.priority,transport:a,timestamp:e.timestamp,id:e.id,type:e.type},i.connectionType.local.candidateType=o,i.connectionType.local.ipAddress=s,i.connectionType.local.networkType=c,i.connectionType.local.transport=a)},r.remotecandidate=function(e){"remotecandidate"===e.type&&(e.candidateType&&-1===u.indexOf(e.candidateType)&&u.push(e.candidateType),e.transport&&-1===d.indexOf(e.transport)&&d.push(e.transport),e.ipAddress&&-1===l.indexOf(e.ipAddress+":"+e.portNumber)&&l.push(e.ipAddress+":"+e.portNumber),e.networkType&&-1===p.indexOf(e.networkType)&&p.push(e.networkType),i.internal.candidates[e.id]={candidateType:u,ipAddress:l,portNumber:e.portNumber,networkType:p,priority:e.priority,transport:d,timestamp:e.timestamp,id:e.id,type:e.type},i.connectionType.remote.candidateType=u,i.connectionType.remote.ipAddress=l,i.connectionType.remote.networkType=p,i.connectionType.remote.transport=d)},r.dataSentReceived=function(e){!e.googCodecName||"video"!==e.mediaType&&"audio"!==e.mediaType||(e.bytesSent&&(i[e.mediaType].bytesSent=parseInt(e.bytesSent)),e.bytesReceived&&(i[e.mediaType].bytesReceived=parseInt(e.bytesReceived)))},r.ssrc=function(e){if(e.googCodecName&&("video"===e.mediaType||"audio"===e.mediaType)&&"ssrc"===e.type){var t=e.id.split("_").pop();-1===n[e.mediaType][t].indexOf(e.ssrc)&&n[e.mediaType][t].push(e.ssrc),i[e.mediaType][t].streams=n[e.mediaType][t].length}}}},{key:"start",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.interval;if(this.statsTimer&&clearInterval(this.statsTimer),!e)throw Error("no peer for stats");this.peer=e,this.interval=t,this.statsTimer=setInterval(this.getStats.bind(this),t)}},{key:"stop",value:function(){this.statsTimer&&(clearInterval(this.statsTimer),this.statsTimer=null,this.reset())}},{key:"getStats",value:function(){var e=this.formatResult.bind(this),t=this.peer,n=this.mediaStreamTrack;void 0!==window.InstallTrigger?t.getStats(n,function(t){var n=[];t.forEach(function(e){n.push(e)}),e(n)},e):t.getStats(function(t){var n=[];t.result().forEach(function(e){var t={};e.names().forEach(function(n){t[n]=e.stat(n)}),t.id=e.id,t.type=e.type,t.timestamp=e.timestamp,n.push(t)}),e(n)})}},{key:"formatResult",value:function(e){var t=this.peer,n=(this.mediaStreamTrack,this.statsParser),r=this.statsResult;e.forEach(function(e){Object.keys(n).forEach(function(t){"function"==typeof n[t]&&n[t](e)})});try{-1!==t.iceConnectionState.search(/failed/gi)&&(this.nomore=!0)}catch(e){this.nomore=!0}!0===this.nomore&&(r.datachannel&&(r.datachannel.state="close"),r.ended=!0),r.results=e,this.emit("stats",r)}}]),t}(s(n(25)).default);t.default=c,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=l(n(118)),i=l(n(119)),o=l(n(14)),a=l(n(50)),s=l(n(27)),c=l(n(28)),u=l(n(25)),d=l(n(330));function l(e){return e&&e.__esModule?e:{default:e}}var p=function(e){function t(){return(0,o.default)(this,t),(0,s.default)(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return(0,c.default)(t,e),(0,a.default)(t,[{key:"reset",value:function(){this.times=0,this.timer&&clearInterval(this.timer),this.timer=null,this.interval=0,this.controller=null}},{key:"start",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.controller,n=e.interval,r=void 0===n?1:n;this.controller=t,this.interval=r,this.timer=setInterval(this.getStats.bind(this),1e3*r)}},{key:"stop",value:function(){this.reset()}},{key:"getStats",value:function(){var e=(0,i.default)(r.default.mark(function e(){var t;return r.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t={},e.next=3,this.getLocalStats();case 3:return t.self=e.sent,e.next=6,this.getRemoteStats();case 6:t.other=e.sent,Object.keys(t.other).map(function(e){t.self=Object.assign(t.self,t.other[e])}),this.times=(this.times||0)+1,this.emit("stats",t.self,this.times);case 10:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getLocalStats",value:function(){var e=(0,i.default)(r.default.mark(function e(){var t;return r.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((t=this.controller)&&t.rtc){e.next=3;break}return e.abrupt("return",{});case 3:return t.rtc.rtcConnection.interval=this.interval,e.next=6,d.default.getStats(t.rtc.rtcConnection);case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getRemoteStats",value:function(){var e=(0,i.default)(r.default.mark(function e(){var t,n,o,a,s,c,u,l,p,f=this;return r.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.controller&&this.controller.remoteNode){e.next=2;break}return e.abrupt("return",{});case 2:t={},n=this.controller.remoteNode,o=Object.keys(n).map(function(){var e=(0,i.default)(r.default.mark(function e(i){return r.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!n[i].rtc){e.next=6;break}return n[i].rtc.rtcConnection.interval=f.interval,e.next=4,d.default.getStats(n[i].rtc.rtcConnection);case 4:return t[i]=e.sent,e.abrupt("return",t[i]);case 6:case"end":return e.stop()}},e,f)}));return function(t){return e.apply(this,arguments)}}()),a=!0,s=!1,c=void 0,e.prev=8,u=o[Symbol.iterator]();case 10:if(a=(l=u.next()).done){e.next=17;break}return p=l.value,e.next=14,p;case 14:a=!0,e.next=10;break;case 17:e.next=23;break;case 19:e.prev=19,e.t0=e.catch(8),s=!0,c=e.t0;case 23:e.prev=23,e.prev=24,!a&&u.return&&u.return();case 26:if(e.prev=26,!s){e.next=29;break}throw c;case 29:return e.finish(26);case 30:return e.finish(23);case 31:return e.abrupt("return",t);case 32:case"end":return e.stop()}},e,this,[[8,19,23,31],[24,,26,30]])}));return function(){return e.apply(this,arguments)}}()}]),t}(u.default);t.default=p,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={framesEncoded:1,qpSum:1,audioOutputLevel:1,googDecodingCTN:1,googDecodingNormal:1,googAvailableSendBandwidth:1,googTargetEncBitrate:1,googActualEncBitrate:1,googRetransmitBitrate:1,googTransmitBitrate:1},i={googCaptureStartNtpTimeMs:1};t.default={getStats:function(e){var t=this;if(e&&!/(failed|closed)/gi.test(e.iceConnectionState))return navigator.mozGetUserMedia?this.getStatsFirefox(e):new Promise(function(n,r){e.getStats(function(r){var i={},o=[],a=r.result();for(var s in a.forEach(function(e){var t={};e.names().forEach(function(n){t[n]=e.stat(n)}),t.id=e.id,t.type=e.type,t.timestamp=e.timestamp,i[t.id]=t}),i)i[s].networkType&&-1===o.indexOf(i[s].networkType)&&o.push(i[s].networkType);e.lastStats=e.lastStats||{},i=t.format(e,i,o),n(i)})})},getStatsFirefox:function(e){var t=this;return e.getStats(null).then(function(n){return e.lastStats=e.lastStats||{},n=t.format(e,n),Promise.resolve(n)})},format:function(e,t,n){return!e||/(failed|closed)/gi.test(e.iceConnectionState)?{}:t=e.uid-e.targetUid==0?this.ssrcLocal(e,t,n):this.ssrcRemote(e,t,n)},formatSSRC:function(e,t,n,r,i){return this[navigator.mozGetUserMedia?"_formatSSRC_F":"_formatSSRC_G"](e,t,n,r,i)},_formatSSRC_G:function(e,t,n,r,i){var o=this,a={};return Object.values(t).map(function(t){if(("recv"!==r||/^ssrc_/gi.test(t.id))&&("send"!==r||/^(bweforvideo|ssrc_)/gi.test(t.id))){t=o.formatData(t);var n=new RegExp("ssrc_(\\d+)_"+r),s=t.id.match(n),c=t.id;a[c]=t,t.network=i&&i[0],s&&s[1]&&("recv"!==r||0!==e.uid?(t.id="ssrc_"+e.uid+"_"+r+"_"+("recv"===r?e.targetUid:0)+"_"+t.mediaType,t=o.computeData(e,t),a[t.id]=t,delete a[c]):delete a[c])}}),a},_formatSSRC_F:function(e,t,n,r){var i=this,o={},a=new RegExp("^"+("send"===r?"outbound":"inbound")+"_","i");return Object.values(t).map(function(t){if(a.test(t.id)){var n=t.id;t.id=t.id.replace(/\d+/,e.uid+"_"+r+"_"+("recv"===r?e.targetUid:0)),t=i.computeData(e,t),o[t.id]=t,delete o[n]}}),o},formatData:function(e){return Object.keys(e).map(function(t){r[t]&&(e[t]=(e[t]/1024).toFixed(2)),i[t]&&(e[t]=(e[t]/1024/1024).toFixed(2))}),e},computeData:function(e,t){var n={peer:e,ssrcKey:t.id,currentItem:t};return t.bytesSent&&(t.bitsSentPerSecond=this.getLastStats(Object.assign({},n,{valueKey:"bytesSent"}))),t.packetsSent&&(t.packetsSentPerSecond=this.getLastStats(Object.assign({},n,{valueKey:"packetsSent"}))),t.bytesReceived&&(t.bitsReceivedPerSecond=this.getLastStats(Object.assign({},n,{valueKey:"bytesReceived"}))),t.packetsReceived&&(t.packetsReceivedPerSecond=this.getLastStats(Object.assign({},n,{valueKey:"packetsReceived"}))),t},ssrcLocal:function(e,t,n){var r=e.localDescription;return this.formatSSRC(e,t,r.sdp,"send",n)},ssrcRemote:function(e,t,n){var r=e.remoteDescription;return this.formatSSRC(e,t,r.sdp,"recv",n)},getLastStats:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.peer,n=e.ssrcKey,r=e.valueKey,i=e.currentItem,o=null;return o=t.lastStats[n]&&t.lastStats[n][r]?i[r]-t.lastStats[n][r]:i[r],o=/bytes/gi.test(r)?(8*o*1e3/t.interval/1024).toFixed(2):1e3*o/t.interval,t.lastStats[n]=i[r],o}},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=s(n(14)),i=s(n(50)),o=s(n(27)),a=s(n(28));function s(e){return e&&e.__esModule?e:{default:e}}var c=n(16),u=n(205),d={},l=function(e){function t(e){(0,r.default)(this,t);var n=(0,o.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.isRemote=!!e.isRemote,n.constraint=e.constraint||{},n.stream=e.stream,n.audioStream=e.stream,n.container=e.container,n.uid=e.uid||"",n.poster=e.poster||"",n.isAudio="audio"===e.type,n.initNode(),n.videoRatioIntervalId=null,n.startVideoRatioMonitor(),n}return(0,a.default)(t,e),(0,i.default)(t,[{key:"initNode",value:function(){this.node||(this.isAudio?this.initAudioNode():this.initVideoNode(),this.isRemote&&!this.isAudio&&this.initVideoEvent())}},{key:"initAudioNode",value:function(){this.audioStream=this.stream,/safari/gi.test(c.name)||(this.webAudio=new u({stream:this.audioStream,uid:this.uid,isAnalyze:!0,isRemote:this.isRemote}),this.stream=this.webAudio.outputStream),this.node=document.createElement("audio"),this.node.dataset.uid=this.uid}},{key:"initVideoNode",value:function(){var e=this,t=document.createElement("div");t.style.overflow="hidden",t.style.position="relative",t.style.width="400px",t.style.height="400px",t.style.display="none";var n=document.createElement("video");n.setAttribute("x-webkit-airplay","x-webkit-airplay"),n.setAttribute("playsinline","playsinline"),n.setAttribute("webkit-playsinline","webkit-playsinline"),this.poster&&(n.poster=this.poster),n.preload="auto",n.dataset.uid=this.uid,n.autoplay="autoplay",n.style.position="absolute",n.style.left="50%",n.style.top="50%",n.style.transform="translate(-50%,-50%)",t.appendChild(n),this.node=n,this.videoContainer=t,setTimeout(function(){e.videoContainer&&(e.videoContainer.style.display="inline-block")},1e3),t.style.color="#fff";var r=document.createElement("p");r.textContent=this.uid,r.zIndex=1,t.appendChild(r)}},{key:"initVideoEvent",value:function(){}},{key:"setMuted",value:function(e){this.muted=!!e,this.node&&(this.node.muted=!!e,this.setPlayVolume(),e||this.show())}},{key:"getMuted",value:function(){return!!this.muted}},{key:"setPlayVolume",value:function(e){var t=void 0;e?(e.constructor===Number&&(t=e),e.constructor===Object&&(t=void 0===e.volume?1:e.volume)):t=this.volume,this.volume=t,this.getMuted()||this.node&&(t=void 0===t||t>1?1:t,this.node.volume=t)}},{key:"getPlayVolume",value:function(){return void 0!==this.volume?this.volume:1}},{key:"setGain",value:function(e){if(this.stream&&!this.isRemote){if(void 0===e&&(e=1),this.gainOff)return this.gain=e,e;this.webAudio&&this.webAudio.setGain(e),this.gain=e}}},{key:"getGain",value:function(){return void 0!==this.gain?this.gain:1}},{key:"setGainOff",value:function(){this.stream&&!this.isRemote&&(this.webAudio&&this.webAudio.setGain(0),this.gainOff=!0)}},{key:"setGainOn",value:function(){this.stream&&!this.isRemote&&(this.webAudio&&this.webAudio.setGain(void 0!==this.gain?this.gain:1),this.gainOff=!1)}},{key:"show",value:function(e,t){if(this.node){if(this.isAudio)return this.node.srcObject=this.audioStream,this.muted&&this.setMuted(this.muted),this.play(),void(this.enable=!0);this.poster=void 0===t?this.poster:t;var n=this.videoContainer;e=this.container=e||this.container,console.log("node container",n,e),n&&e&&(n.parentNode&&n.parentNode===n||(n.parentNode&&n.parentNode.removeChild(n),e.appendChild(n)),this.node.srcObject||(this.node.srcObject=this.stream),this.poster&&(this.node.poster=this.poster),this.play(),this.resizeOptions&&this.resize(),this.enable=!0)}}},{key:"hide",value:function(){var e=this.videoContainer;e&&(this.node.paused||this.node.pause(),e.parentNode&&e.parentNode.removeChild(e),this.enable=!1)}},{key:"addAudioStream",value:function(e){e&&this.webAudio&&(this.webAudio.addStream(e),this.stream=this.webAudio.outputStream,d.log("本地添加音频流:",e))}},{key:"updateStream",value:function(e){var n=this.node;if(n&&e){if(this.isAudio)return this.webAudio&&(this.webAudio.updateStream(e),this.stream=this.webAudio.outputStream),d.log("webrtc::mediaStream::updateAudioTrack",e.getTracks()),this.audioStream&&t.destroyMedia(this.audioStream),void(this.audioStream=e);d.log("webrtc::mediaStream::updateVideoTrack",e.getTracks()),t.destroyMedia(this.stream),this.stream=e,n.srcObject=this.stream}}},{key:"isShown",value:function(){return this.node&&this.node.srcObject&&this.enable}},{key:"removeTrack",value:function(e){var t=this.stream;t&&t.removeTrack(e)}},{key:"resize",value:function(e){if((e&&e.width&&e.height||this.resizeOptions)&&(this.resizeOptions=e||this.resizeOptions,(e=this.resizeOptions).cut=void 0===e.cut||e.cut,this.node&&this.videoContainer&&!this.isAudio)){if(this.videoContainer.style.width=e.width+"px",this.videoContainer.style.height=e.height+"px",!e.cut)return this.node.style.height="100%",void(this.node.style.width="100%");if(this.node.videoWidth&&this.node.videoHeight)this.node.videoWidth/this.node.videoHeight>e.width/e.height?(this.node.style.height="100%",this.node.style.width="auto"):(this.node.style.width="100%",this.node.style.height="auto");else this.node.width=e.width,this.node.height=e.height}}},{key:"startVideoRatioMonitor",value:function(){var e=this;this.isAudio||null===this.videoRatioIntervalId&&(this.preVideoWidth=this.node.videoWidth,this.preVideoHeight=this.node.videoHeight,this.videoRatioIntervalId=setInterval(function(){e.resizeOptions&&(e.preVideoWidth===e.node.videoWidth&&e.preVideoHeight===e.node.videoHeight||(e.resize(e.resizeOptions),e.preVideoWidth=e.node.videoWidth,e.preVideoHeight=e.node.videoHeight))},1e3))}},{key:"getAudioVolume",value:function(){return this.webAudio&&this.webAudio.getVolumeData()||0}},{key:"getMetaWidth",value:function(e){if(this.node&&!this.isAudio)return this.node.videoWidth}},{key:"getMetaHeight",value:function(e){if(this.node&&!this.isAudio)return this.node.videoHeight}},{key:"resume",value:function(){this.play()}},{key:"pause",value:function(){this.node.pause()}},{key:"play",value:function(){var e=this.node;4!==e.readyState&&e.load(),0!==e.played.length&&e.pause();var t=e.play();void 0!==t&&t.catch(function(e){d.warn(e)}).then(function(){d.log("playing-。-",e,e.parentNode,e.srcObject&&e.srcObject.getTracks())})}},{key:"stopDevice",value:function(){this.isAudio?(d.log("销毁音频流",this.uid,this.audioStream),t.destroyMedia(this.audioStream),this.audioStream=null):(t.destroyMedia(this.stream),this.stream=null)}},{key:"destroy",value:function(){this.hide(),this.node&&(this.node.pause(),this.node=null),this.videoContainer=null,this.stream&&(t.destroyMedia(this.audioStream),this.isRemote||t.destroyMedia(this.stream),this.stream=null,this.audioStream=null,null!==this.videoRatioIntervalId&&(clearInterval(this.videoRatioIntervalId),this.videoRatioIntervalId=null),this.webAudio&&this.webAudio.context&&this.webAudio.destroy&&this.webAudio.destroy())}}],[{key:"init",value:function(e){d=e||window.console}},{key:"destroyMedia",value:function(e){var t=this;if(e){var n=e.getTracks();n&&0!==n.length&&n.forEach(function(n){d.log("destroy track",t.uid||e.id,n),n.stop(),e.removeTrack(n)})}}},{key:"getLocalStream",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{audio:!0,video:!0,stream:!1},n=e.audio?"audio":"";return/safari/gi.test(c.name)&&e.video,console.log("constraint",e),e.stream?new Promise(function(r,i){return r(new t({stream:e.stream,type:n,isRemote:!1,constraint:e}))}):navigator.mediaDevices.getUserMedia(e).then(function(r){return"audio"===n?r:new t({stream:r,type:n,isRemote:!1,constraint:e})}).catch(function(t){var n=t.constructor===Object?t.name:JSON.stringify(t);return console.error(e,t),Promise.reject(n)})}}]),t}(n(25));t.default=l,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=s(n(14)),i=s(n(27)),o=s(n(28)),a=n(68);function s(e){return e&&e.__esModule?e:{default:e}}n(333);var c=function(e){function t(e){(0,r.default)(this,t);var n=(0,i.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.logger=e.logger,n.imInfo=e.imInfo,n.sessionConfig=e.sessionConfig,n.controller=e.controller,n.targetUid=e.targetUid||n.imInfo.uid,n.init(),n.isProgress=!1,n}return(0,o.default)(t,e),t}(n(25));t.default=c;var u=c.prototype;u.resetStatus=function(){this.sdpOffer=null,this.sdpAnswer=null,this.iceOffer=[],this.iceAnswer=[],this.offerCount=0},u.setProgress=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.isProgress=e,!1===e&&"completed"===this.rtcConnection.iceConnectionState&&this.emit("ready")},u.init=function(){var e=this;if(this.resetStatus(),!this.rtcConnection){var t=/Firefox/gi.test(navigator.userAgent),n=this.rtcConnection=new RTCPeerConnection({iceServers:[{url:"stun:turn.ideasip.com"}]});n.uid=this.imInfo.uid,n.targetUid=this.targetUid,n.onicecandidate=this.onIceCandidate.bind(this),n.onnegotiationneeded=this.onNegotiationneeded.bind(this),n.oniceconnectionstatechange=this.onIceStateChange.bind(this),t?n.ontrack=this.onRemoteTrack.bind(this):(n.onaddstream=this.onRemoteStream.bind(this),n.onremovestream=function(t){e.logger.warn("webrtc-rtc::",e.targetUid,"on remove stream:",t.stream)}),window.myRtc=n}},u.doSendIce=function(){if(this.sdpAnswer&&!this.iceCompleted&&0!==this.iceOffer.length){var e=this.iceOffer.shift();this.emit("iceCandidate",{uid:this.targetUid,ice:e}),this.doSendIce()}},u.onIceCandidate=function(e){if(e.candidate){if(/ tcp /gi.test(e.candidate.candidate))return;return this.logger.log("webrtc-rtc::",this.targetUid,"gather candidate",e.candidate.candidate),this.iceOffer.push(e.candidate),void this.offerCount++}this.logger.log("webrtc-rtc::",this.targetUid,"onicecandidate end"),this.doSendIce()},u.onIceStateChange=function(){this.rtcConnection&&("connected"===this.rtcConnection.iceConnectionState&&this.iceCompleted&&this.setProgress(!1),this.emit("icestatechange",{rtc:this,state:this.rtcConnection.iceConnectionState}))},u.onNegotiationneeded=function(e){this.emit("negotiationneeded",e)},u.getReceivers=function(){return this.rtcConnection.getReceivers()},u.getRemoteStreams=function(){return this.rtcConnection.getRemoteStreams()},u.onRemoteStream=function(e){if(this.targetUid!==this.imInfo.uid){if(this.logger.log("webrtc-rtc::",this.targetUid,"on remote stream",e),!e.stream||e.stream&&"default"===e.stream.id)return this.logger.log("webrtc-rtc::remote stream is default stream, do nothing");this.emit("getRemoteStream",{uid:this.targetUid,stream:e.stream})}},u.onRemoteTrack=function(e){if(this.targetUid!==this.imInfo.uid){var t=e.streams[0];t&&this.emit("getRemoteStream",{uid:this.targetUid,stream:t,track:e.track})}},u.getIceConnectionState=function(){if(this.rtcConnection)return this.rtcConnection.iceConnectionState},u.checkNegotiation=function(){return!(0===this.oldTracks&&0===this.newTracks)},u.updateStream=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];a.RtcUtil.updateMediaStream({peer:this.rtcConnection,currStream:this.currStream,streams:t}).then(function(t){e.currStream||(e.currStream=t)})},u.removeTrack=function(e){a.RtcUtil.removeTrack({peer:this.rtcConnection,currStream:this.currStream,tracks:e})},u.createAnswer=function(e){var t=this;return this.setProgress(!0),this.rtcConnection.createAnswer().then(function(e){return e.sdp=a.SdpUtil.maybePreferVideoReceiveCodec(e.sdp,{videoRecvCodec:"H264"}),e=a.RtcUtil.formatSdp({offerOrAnswer:e,uid:t.imInfo.uid,cid:t.imInfo.cid,isHight:t.imInfo.isHight,stream:t.currStream,highAudio:t.sessionConfig.highAudio,stero:t.sessionConfig.stero,targetUid:t.targetUid})}).catch(function(e){t.logger.error("webrtc-rtc::",e)})},u.createOffer=function(){var e=this;return this.setProgress(!0),a.RtcUtil.createOffer(this.rtcConnection).then(function(t){return e.logger.log("\r\nwebrtc-rtc::","---------------netease: activity start----------------\r\n"),e.resetStatus(),t.sdp=a.SdpUtil.maybePreferVideoReceiveCodec(t.sdp,{videoRecvCodec:"H264"}),e.logger.log("webrtc-rtc::this.currentStream",e.currStream&&e.currStream.getTracks()),t=a.RtcUtil.formatSdp({offerOrAnswer:t,uid:e.imInfo.uid,cid:e.imInfo.cid,isHight:e.imInfo.isHight,stream:e.currStream,highAudio:e.sessionConfig.highAudio,stero:e.sessionConfig.stero,targetUid:e.targetUid}),Promise.resolve(t)}).catch(function(t){return e.logger.error("webrtc-rtc::createOffer",t),Promise.reject(t)})},u.getLocalSdp=function(){return this.rtcConnection.localDescription},u.getRemoteSdp=function(){return this.rtcConnection.remoteDescription},u.checkMediaStatus=function(e,t,n){return a.RtcUtil.checkMediaStatus(e,t,n)},u.logSdp=function(){this.rtcConnection.remoteDescription&&console.log("webrtc-rtc::remoteDescription after set",this.rtcConnection.remoteDescription.sdp),this.rtcConnection.currentRemoteDescription&&console.log("webrtc-rtc::currentRemoteDescription after set",this.rtcConnection.currentRemoteDescription.sdp)},u.setRemoteDescription=function(e,t){var n=this;"offer"===e.type&&this.logger.log("\r\nwebrtc-rtc::","---------------netease: activity start----------------\r\n"),this.setProgress("offer"===e.type),this.logger.log("webrtc-rtc::"+this.targetUid+" get remote sdp "+t+" --\x3e "+e.type+"\n",e.sdp);var r={sdp:e.sdp,type:e.type};if("offer"===e.type&&!this.sdpAnswer)return Promise.reject();r.sdp=a.SdpUtil.maybePreferVideoSendCodec(r.sdp,{videoRecvCodec:"H264"}),r.sdp=a.RtcUtil.formatSdpRemote(r.sdp,this.sdpOffer,this.imInfo.isHight),a.RtcUtil.parse(r.sdp),this.sdpAnswer="answer"===e.type?r:null;var i=this.rtcConnection;return i.setRemoteDescription(r).then(function(){if("answer"===e.type){if(n.iceCompleted)return void n.emit("iceCompleted");n.doSendIce()}return Promise.resolve()}).catch(function(e){return console.error("webrtc-rtc::",i.uid," setRemoteDescription error: ",e),Promise.reject(e)})},u.setLocalDescription=function(e,t){var n=this;return this.sdpOffer=e,this.logger.log("webrtc-rtc::"+this.targetUid+" set local sdp "+e.type+"\n",e.sdp),this.rtcConnection.setLocalDescription(e).then(function(){return e.sdp=a.RtcUtil.setMediaBitrates({sdp:e.sdp}),"answer"===e.type?(n.sdpAnswer=e,n.iceCompleted&&n.emit("iceCompleted"),n.setProgress(!1)):n.sdpAnswer=null,Promise.resolve(e)}).catch(function(t){return n.logger.warn(t),Promise.resolve(e)})},u.addRemoteIceCandidate=function(e){var t=this;this.logger.log("webrtc-rtc::"+this.targetUid+" set remote ICE ",e),this.rtcConnection.addIceCandidate(new RTCIceCandidate(e)).then(function(){t.iceAnswer.push(e),t.iceAnswer.length===t.offerCount&&(t.iceCompleted=!0,t.iceAnswer=[],t.offerCount=0,t.emit("iceCompleted"))}).catch(function(e){t.logger.warn(e)})},u.close=function(){this.logger.log("webrtc-rtc::close rtc ",this.targetUid,this.rtcConnection),this.rtcConnection&&this.rtcConnection.close(),this.rtcConnection=null},e.exports=t.default},function(e,t,n){"use strict";(function(t){var r=n(334);e.exports=r({window:t.window})}).call(this,n(29))},function(e,t,n){"use strict";var r=n(69);e.exports=function(e,t){var i=e&&e.window,o={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0};for(var a in t)hasOwnProperty.call(t,a)&&(o[a]=t[a]);var s=r.log,c=r.detectBrowser(i),u={browserDetails:c,extractVersion:r.extractVersion,disableLog:r.disableLog,disableWarnings:r.disableWarnings},d=n(335)||null,l=n(337)||null,p=n(340)||null,f=n(342)||null,h=n(343)||null;switch(c.browser){case"chrome":if(!d||!d.shimPeerConnection||!o.shimChrome)return s("Chrome shim is not included in this adapter release."),u;s("adapter.js shimming chrome."),u.browserShim=d,h.shimCreateObjectURL(i),d.shimGetUserMedia(i),d.shimMediaStream(i),d.shimSourceObject(i),d.shimPeerConnection(i),d.shimOnTrack(i),d.shimAddTrackRemoveTrack(i),d.shimGetSendersWithDtmf(i),h.shimRTCIceCandidate(i);break;case"firefox":if(!p||!p.shimPeerConnection||!o.shimFirefox)return s("Firefox shim is not included in this adapter release."),u;s("adapter.js shimming firefox."),u.browserShim=p,h.shimCreateObjectURL(i),p.shimGetUserMedia(i),p.shimSourceObject(i),p.shimPeerConnection(i),p.shimOnTrack(i),p.shimRemoveStream(i),h.shimRTCIceCandidate(i);break;case"edge":if(!l||!l.shimPeerConnection||!o.shimEdge)return s("MS edge shim is not included in this adapter release."),u;s("adapter.js shimming edge."),u.browserShim=l,h.shimCreateObjectURL(i),l.shimGetUserMedia(i),l.shimPeerConnection(i),l.shimReplaceTrack(i);break;case"safari":if(!f||!o.shimSafari)return s("Safari shim is not included in this adapter release."),u;s("adapter.js shimming safari."),u.browserShim=f,h.shimCreateObjectURL(i),f.shimRTCIceServerUrls(i),f.shimCallbacksAPI(i),f.shimLocalStreamsAPI(i),f.shimRemoteStreamsAPI(i),f.shimTrackEventTransceiver(i),f.shimGetUserMedia(i),f.shimCreateOfferLegacy(i),h.shimRTCIceCandidate(i);break;default:s("Unsupported browser!")}return u}},function(e,t,n){"use strict";var r=n(69),i=r.log,o={shimMediaStream:function(e){e.MediaStream=e.MediaStream||e.webkitMediaStream},shimOnTrack:function(e){if("object"==typeof e&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)}});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var n=this;return n._ontrackpoly||(n._ontrackpoly=function(t){t.stream.addEventListener("addtrack",function(r){var i;i=e.RTCPeerConnection.prototype.getReceivers?n.getReceivers().find(function(e){return e.track&&e.track.id===r.track.id}):{track:r.track};var o=new Event("track");o.track=r.track,o.receiver=i,o.transceiver={receiver:i},o.streams=[t.stream],n.dispatchEvent(o)}),t.stream.getTracks().forEach(function(r){var i;i=e.RTCPeerConnection.prototype.getReceivers?n.getReceivers().find(function(e){return e.track&&e.track.id===r.id}):{track:r};var o=new Event("track");o.track=r,o.receiver=i,o.transceiver={receiver:i},o.streams=[t.stream],n.dispatchEvent(o)})},n.addEventListener("addstream",n._ontrackpoly)),t.apply(n,arguments)}}},shimGetSendersWithDtmf:function(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){var t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){var i=n.apply(this,arguments);return i||(i=t(this,e),this._senders.push(i)),i};var r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){r.apply(this,arguments);var t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}var i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var n=this;n._senders=n._senders||[],i.apply(n,[e]),e.getTracks().forEach(function(e){n._senders.push(t(n,e))})};var o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;t._senders=t._senders||[],o.apply(t,[e]),e.getTracks().forEach(function(e){var n=t._senders.find(function(t){return t.track===e});n&&t._senders.splice(t._senders.indexOf(n),1)})}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var a=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var e=this,t=a.apply(e,[]);return t.forEach(function(t){t._pc=e}),t},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}},shimSourceObject:function(e){var t=e&&e.URL;"object"==typeof e&&(!e.HTMLMediaElement||"srcObject"in e.HTMLMediaElement.prototype||Object.defineProperty(e.HTMLMediaElement.prototype,"srcObject",{get:function(){return this._srcObject},set:function(e){var n=this;this._srcObject=e,this.src&&t.revokeObjectURL(this.src),e?(this.src=t.createObjectURL(e),e.addEventListener("addtrack",function(){n.src&&t.revokeObjectURL(n.src),n.src=t.createObjectURL(e)}),e.addEventListener("removetrack",function(){n.src&&t.revokeObjectURL(n.src),n.src=t.createObjectURL(e)})):this.src=""}}))},shimAddTrackRemoveTrack:function(e){var t=r.detectBrowser(e);if(!(e.RTCPeerConnection.prototype.addTrack&&t.version>=64)){var n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this,t=n.apply(this);return e._reverseStreams=e._reverseStreams||{},t.map(function(t){return e._reverseStreams[t.id]})};var i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){var n=this;if(n._streams=n._streams||{},n._reverseStreams=n._reverseStreams||{},t.getTracks().forEach(function(e){if(n.getSenders().find(function(t){return t.track===e}))throw new DOMException("Track already exists.","InvalidAccessError")}),!n._reverseStreams[t.id]){var r=new e.MediaStream(t.getTracks());n._streams[t.id]=r,n._reverseStreams[r.id]=t,t=r}i.apply(n,[t])};var o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;t._streams=t._streams||{},t._reverseStreams=t._reverseStreams||{},o.apply(t,[t._streams[e.id]||e]),delete t._reverseStreams[t._streams[e.id]?t._streams[e.id].id:e.id],delete t._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,n){var r=this;if("closed"===r.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var i=[].slice.call(arguments,1);if(1!==i.length||!i[0].getTracks().find(function(e){return e===t}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(r.getSenders().find(function(e){return e.track===t}))throw new DOMException("Track already exists.","InvalidAccessError");r._streams=r._streams||{},r._reverseStreams=r._reverseStreams||{};var o=r._streams[n.id];if(o)o.addTrack(t),Promise.resolve().then(function(){r.dispatchEvent(new Event("negotiationneeded"))});else{var a=new e.MediaStream([t]);r._streams[n.id]=a,r._reverseStreams[a.id]=n,r.addStream(a)}return r.getSenders().find(function(e){return e.track===t})},["createOffer","createAnswer"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=this,t=arguments;return arguments.length&&"function"==typeof arguments[0]?n.apply(e,[function(n){var r=c(e,n);t[0].apply(null,[r])},function(e){t[1]&&t[1].apply(null,e)},arguments[2]]):n.apply(e,arguments).then(function(t){return c(e,t)})}});var a=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(e,t){var n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(function(t){var r=e._reverseStreams[t],i=e._streams[r.id];n=n.replace(new RegExp(r.id,"g"),i.id)}),new RTCSessionDescription({type:t.type,sdp:n})}(this,arguments[0]),a.apply(this,arguments)):a.apply(this,arguments)};var s=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get:function(){var e=s.get.apply(this);return""===e.type?e:c(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){var t,n=this;if("closed"===n.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(e._pc===n))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");n._streams=n._streams||{},Object.keys(n._streams).forEach(function(r){n._streams[r].getTracks().find(function(t){return e.track===t})&&(t=n._streams[r])}),t&&(1===t.getTracks().length?n.removeStream(n._reverseStreams[t.id]):t.removeTrack(e.track),n.dispatchEvent(new Event("negotiationneeded")))}}function c(e,t){var n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(function(t){var r=e._reverseStreams[t],i=e._streams[r.id];n=n.replace(new RegExp(i.id,"g"),r.id)}),new RTCSessionDescription({type:t.type,sdp:n})}},shimPeerConnection:function(e){var t=r.detectBrowser(e);if(e.RTCPeerConnection){var n=e.RTCPeerConnection;e.RTCPeerConnection=function(e,t){if(e&&e.iceServers){for(var i=[],o=0;o<e.iceServers.length;o++){var a=e.iceServers[o];!a.hasOwnProperty("urls")&&a.hasOwnProperty("url")?(r.deprecated("RTCIceServer.url","RTCIceServer.urls"),(a=JSON.parse(JSON.stringify(a))).urls=a.url,i.push(a)):i.push(e.iceServers[o])}e.iceServers=i}return new n(e,t)},e.RTCPeerConnection.prototype=n.prototype,Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return n.generateCertificate}})}else e.RTCPeerConnection=function(t,n){return i("PeerConnection"),t&&t.iceTransportPolicy&&(t.iceTransports=t.iceTransportPolicy),new e.webkitRTCPeerConnection(t,n)},e.RTCPeerConnection.prototype=e.webkitRTCPeerConnection.prototype,e.webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return e.webkitRTCPeerConnection.generateCertificate}});var o=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,t,n){var r=this,i=arguments;if(arguments.length>0&&"function"==typeof e)return o.apply(this,arguments);if(0===o.length&&(0===arguments.length||"function"!=typeof arguments[0]))return o.apply(this,[]);var a=function(e){var t={};return e.result().forEach(function(e){var n={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach(function(t){n[t]=e.stat(t)}),t[n.id]=n}),t},s=function(e){return new Map(Object.keys(e).map(function(t){return[t,e[t]]}))};if(arguments.length>=2){return o.apply(this,[function(e){i[1](s(a(e)))},arguments[0]])}return new Promise(function(e,t){o.apply(r,[function(t){e(s(a(t)))},t])}).then(t,n)},t.version<51&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=arguments,t=this,r=new Promise(function(r,i){n.apply(t,[e[0],r,i])});return e.length<2?r:r.then(function(){e[1].apply(null,[])},function(t){e.length>=3&&e[2].apply(null,[t])})}}),t.version<52&&["createOffer","createAnswer"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=this;if(arguments.length<1||1===arguments.length&&"object"==typeof arguments[0]){var t=1===arguments.length?arguments[0]:void 0;return new Promise(function(r,i){n.apply(e,[r,i,t])})}return n.apply(this,arguments)}}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}});var a=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?a.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}};e.exports={shimMediaStream:o.shimMediaStream,shimOnTrack:o.shimOnTrack,shimAddTrackRemoveTrack:o.shimAddTrackRemoveTrack,shimGetSendersWithDtmf:o.shimGetSendersWithDtmf,shimSourceObject:o.shimSourceObject,shimPeerConnection:o.shimPeerConnection,shimGetUserMedia:n(336)}},function(e,t,n){"use strict";var r=n(69),i=r.log;e.exports=function(e){var t=r.detectBrowser(e),n=e&&e.navigator,o=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach(function(n){if("require"!==n&&"advanced"!==n&&"mediaSource"!==n){var r="object"==typeof e[n]?e[n]:{ideal:e[n]};void 0!==r.exact&&"number"==typeof r.exact&&(r.min=r.max=r.exact);var i=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==r.ideal){t.optional=t.optional||[];var o={};"number"==typeof r.ideal?(o[i("min",n)]=r.ideal,t.optional.push(o),(o={})[i("max",n)]=r.ideal,t.optional.push(o)):(o[i("",n)]=r.ideal,t.optional.push(o))}void 0!==r.exact&&"number"!=typeof r.exact?(t.mandatory=t.mandatory||{},t.mandatory[i("",n)]=r.exact):["min","max"].forEach(function(e){void 0!==r[e]&&(t.mandatory=t.mandatory||{},t.mandatory[i(e,n)]=r[e])})}}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},a=function(e,r){if(t.version>=61)return r(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"==typeof e.audio){var a=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])};a((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),a(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=o(e.audio)}if(e&&"object"==typeof e.video){var s=e.video.facingMode;s=s&&("object"==typeof s?s:{ideal:s});var c,u=t.version<66;if(s&&("user"===s.exact||"environment"===s.exact||"user"===s.ideal||"environment"===s.ideal)&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||u))if(delete e.video.facingMode,"environment"===s.exact||"environment"===s.ideal?c=["back","rear"]:"user"!==s.exact&&"user"!==s.ideal||(c=["front"]),c)return n.mediaDevices.enumerateDevices().then(function(t){var n=(t=t.filter(function(e){return"videoinput"===e.kind})).find(function(e){return c.some(function(t){return-1!==e.label.toLowerCase().indexOf(t)})});return!n&&t.length&&-1!==c.indexOf("back")&&(n=t[t.length-1]),n&&(e.video.deviceId=s.exact?{exact:n.deviceId}:{ideal:n.deviceId}),e.video=o(e.video),i("chrome: "+JSON.stringify(e)),r(e)});e.video=o(e.video)}return i("chrome: "+JSON.stringify(e)),r(e)},s=function(e){return{name:{PermissionDeniedError:"NotAllowedError",InvalidStateError:"NotReadableError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotReadableError",MediaDeviceKillSwitchOn:"NotReadableError"}[e.name]||e.name,message:e.message,constraint:e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};n.getUserMedia=function(e,t,r){a(e,function(e){n.webkitGetUserMedia(e,t,function(e){r&&r(s(e))})})};var c=function(e){return new Promise(function(t,r){n.getUserMedia(e,t,r)})};if(n.mediaDevices||(n.mediaDevices={getUserMedia:c,enumerateDevices:function(){return new Promise(function(t){var n={audio:"audioinput",video:"videoinput"};return e.MediaStreamTrack.getSources(function(e){t(e.map(function(e){return{label:e.label,kind:n[e.kind],deviceId:e.id,groupId:""}}))})})},getSupportedConstraints:function(){return{deviceId:!0,echoCancellation:!0,facingMode:!0,frameRate:!0,height:!0,width:!0}}}),n.mediaDevices.getUserMedia){var u=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(e){return a(e,function(e){return u(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(e){e.stop()}),new DOMException("","NotFoundError");return t},function(e){return Promise.reject(s(e))})})}}else n.mediaDevices.getUserMedia=function(e){return c(e)};void 0===n.mediaDevices.addEventListener&&(n.mediaDevices.addEventListener=function(){i("Dummy mediaDevices.addEventListener called.")}),void 0===n.mediaDevices.removeEventListener&&(n.mediaDevices.removeEventListener=function(){i("Dummy mediaDevices.removeEventListener called.")})}},function(e,t,n){"use strict";var r=n(69),i=n(338);e.exports={shimGetUserMedia:n(339),shimPeerConnection:function(e){var t=r.detectBrowser(e);if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(e){return e}),e.RTCSessionDescription||(e.RTCSessionDescription=function(e){return e}),t.version<15025)){var n=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set:function(e){n.set.call(this,e);var t=new Event("enabled");t.enabled=e,this.dispatchEvent(t)}})}!e.RTCRtpSender||"dtmf"in e.RTCRtpSender.prototype||Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new e.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),e.RTCPeerConnection=i(e,t.version)},shimReplaceTrack:function(e){!e.RTCRtpSender||"replaceTrack"in e.RTCRtpSender.prototype||(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)}}},function(e,t,n){"use strict";var r=n(208);function i(e,t,n,i,o){var a=r.writeRtpDescription(e.kind,t);if(a+=r.writeIceParameters(e.iceGatherer.getLocalParameters()),a+=r.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":o||"active"),a+="a=mid:"+e.mid+"\r\n",e.rtpSender&&e.rtpReceiver?a+="a=sendrecv\r\n":e.rtpSender?a+="a=sendonly\r\n":e.rtpReceiver?a+="a=recvonly\r\n":a+="a=inactive\r\n",e.rtpSender){var s=e.rtpSender._initialTrackId||e.rtpSender.track.id;e.rtpSender._initialTrackId=s;var c="msid:"+(i?i.id:"-")+" "+s+"\r\n";a+="a="+c,a+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+c,e.sendEncodingParameters[0].rtx&&(a+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+c,a+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return a+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+r.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(a+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+r.localCName+"\r\n"),a}function o(e,t){var n={codecs:[],headerExtensions:[],fecMechanisms:[]},r=function(e,t){e=parseInt(e,10);for(var n=0;n<t.length;n++)if(t[n].payloadType===e||t[n].preferredPayloadType===e)return t[n]},i=function(e,t,n,i){var o=r(e.parameters.apt,n),a=r(t.parameters.apt,i);return o&&a&&o.name.toLowerCase()===a.name.toLowerCase()};return e.codecs.forEach(function(r){for(var o=0;o<t.codecs.length;o++){var a=t.codecs[o];if(r.name.toLowerCase()===a.name.toLowerCase()&&r.clockRate===a.clockRate){if("rtx"===r.name.toLowerCase()&&r.parameters&&a.parameters.apt&&!i(r,a,e.codecs,t.codecs))continue;(a=JSON.parse(JSON.stringify(a))).numChannels=Math.min(r.numChannels,a.numChannels),n.codecs.push(a),a.rtcpFeedback=a.rtcpFeedback.filter(function(e){for(var t=0;t<r.rtcpFeedback.length;t++)if(r.rtcpFeedback[t].type===e.type&&r.rtcpFeedback[t].parameter===e.parameter)return!0;return!1});break}}}),e.headerExtensions.forEach(function(e){for(var r=0;r<t.headerExtensions.length;r++){var i=t.headerExtensions[r];if(e.uri===i.uri){n.headerExtensions.push(i);break}}}),n}function a(e,t,n){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(n)}function s(e,t){var n=e.getRemoteCandidates().find(function(e){return t.foundation===e.foundation&&t.ip===e.ip&&t.port===e.port&&t.priority===e.priority&&t.protocol===e.protocol&&t.type===e.type});return n||e.addRemoteCandidate(t),!n}function c(e,t){var n=new Error(t);return n.name=e,n.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[e],n}e.exports=function(e,t){function n(t,n){n.addTrack(t),n.dispatchEvent(new e.MediaStreamTrackEvent("addtrack",{track:t}))}function u(t,n,r,i){var o=new Event("track");o.track=n,o.receiver=r,o.transceiver={receiver:r},o.streams=i,e.setTimeout(function(){t._dispatchEvent("track",o)})}var d=function(n){var i=this,o=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(e){i[e]=o[e].bind(o)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",n=JSON.parse(JSON.stringify(n||{})),this.usingBundle="max-bundle"===n.bundlePolicy,"negotiate"===n.rtcpMuxPolicy)throw c("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(n.rtcpMuxPolicy||(n.rtcpMuxPolicy="require"),n.iceTransportPolicy){case"all":case"relay":break;default:n.iceTransportPolicy="all"}switch(n.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:n.bundlePolicy="balanced"}if(n.iceServers=function(e,t){var n=!1;return(e=JSON.parse(JSON.stringify(e))).filter(function(e){if(e&&(e.urls||e.url)){var r=e.urls||e.url;e.url&&!e.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var i="string"==typeof r;return i&&(r=[r]),r=r.filter(function(e){return 0!==e.indexOf("turn:")||-1===e.indexOf("transport=udp")||-1!==e.indexOf("turn:[")||n?0===e.indexOf("stun:")&&t>=14393&&-1===e.indexOf("?transport=udp"):(n=!0,!0)}),delete e.url,e.urls=i?r[0]:r,!!r.length}})}(n.iceServers||[],t),this._iceGatherers=[],n.iceCandidatePoolSize)for(var a=n.iceCandidatePoolSize;a>0;a--)this._iceGatherers.push(new e.RTCIceGatherer({iceServers:n.iceServers,gatherPolicy:n.iceTransportPolicy}));else n.iceCandidatePoolSize=0;this._config=n,this.transceivers=[],this._sdpSessionId=r.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(d.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(d.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),d.prototype.onicecandidate=null,d.prototype.onaddstream=null,d.prototype.ontrack=null,d.prototype.onremovestream=null,d.prototype.onsignalingstatechange=null,d.prototype.oniceconnectionstatechange=null,d.prototype.onconnectionstatechange=null,d.prototype.onicegatheringstatechange=null,d.prototype.onnegotiationneeded=null,d.prototype.ondatachannel=null,d.prototype._dispatchEvent=function(e,t){this._isClosed||(this.dispatchEvent(t),"function"==typeof this["on"+e]&&this["on"+e](t))},d.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",e)},d.prototype.getConfiguration=function(){return this._config},d.prototype.getLocalStreams=function(){return this.localStreams},d.prototype.getRemoteStreams=function(){return this.remoteStreams},d.prototype._createTransceiver=function(e,t){var n=this.transceivers.length>0,r={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&n)r.iceTransport=this.transceivers[0].iceTransport,r.dtlsTransport=this.transceivers[0].dtlsTransport;else{var i=this._createIceAndDtlsTransports();r.iceTransport=i.iceTransport,r.dtlsTransport=i.dtlsTransport}return t||this.transceivers.push(r),r},d.prototype.addTrack=function(t,n){if(this._isClosed)throw c("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var r;if(this.transceivers.find(function(e){return e.track===t}))throw c("InvalidAccessError","Track already exists.");for(var i=0;i<this.transceivers.length;i++)this.transceivers[i].track||this.transceivers[i].kind!==t.kind||(r=this.transceivers[i]);return r||(r=this._createTransceiver(t.kind)),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(n)&&this.localStreams.push(n),r.track=t,r.stream=n,r.rtpSender=new e.RTCRtpSender(t,r.dtlsTransport),r.rtpSender},d.prototype.addStream=function(e){var n=this;if(t>=15025)e.getTracks().forEach(function(t){n.addTrack(t,e)});else{var r=e.clone();e.getTracks().forEach(function(e,t){var n=r.getTracks()[t];e.addEventListener("enabled",function(e){n.enabled=e.enabled})}),r.getTracks().forEach(function(e){n.addTrack(e,r)})}},d.prototype.removeTrack=function(t){if(this._isClosed)throw c("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(t instanceof e.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var n=this.transceivers.find(function(e){return e.rtpSender===t});if(!n)throw c("InvalidAccessError","Sender was not created by this connection.");var r=n.stream;n.rtpSender.stop(),n.rtpSender=null,n.track=null,n.stream=null,-1===this.transceivers.map(function(e){return e.stream}).indexOf(r)&&this.localStreams.indexOf(r)>-1&&this.localStreams.splice(this.localStreams.indexOf(r),1),this._maybeFireNegotiationNeeded()},d.prototype.removeStream=function(e){var t=this;e.getTracks().forEach(function(e){var n=t.getSenders().find(function(t){return t.track===e});n&&t.removeTrack(n)})},d.prototype.getSenders=function(){return this.transceivers.filter(function(e){return!!e.rtpSender}).map(function(e){return e.rtpSender})},d.prototype.getReceivers=function(){return this.transceivers.filter(function(e){return!!e.rtpReceiver}).map(function(e){return e.rtpReceiver})},d.prototype._createIceGatherer=function(t,n){var r=this;if(n&&t>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var i=new e.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(i,"state",{value:"new",writable:!0}),this.transceivers[t].bufferedCandidateEvents=[],this.transceivers[t].bufferCandidates=function(e){var n=!e.candidate||0===Object.keys(e.candidate).length;i.state=n?"completed":"gathering",null!==r.transceivers[t].bufferedCandidateEvents&&r.transceivers[t].bufferedCandidateEvents.push(e)},i.addEventListener("localcandidate",this.transceivers[t].bufferCandidates),i},d.prototype._gather=function(t,n){var i=this,o=this.transceivers[n].iceGatherer;if(!o.onlocalcandidate){var a=this.transceivers[n].bufferedCandidateEvents;this.transceivers[n].bufferedCandidateEvents=null,o.removeEventListener("localcandidate",this.transceivers[n].bufferCandidates),o.onlocalcandidate=function(e){if(!(i.usingBundle&&n>0)){var a=new Event("icecandidate");a.candidate={sdpMid:t,sdpMLineIndex:n};var s=e.candidate,c=!s||0===Object.keys(s).length;if(c)"new"!==o.state&&"gathering"!==o.state||(o.state="completed");else{"new"===o.state&&(o.state="gathering"),s.component=1,s.ufrag=o.getLocalParameters().usernameFragment;var u=r.writeCandidate(s);a.candidate=Object.assign(a.candidate,r.parseCandidate(u)),a.candidate.candidate=u,a.candidate.toJSON=function(){return{candidate:a.candidate.candidate,sdpMid:a.candidate.sdpMid,sdpMLineIndex:a.candidate.sdpMLineIndex,usernameFragment:a.candidate.usernameFragment}}}var d=r.getMediaSections(i._localDescription.sdp);d[a.candidate.sdpMLineIndex]+=c?"a=end-of-candidates\r\n":"a="+a.candidate.candidate+"\r\n",i._localDescription.sdp=r.getDescription(i._localDescription.sdp)+d.join("");var l=i.transceivers.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state});"gathering"!==i.iceGatheringState&&(i.iceGatheringState="gathering",i._emitGatheringStateChange()),c||i._dispatchEvent("icecandidate",a),l&&(i._dispatchEvent("icecandidate",new Event("icecandidate")),i.iceGatheringState="complete",i._emitGatheringStateChange())}},e.setTimeout(function(){a.forEach(function(e){o.onlocalcandidate(e)})},0)}},d.prototype._createIceAndDtlsTransports=function(){var t=this,n=new e.RTCIceTransport(null);n.onicestatechange=function(){t._updateIceConnectionState(),t._updateConnectionState()};var r=new e.RTCDtlsTransport(n);return r.ondtlsstatechange=function(){t._updateConnectionState()},r.onerror=function(){Object.defineProperty(r,"state",{value:"failed",writable:!0}),t._updateConnectionState()},{iceTransport:n,dtlsTransport:r}},d.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;t&&(delete t.onlocalcandidate,delete this.transceivers[e].iceGatherer);var n=this.transceivers[e].iceTransport;n&&(delete n.onicestatechange,delete this.transceivers[e].iceTransport);var r=this.transceivers[e].dtlsTransport;r&&(delete r.ondtlsstatechange,delete r.onerror,delete this.transceivers[e].dtlsTransport)},d.prototype._transceive=function(e,n,i){var a=o(e.localCapabilities,e.remoteCapabilities);n&&e.rtpSender&&(a.encodings=e.sendEncodingParameters,a.rtcp={cname:r.localCName,compound:e.rtcpParameters.compound},e.recvEncodingParameters.length&&(a.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(a)),i&&e.rtpReceiver&&a.codecs.length>0&&("video"===e.kind&&e.recvEncodingParameters&&t<15019&&e.recvEncodingParameters.forEach(function(e){delete e.rtx}),e.recvEncodingParameters.length?a.encodings=e.recvEncodingParameters:a.encodings=[{}],a.rtcp={compound:e.rtcpParameters.compound},e.rtcpParameters.cname&&(a.rtcp.cname=e.rtcpParameters.cname),e.sendEncodingParameters.length&&(a.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(a))},d.prototype.setLocalDescription=function(e){var t,n,i=this;if(-1===["offer","answer"].indexOf(e.type))return Promise.reject(c("TypeError",'Unsupported type "'+e.type+'"'));if(!a("setLocalDescription",e.type,i.signalingState)||i._isClosed)return Promise.reject(c("InvalidStateError","Can not set local "+e.type+" in state "+i.signalingState));if("offer"===e.type)t=r.splitSections(e.sdp),n=t.shift(),t.forEach(function(e,t){var n=r.parseRtpParameters(e);i.transceivers[t].localCapabilities=n}),i.transceivers.forEach(function(e,t){i._gather(e.mid,t)});else if("answer"===e.type){t=r.splitSections(i._remoteDescription.sdp),n=t.shift();var s=r.matchPrefix(n,"a=ice-lite").length>0;t.forEach(function(e,t){var a=i.transceivers[t],c=a.iceGatherer,u=a.iceTransport,d=a.dtlsTransport,l=a.localCapabilities,p=a.remoteCapabilities;if(!(r.isRejected(e)&&0===r.matchPrefix(e,"a=bundle-only").length)&&!a.rejected){var f=r.getIceParameters(e,n),h=r.getDtlsParameters(e,n);s&&(h.role="server"),i.usingBundle&&0!==t||(i._gather(a.mid,t),"new"===u.state&&u.start(c,f,s?"controlling":"controlled"),"new"===d.state&&d.start(h));var m=o(l,p);i._transceive(a,m.codecs.length>0,!1)}})}return i._localDescription={type:e.type,sdp:e.sdp},"offer"===e.type?i._updateSignalingState("have-local-offer"):i._updateSignalingState("stable"),Promise.resolve()},d.prototype.setRemoteDescription=function(i){var o=this;if(-1===["offer","answer"].indexOf(i.type))return Promise.reject(c("TypeError",'Unsupported type "'+i.type+'"'));if(!a("setRemoteDescription",i.type,o.signalingState)||o._isClosed)return Promise.reject(c("InvalidStateError","Can not set remote "+i.type+" in state "+o.signalingState));var d={};o.remoteStreams.forEach(function(e){d[e.id]=e});var l=[],p=r.splitSections(i.sdp),f=p.shift(),h=r.matchPrefix(f,"a=ice-lite").length>0,m=r.matchPrefix(f,"a=group:BUNDLE ").length>0;o.usingBundle=m;var v=r.matchPrefix(f,"a=ice-options:")[0];return o.canTrickleIceCandidates=!!v&&v.substr(14).split(" ").indexOf("trickle")>=0,p.forEach(function(a,c){var u=r.splitLines(a),p=r.getKind(a),v=r.isRejected(a)&&0===r.matchPrefix(a,"a=bundle-only").length,g=u[0].substr(2).split(" ")[2],y=r.getDirection(a,f),S=r.parseMsid(a),b=r.getMid(a)||r.generateIdentifier();if(v||"application"===p&&("DTLS/SCTP"===g||"UDP/DTLS/SCTP"===g))o.transceivers[c]={mid:b,kind:p,protocol:g,rejected:!0};else{var C,_,T,R,w,k,E,P,O;!v&&o.transceivers[c]&&o.transceivers[c].rejected&&(o.transceivers[c]=o._createTransceiver(p,!0));var I,A,x=r.parseRtpParameters(a);v||(I=r.getIceParameters(a,f),(A=r.getDtlsParameters(a,f)).role="client"),E=r.parseRtpEncodingParameters(a);var M=r.parseRtcpParameters(a),D=r.matchPrefix(a,"a=end-of-candidates",f).length>0,L=r.matchPrefix(a,"a=candidate:").map(function(e){return r.parseCandidate(e)}).filter(function(e){return 1===e.component});if(("offer"===i.type||"answer"===i.type)&&!v&&m&&c>0&&o.transceivers[c]&&(o._disposeIceAndDtlsTransports(c),o.transceivers[c].iceGatherer=o.transceivers[0].iceGatherer,o.transceivers[c].iceTransport=o.transceivers[0].iceTransport,o.transceivers[c].dtlsTransport=o.transceivers[0].dtlsTransport,o.transceivers[c].rtpSender&&o.transceivers[c].rtpSender.setTransport(o.transceivers[0].dtlsTransport),o.transceivers[c].rtpReceiver&&o.transceivers[c].rtpReceiver.setTransport(o.transceivers[0].dtlsTransport)),"offer"!==i.type||v)"answer"!==i.type||v||(_=(C=o.transceivers[c]).iceGatherer,T=C.iceTransport,R=C.dtlsTransport,w=C.rtpReceiver,k=C.sendEncodingParameters,P=C.localCapabilities,o.transceivers[c].recvEncodingParameters=E,o.transceivers[c].remoteCapabilities=x,o.transceivers[c].rtcpParameters=M,L.length&&"new"===T.state&&(!h&&!D||m&&0!==c?L.forEach(function(e){s(C.iceTransport,e)}):T.setRemoteCandidates(L)),m&&0!==c||("new"===T.state&&T.start(_,I,"controlling"),"new"===R.state&&R.start(A)),o._transceive(C,"sendrecv"===y||"recvonly"===y,"sendrecv"===y||"sendonly"===y),!w||"sendrecv"!==y&&"sendonly"!==y?delete C.rtpReceiver:(O=w.track,S?(d[S.stream]||(d[S.stream]=new e.MediaStream),n(O,d[S.stream]),l.push([O,w,d[S.stream]])):(d.default||(d.default=new e.MediaStream),n(O,d.default),l.push([O,w,d.default]))));else{(C=o.transceivers[c]||o._createTransceiver(p)).mid=b,C.iceGatherer||(C.iceGatherer=o._createIceGatherer(c,m)),L.length&&"new"===C.iceTransport.state&&(!D||m&&0!==c?L.forEach(function(e){s(C.iceTransport,e)}):C.iceTransport.setRemoteCandidates(L)),P=e.RTCRtpReceiver.getCapabilities(p),t<15019&&(P.codecs=P.codecs.filter(function(e){return"rtx"!==e.name})),k=C.sendEncodingParameters||[{ssrc:1001*(2*c+2)}];var j,N=!1;if("sendrecv"===y||"sendonly"===y){if(N=!C.rtpReceiver,w=C.rtpReceiver||new e.RTCRtpReceiver(C.dtlsTransport,p),N)O=w.track,S&&"-"===S.stream||(S?(d[S.stream]||(d[S.stream]=new e.MediaStream,Object.defineProperty(d[S.stream],"id",{get:function(){return S.stream}})),Object.defineProperty(O,"id",{get:function(){return S.track}}),j=d[S.stream]):(d.default||(d.default=new e.MediaStream),j=d.default)),j&&(n(O,j),C.associatedRemoteMediaStreams.push(j)),l.push([O,w,j])}else C.rtpReceiver&&C.rtpReceiver.track&&(C.associatedRemoteMediaStreams.forEach(function(t){var n=t.getTracks().find(function(e){return e.id===C.rtpReceiver.track.id});n&&function(t,n){n.removeTrack(t),n.dispatchEvent(new e.MediaStreamTrackEvent("removetrack",{track:t}))}(n,t)}),C.associatedRemoteMediaStreams=[]);C.localCapabilities=P,C.remoteCapabilities=x,C.rtpReceiver=w,C.rtcpParameters=M,C.sendEncodingParameters=k,C.recvEncodingParameters=E,o._transceive(o.transceivers[c],!1,N)}}}),void 0===o._dtlsRole&&(o._dtlsRole="offer"===i.type?"active":"passive"),o._remoteDescription={type:i.type,sdp:i.sdp},"offer"===i.type?o._updateSignalingState("have-remote-offer"):o._updateSignalingState("stable"),Object.keys(d).forEach(function(t){var n=d[t];if(n.getTracks().length){if(-1===o.remoteStreams.indexOf(n)){o.remoteStreams.push(n);var r=new Event("addstream");r.stream=n,e.setTimeout(function(){o._dispatchEvent("addstream",r)})}l.forEach(function(e){var t=e[0],r=e[1];n.id===e[2].id&&u(o,t,r,[n])})}}),l.forEach(function(e){e[2]||u(o,e[0],e[1],[])}),e.setTimeout(function(){o&&o.transceivers&&o.transceivers.forEach(function(e){e.iceTransport&&"new"===e.iceTransport.state&&e.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),e.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},d.prototype.close=function(){this.transceivers.forEach(function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},d.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",t)},d.prototype._maybeFireNegotiationNeeded=function(){var t=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,e.setTimeout(function(){if(t.needNegotiation){t.needNegotiation=!1;var e=new Event("negotiationneeded");t._dispatchEvent("negotiationneeded",e)}},0))},d.prototype._updateIceConnectionState=function(){var e,t={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(e){t[e.iceTransport.state]++}),e="new",t.failed>0?e="failed":t.checking>0?e="checking":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0?e="connected":t.completed>0&&(e="completed"),e!==this.iceConnectionState){this.iceConnectionState=e;var n=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",n)}},d.prototype._updateConnectionState=function(){var e,t={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(e){t[e.iceTransport.state]++,t[e.dtlsTransport.state]++}),t.connected+=t.completed,e="new",t.failed>0?e="failed":t.connecting>0?e="connecting":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0&&(e="connected"),e!==this.connectionState){this.connectionState=e;var n=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",n)}},d.prototype.createOffer=function(){var n=this;if(n._isClosed)return Promise.reject(c("InvalidStateError","Can not call createOffer after close"));var o=n.transceivers.filter(function(e){return"audio"===e.kind}).length,a=n.transceivers.filter(function(e){return"video"===e.kind}).length,s=arguments[0];if(s){if(s.mandatory||s.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==s.offerToReceiveAudio&&(o=!0===s.offerToReceiveAudio?1:!1===s.offerToReceiveAudio?0:s.offerToReceiveAudio),void 0!==s.offerToReceiveVideo&&(a=!0===s.offerToReceiveVideo?1:!1===s.offerToReceiveVideo?0:s.offerToReceiveVideo)}for(n.transceivers.forEach(function(e){"audio"===e.kind?--o<0&&(e.wantReceive=!1):"video"===e.kind&&--a<0&&(e.wantReceive=!1)});o>0||a>0;)o>0&&(n._createTransceiver("audio"),o--),a>0&&(n._createTransceiver("video"),a--);var u=r.writeSessionBoilerplate(n._sdpSessionId,n._sdpSessionVersion++);n.transceivers.forEach(function(i,o){var a=i.track,s=i.kind,c=i.mid||r.generateIdentifier();i.mid=c,i.iceGatherer||(i.iceGatherer=n._createIceGatherer(o,n.usingBundle));var u=e.RTCRtpSender.getCapabilities(s);t<15019&&(u.codecs=u.codecs.filter(function(e){return"rtx"!==e.name})),u.codecs.forEach(function(e){"H264"===e.name&&void 0===e.parameters["level-asymmetry-allowed"]&&(e.parameters["level-asymmetry-allowed"]="1"),i.remoteCapabilities&&i.remoteCapabilities.codecs&&i.remoteCapabilities.codecs.forEach(function(t){e.name.toLowerCase()===t.name.toLowerCase()&&e.clockRate===t.clockRate&&(e.preferredPayloadType=t.payloadType)})}),u.headerExtensions.forEach(function(e){(i.remoteCapabilities&&i.remoteCapabilities.headerExtensions||[]).forEach(function(t){e.uri===t.uri&&(e.id=t.id)})});var d=i.sendEncodingParameters||[{ssrc:1001*(2*o+1)}];a&&t>=15019&&"video"===s&&!d[0].rtx&&(d[0].rtx={ssrc:d[0].ssrc+1}),i.wantReceive&&(i.rtpReceiver=new e.RTCRtpReceiver(i.dtlsTransport,s)),i.localCapabilities=u,i.sendEncodingParameters=d}),"max-compat"!==n._config.bundlePolicy&&(u+="a=group:BUNDLE "+n.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),u+="a=ice-options:trickle\r\n",n.transceivers.forEach(function(e,t){u+=i(e,e.localCapabilities,"offer",e.stream,n._dtlsRole),u+="a=rtcp-rsize\r\n",!e.iceGatherer||"new"===n.iceGatheringState||0!==t&&n.usingBundle||(e.iceGatherer.getLocalCandidates().forEach(function(e){e.component=1,u+="a="+r.writeCandidate(e)+"\r\n"}),"completed"===e.iceGatherer.state&&(u+="a=end-of-candidates\r\n"))});var d=new e.RTCSessionDescription({type:"offer",sdp:u});return Promise.resolve(d)},d.prototype.createAnswer=function(){var n=this;if(n._isClosed)return Promise.reject(c("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==n.signalingState&&"have-local-pranswer"!==n.signalingState)return Promise.reject(c("InvalidStateError","Can not call createAnswer in signalingState "+n.signalingState));var a=r.writeSessionBoilerplate(n._sdpSessionId,n._sdpSessionVersion++);n.usingBundle&&(a+="a=group:BUNDLE "+n.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n");var s=r.getMediaSections(n._remoteDescription.sdp).length;n.transceivers.forEach(function(e,r){if(!(r+1>s)){if(e.rejected)return"application"===e.kind?"DTLS/SCTP"===e.protocol?a+="m=application 0 DTLS/SCTP 5000\r\n":a+="m=application 0 "+e.protocol+" webrtc-datachannel\r\n":"audio"===e.kind?a+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===e.kind&&(a+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),void(a+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+e.mid+"\r\n");var c;if(e.stream)"audio"===e.kind?c=e.stream.getAudioTracks()[0]:"video"===e.kind&&(c=e.stream.getVideoTracks()[0]),c&&t>=15019&&"video"===e.kind&&!e.sendEncodingParameters[0].rtx&&(e.sendEncodingParameters[0].rtx={ssrc:e.sendEncodingParameters[0].ssrc+1});var u=o(e.localCapabilities,e.remoteCapabilities);!u.codecs.filter(function(e){return"rtx"===e.name.toLowerCase()}).length&&e.sendEncodingParameters[0].rtx&&delete e.sendEncodingParameters[0].rtx,a+=i(e,u,"answer",e.stream,n._dtlsRole),e.rtcpParameters&&e.rtcpParameters.reducedSize&&(a+="a=rtcp-rsize\r\n")}});var u=new e.RTCSessionDescription({type:"answer",sdp:a});return Promise.resolve(u)},d.prototype.addIceCandidate=function(e){var t,n=this;return e&&void 0===e.sdpMLineIndex&&!e.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(i,o){if(!n._remoteDescription)return o(c("InvalidStateError","Can not add ICE candidate without a remote description"));if(e&&""!==e.candidate){var a=e.sdpMLineIndex;if(e.sdpMid)for(var u=0;u<n.transceivers.length;u++)if(n.transceivers[u].mid===e.sdpMid){a=u;break}var d=n.transceivers[a];if(!d)return o(c("OperationError","Can not add ICE candidate"));if(d.rejected)return i();var l=Object.keys(e.candidate).length>0?r.parseCandidate(e.candidate):{};if("tcp"===l.protocol&&(0===l.port||9===l.port))return i();if(l.component&&1!==l.component)return i();if((0===a||a>0&&d.iceTransport!==n.transceivers[0].iceTransport)&&!s(d.iceTransport,l))return o(c("OperationError","Can not add ICE candidate"));var p=e.candidate.trim();0===p.indexOf("a=")&&(p=p.substr(2)),(t=r.getMediaSections(n._remoteDescription.sdp))[a]+="a="+(l.type?p:"end-of-candidates")+"\r\n",n._remoteDescription.sdp=r.getDescription(n._remoteDescription.sdp)+t.join("")}else for(var f=0;f<n.transceivers.length&&(n.transceivers[f].rejected||(n.transceivers[f].iceTransport.addRemoteCandidate({}),(t=r.getMediaSections(n._remoteDescription.sdp))[f]+="a=end-of-candidates\r\n",n._remoteDescription.sdp=r.getDescription(n._remoteDescription.sdp)+t.join(""),!n.usingBundle));f++);i()})},d.prototype.getStats=function(t){if(t&&t instanceof e.MediaStreamTrack){var n=null;if(this.transceivers.forEach(function(e){e.rtpSender&&e.rtpSender.track===t?n=e.rtpSender:e.rtpReceiver&&e.rtpReceiver.track===t&&(n=e.rtpReceiver)}),!n)throw c("InvalidAccessError","Invalid selector.");return n.getStats()}var r=[];return this.transceivers.forEach(function(e){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(t){e[t]&&r.push(e[t].getStats())})}),Promise.all(r).then(function(e){var t=new Map;return e.forEach(function(e){e.forEach(function(e){t.set(e.id,e)})}),t})};["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach(function(t){var n=e[t];if(n&&n.prototype&&n.prototype.getStats){var r=n.prototype.getStats;n.prototype.getStats=function(){return r.apply(this).then(function(e){var t=new Map;return Object.keys(e).forEach(function(n){e[n].type=function(e){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type}(e[n]),t.set(n,e[n])}),t})}}});var l=["createOffer","createAnswer"];return l.forEach(function(e){var t=d.prototype[e];d.prototype[e]=function(){var e=arguments;return"function"==typeof e[0]||"function"==typeof e[1]?t.apply(this,[arguments[2]]).then(function(t){"function"==typeof e[0]&&e[0].apply(null,[t])},function(t){"function"==typeof e[1]&&e[1].apply(null,[t])}):t.apply(this,arguments)}}),(l=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach(function(e){var t=d.prototype[e];d.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]||"function"==typeof e[2]?t.apply(this,arguments).then(function(){"function"==typeof e[1]&&e[1].apply(null)},function(t){"function"==typeof e[2]&&e[2].apply(null,[t])}):t.apply(this,arguments)}}),["getStats"].forEach(function(e){var t=d.prototype[e];d.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]?t.apply(this,arguments).then(function(){"function"==typeof e[1]&&e[1].apply(null)}):t.apply(this,arguments)}}),d}},function(e,t,n){"use strict";e.exports=function(e){var t=e&&e.navigator,n=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return n(e).catch(function(e){return Promise.reject(function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString:function(){return this.name}}}(e))})}}},function(e,t,n){"use strict";var r=n(69),i={shimOnTrack:function(e){"object"!=typeof e||!e.RTCPeerConnection||"ontrack"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=e),this.addEventListener("addstream",this._ontrackpoly=function(e){e.stream.getTracks().forEach(function(t){var n=new Event("track");n.track=t,n.receiver={track:t},n.transceiver={receiver:n.receiver},n.streams=[e.stream],this.dispatchEvent(n)}.bind(this))}.bind(this))}}),"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimSourceObject:function(e){"object"==typeof e&&(!e.HTMLMediaElement||"srcObject"in e.HTMLMediaElement.prototype||Object.defineProperty(e.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(e){this.mozSrcObject=e}}))},shimPeerConnection:function(e){var t=r.detectBrowser(e);if("object"==typeof e&&(e.RTCPeerConnection||e.mozRTCPeerConnection)){e.RTCPeerConnection||(e.RTCPeerConnection=function(n,r){if(t.version<38&&n&&n.iceServers){for(var i=[],o=0;o<n.iceServers.length;o++){var a=n.iceServers[o];if(a.hasOwnProperty("urls"))for(var s=0;s<a.urls.length;s++){var c={url:a.urls[s]};0===a.urls[s].indexOf("turn")&&(c.username=a.username,c.credential=a.credential),i.push(c)}else i.push(n.iceServers[o])}n.iceServers=i}return new e.mozRTCPeerConnection(n,r)},e.RTCPeerConnection.prototype=e.mozRTCPeerConnection.prototype,e.mozRTCPeerConnection.generateCertificate&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return e.mozRTCPeerConnection.generateCertificate}}),e.RTCSessionDescription=e.mozRTCSessionDescription,e.RTCIceCandidate=e.mozRTCIceCandidate),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}});var n=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())};var i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},o=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,n,r){return o.apply(this,[e||null]).then(function(e){if(t.version<48&&(e=function(e){var t=new Map;return Object.keys(e).forEach(function(n){t.set(n,e[n]),t[n]=e[n]}),t}(e)),t.version<53&&!n)try{e.forEach(function(e){e.type=i[e.type]||e.type})}catch(t){if("TypeError"!==t.name)throw t;e.forEach(function(t,n){e.set(n,Object.assign({},t,{type:i[t.type]||t.type}))})}return e}).then(n,r)}}},shimRemoveStream:function(e){!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;r.deprecated("removeStream","removeTrack"),this.getSenders().forEach(function(n){n.track&&-1!==e.getTracks().indexOf(n.track)&&t.removeTrack(n)})})}};e.exports={shimOnTrack:i.shimOnTrack,shimSourceObject:i.shimSourceObject,shimPeerConnection:i.shimPeerConnection,shimRemoveStream:i.shimRemoveStream,shimGetUserMedia:n(341)}},function(e,t,n){"use strict";var r=n(69),i=r.log;e.exports=function(e){var t=r.detectBrowser(e),n=e&&e.navigator,o=e&&e.MediaStreamTrack,a=function(e){return{name:{InternalError:"NotReadableError",NotSupportedError:"TypeError",PermissionDeniedError:"NotAllowedError",SecurityError:"NotAllowedError"}[e.name]||e.name,message:{"The operation is insecure.":"The request is not allowed by the user agent or the platform in the current context."}[e.message]||e.message,constraint:e.constraint,toString:function(){return this.name+(this.message&&": ")+this.message}}},s=function(e,r,o){var s=function(e){if("object"!=typeof e||e.require)return e;var t=[];return Object.keys(e).forEach(function(n){if("require"!==n&&"advanced"!==n&&"mediaSource"!==n){var r=e[n]="object"==typeof e[n]?e[n]:{ideal:e[n]};if(void 0===r.min&&void 0===r.max&&void 0===r.exact||t.push(n),void 0!==r.exact&&("number"==typeof r.exact?r.min=r.max=r.exact:e[n]=r.exact,delete r.exact),void 0!==r.ideal){e.advanced=e.advanced||[];var i={};"number"==typeof r.ideal?i[n]={min:r.ideal,max:r.ideal}:i[n]=r.ideal,e.advanced.push(i),delete r.ideal,Object.keys(r).length||delete e[n]}}}),t.length&&(e.require=t),e};return e=JSON.parse(JSON.stringify(e)),t.version<38&&(i("spec: "+JSON.stringify(e)),e.audio&&(e.audio=s(e.audio)),e.video&&(e.video=s(e.video)),i("ff37: "+JSON.stringify(e))),n.mozGetUserMedia(e,r,function(e){o(a(e))})};if(n.mediaDevices||(n.mediaDevices={getUserMedia:function(e){return new Promise(function(t,n){s(e,t,n)})},addEventListener:function(){},removeEventListener:function(){}}),n.mediaDevices.enumerateDevices=n.mediaDevices.enumerateDevices||function(){return new Promise(function(e){e([{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}])})},t.version<41){var c=n.mediaDevices.enumerateDevices.bind(n.mediaDevices);n.mediaDevices.enumerateDevices=function(){return c().then(void 0,function(e){if("NotFoundError"===e.name)return[];throw e})}}if(t.version<49){var u=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(e){return u(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(e){e.stop()}),new DOMException("The object can not be found here.","NotFoundError");return t},function(e){return Promise.reject(a(e))})}}if(!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){var d=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},l=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(e){return"object"==typeof e&&"object"==typeof e.audio&&(e=JSON.parse(JSON.stringify(e)),d(e.audio,"autoGainControl","mozAutoGainControl"),d(e.audio,"noiseSuppression","mozNoiseSuppression")),l(e)},o&&o.prototype.getSettings){var p=o.prototype.getSettings;o.prototype.getSettings=function(){var e=p.apply(this,arguments);return d(e,"mozAutoGainControl","autoGainControl"),d(e,"mozNoiseSuppression","noiseSuppression"),e}}if(o&&o.prototype.applyConstraints){var f=o.prototype.applyConstraints;o.prototype.applyConstraints=function(e){return"audio"===this.kind&&"object"==typeof e&&(e=JSON.parse(JSON.stringify(e)),d(e,"autoGainControl","mozAutoGainControl"),d(e,"noiseSuppression","mozNoiseSuppression")),f.apply(this,[e])}}}n.getUserMedia=function(e,i,o){if(t.version<44)return s(e,i,o);r.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(e).then(i,o)}}},function(e,t,n){"use strict";var r=n(69),i={shimLocalStreamsAPI:function(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),"getStreamById"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getStreamById=function(e){var t=null;return this._localStreams&&this._localStreams.forEach(function(n){n.id===e&&(t=n)}),this._remoteStreams&&this._remoteStreams.forEach(function(n){n.id===e&&(t=n)}),t}),!("addStream"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),-1===this._localStreams.indexOf(e)&&this._localStreams.push(e);var n=this;e.getTracks().forEach(function(r){t.call(n,r,e)})},e.RTCPeerConnection.prototype.addTrack=function(e,n){return n&&(this._localStreams?-1===this._localStreams.indexOf(n)&&this._localStreams.push(n):this._localStreams=[n]),t.call(this,e,n)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);var t=this._localStreams.indexOf(e);if(-1!==t){this._localStreams.splice(t,1);var n=this,r=e.getTracks();this.getSenders().forEach(function(e){-1!==r.indexOf(e.track)&&n.removeTrack(e)})}})}},shimRemoteStreamsAPI:function(e){"object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),"onaddstream"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=function(e){var t=e.streams[0];if(this._remoteStreams||(this._remoteStreams=[]),!(this._remoteStreams.indexOf(t)>=0)){this._remoteStreams.push(t);var n=new Event("addstream");n.stream=e.streams[0],this.dispatchEvent(n)}}.bind(this))}}))},shimCallbacksAPI:function(e){if("object"==typeof e&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype,n=t.createOffer,r=t.createAnswer,i=t.setLocalDescription,o=t.setRemoteDescription,a=t.addIceCandidate;t.createOffer=function(e,t){var r=arguments.length>=2?arguments[2]:arguments[0],i=n.apply(this,[r]);return t?(i.then(e,t),Promise.resolve()):i},t.createAnswer=function(e,t){var n=arguments.length>=2?arguments[2]:arguments[0],i=r.apply(this,[n]);return t?(i.then(e,t),Promise.resolve()):i};var s=function(e,t,n){var r=i.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r};t.setLocalDescription=s,s=function(e,t,n){var r=o.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},t.setRemoteDescription=s,s=function(e,t,n){var r=a.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},t.addIceCandidate=s}},shimGetUserMedia:function(e){var t=e&&e.navigator;t.getUserMedia||(t.webkitGetUserMedia?t.getUserMedia=t.webkitGetUserMedia.bind(t):t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,n,r){t.mediaDevices.getUserMedia(e).then(n,r)}.bind(t)))},shimRTCIceServerUrls:function(e){var t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,n){if(e&&e.iceServers){for(var i=[],o=0;o<e.iceServers.length;o++){var a=e.iceServers[o];!a.hasOwnProperty("urls")&&a.hasOwnProperty("url")?(r.deprecated("RTCIceServer.url","RTCIceServer.urls"),(a=JSON.parse(JSON.stringify(a))).urls=a.url,delete a.url,i.push(a)):i.push(e.iceServers[o])}e.iceServers=i}return new t(e,n)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in e.RTCPeerConnection&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return t.generateCertificate}})},shimTrackEventTransceiver:function(e){"object"==typeof e&&e.RTCPeerConnection&&"receiver"in e.RTCTrackEvent.prototype&&!e.RTCTransceiver&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimCreateOfferLegacy:function(e){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){var n=this;if(e){var r=n.getTransceivers().find(function(e){return e.sender.track&&"audio"===e.sender.track.kind});!1===e.offerToReceiveAudio&&r?"sendrecv"===r.direction?r.setDirection("sendonly"):"recvonly"===r.direction&&r.setDirection("inactive"):!0!==e.offerToReceiveAudio||r||n.addTransceiver("audio");var i=n.getTransceivers().find(function(e){return e.sender.track&&"video"===e.sender.track.kind});!1===e.offerToReceiveVideo&&i?"sendrecv"===i.direction?i.setDirection("sendonly"):"recvonly"===i.direction&&i.setDirection("inactive"):!0!==e.offerToReceiveVideo||i||n.addTransceiver("video")}return t.apply(n,arguments)}}};e.exports={shimCallbacksAPI:i.shimCallbacksAPI,shimLocalStreamsAPI:i.shimLocalStreamsAPI,shimRemoteStreamsAPI:i.shimRemoteStreamsAPI,shimGetUserMedia:i.shimGetUserMedia,shimRTCIceServerUrls:i.shimRTCIceServerUrls,shimTrackEventTransceiver:i.shimTrackEventTransceiver,shimCreateOfferLegacy:i.shimCreateOfferLegacy}},function(e,t,n){"use strict";var r=n(208),i=n(69);e.exports={shimRTCIceCandidate:function(e){if(!(e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)){var t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){"object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2));var n=new t(e),i=r.parseCandidate(e.candidate),o=Object.assign(n,i);return o.toJSON=function(){return{candidate:o.candidate,sdpMid:o.sdpMid,sdpMLineIndex:o.sdpMLineIndex,usernameFragment:o.usernameFragment}},o},function(e,t,n){if(e.RTCPeerConnection){var r=e.RTCPeerConnection.prototype,i=r.addEventListener;r.addEventListener=function(e,r){if(e!==t)return i.apply(this,arguments);var o=function(e){r(n(e))};return this._eventMap=this._eventMap||{},this._eventMap[r]=o,i.apply(this,[e,o])};var o=r.removeEventListener;r.removeEventListener=function(e,n){if(e!==t||!this._eventMap||!this._eventMap[n])return o.apply(this,arguments);var r=this._eventMap[n];return delete this._eventMap[n],o.apply(this,[e,r])},Object.defineProperty(r,"on"+t,{get:function(){return this["_on"+t]},set:function(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)}})}}(e,"icecandidate",function(t){return t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t})}},shimCreateObjectURL:function(e){var t=e&&e.URL;if("object"==typeof e&&e.HTMLMediaElement&&"srcObject"in e.HTMLMediaElement.prototype&&t.createObjectURL&&t.revokeObjectURL){var n=t.createObjectURL.bind(t),r=t.revokeObjectURL.bind(t),o=new Map,a=0;t.createObjectURL=function(e){if("getTracks"in e){var t="polyblob:"+ ++a;return o.set(t,e),i.deprecated("URL.createObjectURL(stream)","elem.srcObject = stream"),t}return n(e)},t.revokeObjectURL=function(e){r(e),o.delete(e)};var s=Object.getOwnPropertyDescriptor(e.HTMLMediaElement.prototype,"src");Object.defineProperty(e.HTMLMediaElement.prototype,"src",{get:function(){return s.get.apply(this)},set:function(e){return this.srcObject=o.get(e)||null,s.set.apply(this,[e])}});var c=e.HTMLMediaElement.prototype.setAttribute;e.HTMLMediaElement.prototype.setAttribute=function(){return 2===arguments.length&&"src"===(""+arguments[0]).toLowerCase()&&(this.srcObject=o.get(arguments[1])||null),c.apply(this,arguments)}}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(117),i=function(e){return e&&e.__esModule?e:{default:e}}(n(73));t.default={destroyMediaStream:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{type:"all"};if("local"!==e.type&&"all"!==e.type||(this.destroyLocalMediaStream(),"local"!==e.type))if("remote"!==e.type){for(var t in this.remoteNode)this.destroyRemoteMediaStream(t);this.remoteNode={}}else this.destroyRemoteMediaStream(e.uid)},destroyLocalMediaStream:function(){this.localAudioStream&&(this.localAudioStream.destroy(),this.localAudioStream=null),this.localVideoStream&&(this.localVideoStream.destroy(),this.localVideoStream=null)},destroyRemoteMediaStream:function(e){if(e&&this.remoteNode&&this.remoteNode[e]){var t=this.remoteNode[e];t.remoteVideoStream&&t.remoteVideoStream.destroy(),t.remoteAudioStream&&t.remoteAudioStream.destroy(),t.remoteVideoStream=null,t.remoteAudioStream=null,this.remoteNode[e]=null;var n=this.remoteStreams[e];this.switchTrackEvent({stream:n,uid:e,isOn:!1}),r.MStream.destroyMedia(n)}},setCaptureVolume:function(e){(void 0===e||e>1)&&(e=1),this.localAudioStream&&this.localAudioStream.setGain(e)},setPlayVolume:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.option={volume:e.volume},this.localAudioStream&&this.localAudioStream.setPlayVolume(e.volume),this.optionRemoteStream("setPlayVolume",e)},setAudioStart:function(e){var t=e.account,n=e.uid;if(console.log("setAudioStart",n),-1!==n)return this.optionRemoteStream("setMuted",{account:t,uid:n,isAudio:!0,option:!1});this.localAudioStream&&(this.localAudioStream.show(),this.localAudioStream.setMuted(!1))},setAudioBlack:function(e){return e&&e.account||e&&e.uid||this.dataApi.update({key:"set_all_user_audio_mute"}),this.optionRemoteStream("setMuted",{account:e,isAudio:!0,option:!0})},setVideoBlack:function(e){return this.optionRemoteStream("hide",e)},setVideoShow:function(e){return this.optionRemoteStream("show",e)},setVideoViewSize:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.videoViewSizeOptions=e,this.localVideoStream&&this.localVideoStream.resize(this.videoViewSizeOptions)},setVideoViewRemoteSize:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.option=e,this.optionRemoteStream("resize",e)},startLocalStream:function(e){var t=this;if(this.localVideoStream){if(this.localVideoStream.container=e||this.info.container,!this.localVideoStream.container)return this.logger.error("webrtc-controller::startLocalStream:开启本地视频流失败 -> video容器节点缺失"),Promise.reject("开启本地视频流失败: video容器节点缺失");this.localVideoStream.resize(this.videoViewSizeOptions),this.localVideoStream.show(),this.localVideoStream.on("resize",function(e){t.emit("streamResize",e)}),this.localVideoStream.on("error",function(e){t.emit("error",e)}),this.localVideoStream.isShown()||this.updateRtcStream()}},stopLocalStream:function(){this.localVideoStream&&this.localVideoStream.hide()},startRemoteStream:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.uid,n=e.node,r=e.poster,i=void 0;if("p2p"===this.imInfo.sessionMode&&!t&&(t=this.info.client.target.uid,!this.info.remoteContainer&&!n))return Promise.reject("startRemoteStream失败：点对点模式实例化Netcall必须设置remoteContainer与target；或者参数必须包含account，node");if(i=this.remoteNode[t],t&&!i)return console.error(this.remoteNode,"未收到对应账号的音视频流信息，无法播放",t,i),Promise.reject("未收到对应账号的音视频流信息，无法播放");if(n=n||this.info.remoteContainer,i)return i.container=e&&n||i.container,i.container?(s(i),Promise.resolve(i.remoteVideoStream.node)):Promise.reject(t+" 开启显示远端视频画面失败: 请传递video容器");var o=this.remoteNode;for(var a in o){if(o[a].container=e&&n||o[a].container,!o[a].container)return Promise.reject(t+" 开启显示远端视频画面失败: 请传递video容器");s(o[a])}return Promise.resolve();function s(t){t.container=e&&n||t.container,t.isVideoEnable=!0,t.remoteVideoStream&&(t.remoteVideoStream.resize(t.videoSizeOptions),t.remoteVideoStream.show(t.container,r))}},stopRemoteStream:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.optionRemoteStream("hide",e)},suspendLocalStream:function(){return this.localVideoStream?(this.localVideoStream.pause(),Promise.resolve()):Promise.reject("本地没有音视频流，无法进行操作")},resumeLocalStream:function(){return this.localVideoStream?(this.localVideoStream.resume(),Promise.resolve()):Promise.reject("本地没有音视频流，无法进行操作")},suspendRemoteStream:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.optionRemoteStream("pause",e)},resumeRemoteStream:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.optionRemoteStream("resume",e)},optionRemoteStream:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.constructor===String&&(t={account:t}),t.fn=e;var n=t.account;return n&&n.constructor===Object&&(t=Object.assign(t,n)).account.constructor===Object&&delete t.account,t.uid||i.default.CURRENT.SDK_TYPE!==i.default.SDK_TYPE.NRTC||(t.uid=t.account,delete t.account),this.doOptionRemoteStream(t)},doOptionRemoteStream:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.fn,n=e.uid,r=e.account,i=e.isAudio,o=e.option,a=void 0;if(i=i||/(setPlayVolume|setGain)/.test(t),"p2p"!==this.imInfo.sessionMode||n||(n=this.info.client.target.uid),!n&&r&&!(n=this.info.client.getUidWithAccount(r)))return Promise.reject("目标账号不正确或者未在当前会话中");if(n)return(a=this.remoteNode[n])&&c(a),Promise.resolve();for(var s in a=this.remoteNode)a[s]&&c(a[s]);return Promise.resolve();function c(e){if(i)return e.remoteAudioStream&&e.remoteAudioStream[t]&&e.remoteAudioStream[t](o),void(e.isAudioEnable=!0);"resize"===t&&(e.videoSizeOptions=o||this.videoViewRemoteSizeOptions),e.remoteVideoStream&&e.remoteVideoStream[t]&&e.remoteVideoStream[t](o),e.isVideoEnable="hide"!==t}},addStream:function(e){e&&this.localAudioStream}},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(117),i=n(58),o=n(68),a=null,s={audio:null,video:null,screen:null,debounceTime:500};t.default={getDeviceStatus:function(){return this.mediaDevices.getDeviceStatus()},getDevicesOfType:function(e){return this.mediaDevices.getDevicesOfType(i.constantTool.getDeviceTypeMap(e)).then(function(e){return Promise.resolve(e[0])})},onDeviceStatusChange:function(e){this.logger.log("webrtc-controller::onDeviceStatusChange:",e),this.emit("deviceStatus",e)},onDeviceAdd:function(e){this.logger.log("webrtc-controller::onDeviceAdd:",e),this.emit("deviceAdd",e)},onDeviceRemove:function(e){var t=this;this.logger.log("webrtc-controller::onDeviceRemove:",e),this.emit("deviceRemove",e),(this.localVideoStream||this.localAudioStream)&&e.forEach(function(e){t.localVideoStream&&e.deviceId===t.localVideoStream.constraint.video.deviceId&&(t.localVideoStream.destroy(),t.localVideoStream=null,t.client.devices.hasVideo=!1,t.rtcLogined&&t.updateRtc()),t.localAudioStream&&e.deviceId===t.localAudioStream.constraint.audio.deviceId&&(t.localAudioStream.destroy(),t.localAudioStream=null,t.client.devices.hasAudio=!1)})},checkDeviceStatus:function(e,t){return e===i.constantRtc.DEVICE_TYPE_VIDEO&&this.localVideoStream&&this.localVideoStream.constraint.video.deviceId===t.deviceId?(this.enableDevice(e),Promise.reject("设备已开启，重复操作")):e===i.constantRtc.DEVICE_TYPE_AUDIO_IN&&this.localAudioStream&&this.localAudioStream.audioStream&&this.localAudioStream.constraint.audio.deviceId===t.deviceId?(this.enableDevice(e),Promise.reject("设备已开启，重复操作")):Promise.resolve()},stopDevice:function(e){var t=this;return new Promise(function(n,r){if(e===i.constantRtc.DEVICE_TYPE_VIDEO){if(t.deviceVideoStatus=!1,a||(a=o.RtcSupport.checkVersion()),t.localVideoStream&&"Firefox"===a.prefix&&a.version-0>=59)return t.disableDevice(e).then(n,r);if(t.localVideoStream)return t.localVideoStream.destroy(),t.localVideoStream=null,t.rtcLogined&&t.updateRtc(),n()}else if(e===i.constantRtc.DEVICE_TYPE_AUDIO_IN){if(t.deviceAudioStatus=!1,t.rtcLogined&&t.localAudioStream&&"Safari"===a.prefix)return t.disableDevice(e).then(n,r);if(t.localAudioStream)return t.localAudioStream.stopDevice(),n()}else e===i.constantRtc.DEVICE_TYPE_AUDIO_OUT_LOCAL?t.localAudioStream&&t.localAudioStream.setMuted(!0):e===i.constantRtc.DEVICE_TYPE_AUDIO_OUT_CHAT&&t.setAudioBlack();n()})},destroyDevice:function(e){this.logger.log("webrtc-controller::destroyDevice: 销毁设备",e);var t=e===i.constantRtc.DEVICE_TYPE_AUDIO_IN?"localAudioStream":"localVideoStream";return this[t]&&this[t].destroy(),this[t]=null,Promise.resolve()},disableDevice:function(e){this.logger.log("webrtc-controller::disableDevice: 暂停设备",e);var t=e===i.constantRtc.DEVICE_TYPE_AUDIO_IN?"localAudioStream":"localVideoStream";return(this[t]&&this[t].stream&&this[t].stream.getTracks()||[]).forEach(function(e){e.enabled=!1}),Promise.resolve()},enableDevice:function(e){this.logger.log("webrtc-controller::disableDevice: 恢复设备",e);var t=e===i.constantRtc.DEVICE_TYPE_AUDIO_IN?"localAudioStream":"localVideoStream";return(this[t]&&this[t].stream&&this[t].stream.getTracks()||[]).forEach(function(e){e.enabled=!0}),Promise.resolve()},startDevice:function(e){var t=this;return new Promise(function(n,r){var o=e.type,a=e.device,s=e.account,c=e.uid,u=e.stream;if(o===i.constantRtc.DEVICE_TYPE_VIDEO&&(t.deviceVideoStatus=!0),o===i.constantRtc.DEVICE_TYPE_AUDIO_IN&&(t.deviceAudioStatus=!0),o===i.constantRtc.DEVICE_TYPE_AUDIO_OUT_LOCAL)return t.setAudioStart({uid:-1}),n();if(o===i.constantRtc.DEVICE_TYPE_AUDIO_OUT_CHAT)return t.setAudioStart({account:s,uid:c}),n();var d=Promise.resolve();o!==i.constantRtc.DEVICE_TYPE_DESKTOP_SCREEN&&o!==i.constantRtc.DEVICE_TYPE_DESKTOP_WINDOW&&o!==i.constantRtc.DEVICE_TYPE_DESKTOP_CHROME_SCREEN&&(a&&a.deviceId||(d=t.getDevicesOfType(o))),d.then(function(e){return a=a||e&&e[0],t.checkDeviceStatus(o,a).then(function(){return t.imInfo.isHight=!1,o===i.constantRtc.DEVICE_TYPE_VIDEO?t.getStream("Video",a,n,r):o===i.constantRtc.DEVICE_TYPE_AUDIO_IN?t.getStream("Audio",a,n,r):o===i.constantRtc.DEVICE_TYPE_DESKTOP_CHROME_SCREEN?(t.deviceAudioStatus=!0,t.deviceVideoStatus=!0,t.getStream("ChromeScreen",o,n,r)):o===i.constantRtc.DEVICE_TYPE_DESKTOP_SCREEN||o===i.constantRtc.DEVICE_TYPE_DESKTOP_WINDOW?(t.deviceAudioStatus=!0,t.deviceVideoStatus=!0,t.getStream("Screen",o,n,r)):o===i.constantRtc.DEVICE_TYPE_VIDEO_LOCAL&&u?(t.deviceAudioStatus=!0,t.deviceVideoStatus=!0,t.getStream("OutLocal",u,n,r)):void 0}).catch(function(e){/重复操作/.test(e)?n():r(e)})}).then(function(e){n(e)}).catch(function(e){r(e)})})},getStream:function(e,t,n,r){var i="_get"+e+"Stream";return s[e]&&s[e].lockerTimer&&(this.logger.log("webrtc-controller::destroy "+i+" timer"),clearTimeout(s[e].lockerTimer)),this.logger.log("webrtc-controller::create "+i+" timer"),s[e]={},this[i](t,n,r)},_getVideoStream:function(e,t,n){var s=this,c={};if(a||(a=o.RtcSupport.checkVersion()),this.localVideoStream&&"Firefox"===a.prefix&&a.version-0>=59)return this.enableDevice(i.constantRtc.DEVICE_TYPE_VIDEO).then(t,n);var u={deviceId:{}};u.deviceId.exact=e.deviceId;var d=i.constantTool.getVideoSessionConfig({quality:this.sessionConfig.videoQuality,frameRate:this.sessionConfig.videoFrameRate});return u=Object.assign(u,d),c.video=u,this.logger.log("webrtc-controller::_getVideoStream:",c),r.MStream.getLocalStream(c).then(function(n){s.localVideoStream&&(s.localVideoStream.destroy(),s.localVideoStream=null),s.localVideoStream=n,s.rtcLogined&&s.updateRtc(),t({device:e,stream:n})}).catch(function(e){n(e)})},_getAudioStream:function(e,t,n){var i=this;a||(a=o.RtcSupport.checkVersion());var s={};if("Safari"===a.prefix&&this.localAudioStream)return this.enableDevice("audio").then(t);if(this.localAudioStream&&this.localAudioStream.audioStream)return this.enableDevice("audio").then(t);var c=e&&e.deviceId;return s.audio=!c||{deviceId:c},this.logger.log("webrtc-controller::_getAudioStream:",s),r.MStream.getLocalStream(s).then(function(n){i._initAudioStream(s,n),t({device:e,stream:n})}).catch(function(e){n(e)})},_initAudioStream:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new MediaStream;this.localAudioStream?this.localAudioStream.updateStream(t):(this.localAudioStream=new r.MStream({stream:t,type:"audio",isRemote:!1,constraint:e}),this.rtcLogined&&this.updateRtc())},_getScreenStream:function(e,t,n){var o=this;this.dataApi.update({key:"screen_sharing_module"});var a={audio:!1,video:{mediaSource:e=e===i.constantRtc.DEVICE_TYPE_DESKTOP_SCREEN?"screen":"window"}};return this.logger.log("webrtc-controller::_getScreenStream:",a),r.MStream.getLocalStream(a).then(function(e){console.error("object",e),o.localVideoStream=e,o.rtcLogined&&o.updateRtc()}).catch(n)},_getChromeScreenStream:function(e,t,n){var i=this,o=this.info.chromeId;if(o){var a={sources:["window","screen","tab"]},s=this;return new Promise(function(e,t){chrome.runtime.sendMessage(o,a,{},function(n){if(i.localVideoStream&&(i.localVideoStream.destroy(),i.localVideoStream=null),i.imInfo.isHight=!0,console.log("chrome 屏幕共享",n),n&&"success"===n.type){var o={video:{mandatory:{maxWidth:1280,maxHeight:720,maxFrameRate:5,minFrameRate:1,chromeMediaSource:"desktop",chromeMediaSourceId:n.streamId}}};return console.log("webrtc-controller::_getScreenStream:",o),r.MStream.getLocalStream(o).then(function(t){s.localVideoStream=t,s.rtcLogined&&s.updateRtc({chromeShare:!0}),e()}).catch(t)}n?(i.localVideoStream&&(i.localVideoStream.destroy(),i.localVideoStream=null),console.error("获取流失败"),t({code:20,msg:"获取流失败"})):(i.localVideoStream&&(i.localVideoStream.destroy(),i.localVideoStream=null),console.error("未安装插件"),t({code:404,msg:"未安装插件"}))})})}console.error("chrome屏幕共享id未设置")},_getOutLocalStream:function(e,t,n){var i=this,o={stream:e,video:!0};return r.MStream.getLocalStream(o).then(function(e){i.localVideoStream&&(i.localVideoStream.destroy(),i.localVideoStream=null),i.localVideoStream=e,i.rtcLogined&&i.updateRtc(),t()}).catch(function(e){n(e)})}},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){return e&&e.__esModule?e:{default:e}}(n(5)),i=n(68),o=n(117);var a=n(3).info.nrtcSdkVersion,s=null;t.default={destroyRemoteNode:function(e){if(e)return this.destroyRemoteRtc(e),void this.destroyRemoteMediaStream(e);var t=this.remoteNode;for(var n in t)this.destroyRemoteRtc(n),this.destroyRemoteMediaStream(n)},destroyRemoteRtc:function(e){if(e&&this.remoteNode&&this.remoteNode[e]){var t=this.remoteNode[e];t.rtc&&t.rtc.close()}},createOffer:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.isUpdate,r=void 0!==n&&n,i=t.rtc,o=void 0===i?this.rtc:i,a=t.chromeShare,s=void 0!==a&&a;return o.createOffer().then(function(e){return o.setLocalDescription(e,r)}).then(function(t){return e.sendOffer({chromeShare:s,offer:t,isUpdate:r,targetUid:o.targetUid}),Promise.resolve()})},sendOffer:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.targetUid===this.imInfo.uid?this.sendLocalMessage(e):this.sendRemoteMessage(e)},sendLocalMessage:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.offer,n=e.isUpdate,r=e.isLogin,i=void 0!==r&&r,o=e.chromeShare,s=void 0!==o&&o,c=this.imInfo,u=this.imInfo.videoConfig,d=this.sessionConfig||{},l=i?"client_login":n?"sdp_update":"sdp_offer",p=this.mediaDevices.getDeviceStatus(),f={session_mode:c.sessionMode||"p2p",record:{support_video_record:d.recordVideo||!1,support_audio_record:d.recordAudio||!1,single_record_in_meeting:d.recordMeeting||!1},bypass_rtmp:{is_host:!!d.rtmpUrl,support_bypass_rtmp:d.liveEnable||!1,support_bypass_rtmp_record:d.rtmpRecord||!1,bypass_rtmp_url:d.rtmpUrl||"",participant_mode:"M-"+d.splitMode,layout:d.layout||""},params:{version:+a,token:c.token||c.cid+"",user_type:c.token?3:2,user_token_type:0,content:i?"":t,streamSetting:{video:{width:u.width,height:u.height,frameRate:d.liveEnable&&u.frameRate>15?15:u.frameRate}},dst_id:this.imInfo.uid,is_multi_peerconnection:!0},hasAudio:!i&&(this.deviceAudioStatus&&p.hasAudio&&!this.imInfo.role||!1),hasVideo:!i&&(this.deviceVideoStatus&&p.hasVideo&&!this.imInfo.role||s||!1)};this.imInfo.isHight&&(f.params.streamSetting.video={width:1280,height:720,frameRate:5}),this.sendMsg(l,f),d.recordAudio&&this.dataApi.update({key:"server_record_audio"}),d.recordVideo&&this.dataApi.update({key:"server_record_video"}),d.recordMeeting&&this.dataApi.update({key:"server_record_single_user"})},sendRemoteMessage:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.offer,n=e.targetUid,r=this.imInfo,i={session_mode:r.sessionMode||"p2p",params:{token:r.token||r.cid+"",user_type:r.token?3:2,user_token_type:0,content:t,version:+a,dst_id:n,is_multi_peerconnection:!0}};this.sendMsg("sdp_offer",i)},sendAnswer:function(e,t){var n={params:{content:e,streamSetting:{video:this.imInfo.videoConfig}}};this.imInfo.isHight&&(n.params.streamSetting.video={width:1280,height:720,frameRate:5}),t&&(n.params.dst_id=t),this.sendMsg("sdp_answer",n)},onsdp_answer:function(e){this.logger.log("webrtc-controller::onSdp_answer:uid -> ",e);var t=e.params.auth_res-0,n=e.params.dst_id||this.imInfo.uid;if(200!==t)return this.logger.error("webrtc-controller::onSdp_answer:服务器验证不通过, 断开连接"),this.emit("signalClosed",{code:t,error:"服务器验证不通过, 断开连接"}),void this.stopSession();var r=n-this.imInfo.uid==0?this.rtc:this.remoteNode[n].rtc;r&&r.setRemoteDescription(e.params.content,"answer")},onice_answer:function(e){var t=e.params.content,n=e.params.dst_id||this.imInfo.uid;"object"!==(void 0===t?"undefined":(0,r.default)(t))&&(t={candidate:t});var i=n-this.imInfo.uid==0?this.rtc:this.remoteNode[n].rtc;i&&i.addRemoteIceCandidate(t)},monitorRemoteStream:function(e){if(this.remoteVideoStream||this.remoteAudioStream){if(!e.ssrc.remote||!e.ssrc.remote.total)return;if(e.ssrc.remote.total.bytesReceivedRate>0||!this.monitorRemoteStreamStartTime)this.monitorRemoteStreamStartTime=Date.now();else Date.now()-this.monitorRemoteStreamStartTime>1e4&&(this.logger.warn("webrtc-controller::monitorRemoteStream:10秒内未收到音视频数据"),this.emit("remoteStreamNoData"),this.monitorRemoteStreamStartTime=null)}else this.monitorRemoteStreamStartTime=null},onRemoteStream:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.uid,n=e.stream,r=e.track;if(window.myRemoteStreams=this.remoteStreams,window.myRemoteNode=this.remoteNode,this.logger.log("webrtc-controller::onRemoteStream:get remote stream",e),this.remoteStreams[t]=n,!t)return this.logger.warn("webrtc-controller::onRemoteStream:无法找到远程流对应的uid!!,先暂存",n);this.doRemoteStream(n,t,r)},composeTrack:function(e,t,n,r){if(e!==this.imInfo.uid){var i=this.remoteNode[e],a=new MediaStream,s="audio"===n?"remoteAudioStream":"remoteVideoStream";a.addTrack(t),i[s]?i[s].updateStream(a):i[s]=new o.MStream({uid:e,stream:a,type:n,isRemote:!0,container:i.container}),this.logger.log("webrtc::composeTrack ",e,n,t.id,t.readyState),"audio"===n&&i.isAudioEnable&&i[s].show(),"video"===n&&this.delayVideoShow(e)}},delayVideoShow:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];setTimeout(function(){t._delayVideoShow(e,n)},100)},_delayVideoShow:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e&&e!==this.imInfo.uid){var n=this.remoteNode[e],r=n.remoteVideoStream;if(n&&r){if(console.log("_delayVideoShow",e,t),s||(s=i.RtcSupport.checkVersion()),"Firefox"!==s.prefix){var o={};n.isVideoEnable&&t&&(o=this.checkRemoteTrack(e,n.rtc.sdpAnswer.sdp)),t=o.video}var a=n.isVideoEnable&&t?"show":"hide";r[a]&&r[a](),"show"===a&&r.resize(n.videoSizeOptions||this.videoViewRemoteSizeOptions),this.logger.log("webrtc-controller::delayVideoShow: "+e+" video "+a)}}},switchTrackEvent:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.stream,r=t.uid,i=t.isOn;if(n&&r){if(!(void 0===i||i))return n.onaddtrack=null,n.onremovetrack=null,this.logger.log("webrtc-controller::remove trackevent: onaddtrack",n.id),void this.logger.log("webrtc-controller::remove trackevent: onremovetrack",n.id);n.onaddtrack||(this.logger.log("webrtc-controller::add trackevent onaddtrack",n.id),n.onaddtrack=function(t){e.emit("addtrack",t);var i=t.track,o=i.kind;if(e.logger.log("webrtc-controller::on add track:",n.id,o,i.id,i.readyState),e.composeTrack(r,i,o),e.emit("remoteTrack",{uid:r,track:i}),"video"===o){var a=e.remoteNode[r].rtc,s=a.rtcConnection&&a.rtcConnection.remoteDescription.sdp;e.checkRemoteTrack(r,s),e.delayVideoShow(r)}}),n.onremovetrack||(this.logger.log("webrtc-controller::add trackevent onremovetrack",n.id),n.onremovetrack=function(t){var i=t.track,o=i.kind,a=e.remoteNode[r];a&&(e.logger.warn("webrtc-controller::on remove track:",n.id,o,i.id,i.readyState),e.emit("removetrack",t),"video"===o&&a.remoteVideoStream&&a.remoteVideoStream.hide())})}},doRemoteStream:function(e,t,n){/Firefox/gi.test(navigator.userAgent)?this.doRemoteStreamFirefox(e,t,n):this.doRemoteStreamChrome(e,t,n)},doRemoteStreamChrome:function(e,t){var n=this;this.logger.log("webrtc-controller::get "+t+" stream, track num: "+e.getTracks().length,e),e&&e.getTracks().forEach(function(e){n.logger.log("   > track id:",e.kind+":"+e.id,e)});var r=e.getAudioTracks()[0],i=e.getVideoTracks()[0];r&&this.composeTrack(t,r,"audio",e),i&&this.composeTrack(t,i,"video",e),this.switchTrackEvent({stream:e,uid:t}),r&&this.emit("remoteTrack",{uid:t,track:r}),i&&this.emit("remoteTrack",{uid:t,track:i})},doRemoteStreamFirefox:function(e,t,n){var r=this.remoteNode[t];r&&r.rtc&&(this.logger.log("webrtc-controller::get "+t+" track: ",n&&n.id,n),s||(s=i.RtcSupport.checkVersion()),n&&(this.composeTrack(t,n,n.kind,e),this.emit("remoteTrack",{uid:t,track:n})))},onLocalIceCandidate:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.logger.log("webrtc-controller::onLocalIceCandidate",e);var t=e.uid,n=e.ice;if(!/\d tcp \d/gi.test(n.candidate)){var r={params:{content:n,dst_id:t}};this.sendMsg("ice_offer",r)}},onNegotiationNeeded:function(e){this.rtcConnected&&this.logger.log("webrtc-controller::onNegotiationNeeded",e.target)},onIceStateChange:function(e){var t=e.rtc,n=e.state,r=t.targetUid;if(this.logger.log("webrtc-controller::"+r+" ice connection state change to: "+n),"connected"===n&&r===this.imInfo.uid&&this.emit("sessionConnected"),"failed"===n){if(this.logger.error("webrtc-controller::"+r+" ice failed"),r-this.imInfo.uid==0)return void this.onLocalIceFail();this.onRemoteFail(r)}},onLocalIceFail:function(){this.logger.log("ice断开 触发重连 进入signal的signalTimeout"),this.signal.emit("signalTimeout")},onRemoteFail:function(e){this.emit("remoteSignalClosed",e),this.remoteNode.hasOwnProperty(e)&&(this.destroyRemoteNode(e),this.removeRemoteUserStream(e),this.remoteNode[e]=null,delete this.remoteNode[e],this.rtcRecorder&&this.rtcRecorder.leave({uid:e}))},updateRtcStream:function(){var e=0===this.imInfo.role||"p2p"===this.imInfo.sessionMode;this.logger.log("webrtc-controller::updateRtcStream:role -> ",e?"player":"audience");var t=[];if(e){var n=this.localAudioStream,r=this.localVideoStream;n&&n.stream&&t.push(n.stream),r&&r.stream&&t.push(r.stream)}this.rtc&&this.rtc.updateStream(t)},removeRemoteUserStream:function(e){this.logger.log("webrtc-controller::removeRemoteUserStream:uid -> ",e),delete this.remoteNode[e]},checkRemoteTrack:function(e,t){var n=this.remoteNode[e];if(!n)return{};var r=n.remoteAudioStream&&n.remoteAudioStream.audioStream,i=n.remoteVideoStream&&n.remoteVideoStream.stream;if(!r&&!i||!n.rtc)return{};var o=n.rtc.checkMediaStatus({audio:r,video:i,sdp:t,uid:e});return this.logger.log("webrtc-controller::checkRemoteTrack:uid -> ",e,o),o.video||n.remoteVideoStream&&n.remoteVideoStream.hide(),o}},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(42),i=n(58),o=n(68);var a=null,s="//"+function(e){return e&&e.__esModule?e:{default:e}}(n(3)).default.roomserver+"/v1/sdk/command/rooms/";t.default={switchRole:function(){return this.rtcLogined?(a||(a=o.RtcSupport.checkVersion()),"Firefox"!==a.prefix||"Firefox"===a.prefix&&a.version-0<59?this.updateRtc():(0===this.imInfo.role?(this.enableDevice(i.constantRtc.DEVICE_TYPE_AUDIO_IN),this.enableDevice(i.constantRtc.DEVICE_TYPE_VIDEO)):(this.disableDevice(i.constantRtc.DEVICE_TYPE_AUDIO_IN),this.disableDevice(i.constantRtc.DEVICE_TYPE_VIDEO)),this.rtcConnected?Promise.resolve():(0===this.imInfo.role&&this.updateRtc(),Promise.resolve()))):Promise.resolve()},switchVideoToAudio:function(){return this.rtcLogined?(this.localVideoStream&&this.disableDevice(i.constantRtc.DEVICE_TYPE_VIDEO),Promise.resolve()):Promise.reject("no connection")},switchAudioToVideo:function(){return this.rtcLogined?(this.localVideoStream&&this.enableDevice(i.constantRtc.DEVICE_TYPE_VIDEO),Promise.resolve()):Promise.reject("no connection")},setSessionConfig:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.sessionConfig=Object.assign(this.sessionConfig,e)},setSessionVideoQuality:function(e){void 0!==e&&this.setSessionConfig({videoQuality:e})},setSessionVideoFrameRate:function(e){void 0!==e&&this.setSessionConfig({videoFrameRate:e})},setSessionAudioQuality:function(e){this.setSessionConfig({highAudio:!!e})},startRecordMp4:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.account,n=e.uid;if(t)if(t===this.info.client.getAccount())n=this.imInfo.uid;else if(!(n=this.info.client.getUidWithAccount(t)))return Promise.reject("账号不在房间中，无法进行录制");t=t||this.info.client.getAccount();var r=[];if(n&&n-this.imInfo.uid!=0){var i=this.remoteNode[n];if(!i)return Promise.reject("需要录制的账号不正确");i.remoteAudioStream&&r.push(i.remoteAudioStream.stream),i.remoteVideoStream&&r.push(i.remoteVideoStream.stream)}else this.localAudioStream&&r.push(this.localAudioStream.stream),this.localVideoStream&&r.push(this.localVideoStream.stream);return 0===r.length?Promise.reject("当前没有音视频数据，无法进行录制"):this.rtcRecorder.start(r,{account:t,uid:n})},stopRecord:function(){return this.rtcRecorder.stop()},startRecordAac:function(){var e=this.info.client.getAccount(),t=this.imInfo.uid,n=[];this.localAudioStream&&n.push(this.localAudioStream.stream);var r=this.remoteNode;for(var i in r)r[i].remoteAudioStream&&r[i].remoteAudioStream.stream&&n.push(r[i].remoteAudioStream.stream);return this.rtcRecorder.start(n,{account:e,uid:t,type:"audio"})},updateRtmpUrl:function(){this.sendMsg("update_bypass_url",{params:{content:{bypass_url:this.sessionConfig.rtmpUrl}}})},updateRtmpHostVideo:function(e){if(!e)return Promise.reject("账号不在房间中，无法进行操作");var t=s+this.imInfo.cid,n=this.imInfo.turnToken||this.imInfo.serverMap&&this.imInfo.serverMap.token;return n?(0,r.ajax)({type:"post",url:t,data:{suid:this.imInfo.uid,cid:this.imInfo.cid,uid:+e,cmd:10001},header:{Token:n}}).then(function(e){if(200===e.code)return Promise.resolve();var t=void 0;switch(e.code){case 404:t="房间不存在";break;case 405:t="目标用户不在房间中";break;case 406:t="没有权限";break;case 417:t="请求数据不对";break;case 600:t="服务器内部错误";break;default:t="请求参数不正确"}return Promise.reject(t)}):Promise.reject("token缺失, 请检查")}},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){return e&&e.__esModule?e:{default:e}}(n(73)),i=n(58),o=n(68),a=n(153);t.default={stopStats:function(){this.stats&&this.stats.stop(),this.statsNew&&this.statsNew.stop(),this.dataRtc&&this.dataRtc.stop(),this.dataStats&&this.dataStats.stop()},initStats:function(){var e=this;this.stats=new o.RtcStats({controller:this,interval:2e3}),this.stats.on("stats",function(e){}),this.statsNew=new o.RtcStatsNew({controller:this,interval:1e3}),this.statsNew.on("stats",function(t,n){n%2==0&&e.uploadDataRtcNew(t),e.uploadDataRtc(!1,t,n)}),this.dataRtc=(0,a.DataRtc)({appkey:this.info.appKey}),this.dataStats=(0,a.DataStats)({appkey:this.info.appKey})},startStats:function(){this.statsNew.start({controller:this}),this.uploadDataStatsStart(),this.uploadDataRtcStart()},uploadDataRtcStart:function(){this.info.appKey&&r.default.STATS_FUN[r.default.CURRENT.SDK_TYPE]&&this.dataRtc&&this.dataRtc.start({info:this.info,controller:this,imInfo:this.imInfo,sessionConfig:this.sessionConfig,videoConfig:this.imInfo.videoConfig})},uploadDataRtcStop:function(){r.default.STATS_RTC[r.default.CURRENT.SDK_TYPE]&&this.dataRtc&&this.dataRtc.stop()},uploadDataRtcOnce:function(e){if(r.default.STATS_RTC[r.default.CURRENT.SDK_TYPE]&&this.dataRtc){var t=i.constantTool.getVideoSessionConfig({quality:this.sessionConfig.videoQuality,frameRate:this.sessionConfig.videoFrameRate});this.dataRtc.updateOnce({info:this.info,imInfo:e,sessionConfig:this.sessionConfig,videoConfig:t})}},uploadDataRtc:function(e,t,n){r.default.STATS_RTC[r.default.CURRENT.SDK_TYPE]&&this.info.appKey&&this.dataRtc&&("volume"!==e?this.dataRtc.update(t,n):this.dataRtc.updateLocalVolumn(t))},uploadDataStatsStart:function(){r.default.STATS_RTC[r.default.CURRENT.SDK_TYPE]&&this.dataStats&&this.dataStats.start({info:this.info,cid:this.imInfo.cid,uid:this.imInfo.uid})},uploadDataRtcNewStop:function(){r.default.STATS_RTC[r.default.CURRENT.SDK_TYPE]&&this.dataStats&&this.dataStats.stop()},uploadDataRtcNew:function(e){r.default.STATS_RTC[r.default.CURRENT.SDK_TYPE]&&this.dataStats&&this.dataStats.update(e)}},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(42);t.default={startRecordMp4:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.controller.uploadDataApi("update",{key:"record"}),this.controller.startRecordMp4(e)},stopRecordMp4:function(){return this.controller.stopRecord()},startRecordAac:function(){return this.controller.uploadDataApi("update",{key:"audio_record"}),this.controller.startRecordAac()},stopRecordAac:function(){return this.controller.stopRecord()},setVideoViewSize:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.cut&&this.controller.uploadDataApi("update",{key:"video_crop"}),this.controller.setVideoViewSize(e)},setVideoViewRemoteSize:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.controller.setVideoViewRemoteSize(e)},startLocalStream:function(e){return this.controller.uploadDataApi("update",{key:"display"}),e=r.element.n2node(e),this.controller.startLocalStream(e)},stopLocalStream:function(){return this.controller.stopLocalStream()},startRemoteStream:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.node=r.element.n2node(e.node),e.account&&(e.uid=this.getUidWithAccount(e.account)),this.controller.startRemoteStream(e)},stopRemoteStream:function(e){return this.controller.stopRemoteStream(e)},suspendLocalStream:function(){return this.controller.suspendLocalStream()},resumeLocalStream:function(){return this.controller.resumeLocalStream()},suspendRemoteStream:function(e){return this.controller.suspendRemoteStream(e)},resumeRemoteStream:function(e){return this.controller.resumeRemoteStream(e)},setAudioStart:function(e){return this.controller.setAudioStart(e)},setAudioBlack:function(e){return this.controller.setAudioBlack(e)},setVideoBlack:function(e){return this.controller.setVideoBlack(e)},setVideoShow:function(e){return this.controller.setVideoShow(e)}},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={getDevicesOfType:function(e){return this.controller.getDevicesOfType(e).then(function(e){return{devices:e}})},stopDevice:function(e){return this.controller.stopDevice(e)},startDevice:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.controller.startDevice(e)}},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(58);t.default={getAccount:function(){return this.baseGetAccount()},getUid:function(){return this.baseGetUid()},isCurrentChannelId:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.baseIsCurrentChannelId(e)},notCurrentChannelId:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return!this.isCurrentChannelId(e)},switchVideoToAudio:function(){var e=this;return this.controller.uploadDataApi("update",{key:"switch_p2p_type"}),this.controller.switchVideoToAudio().then(function(){return e.type=r.constantRtc.NETCALL_TYPE_AUDIO,Promise.resolve()}).catch(function(e){return Promise.resolve(e)})},switchAudioToVideo:function(){var e=this;return this.controller.uploadDataApi("update",{key:"switch_p2p_type"}),this.controller.switchAudioToVideo().then(function(){return e.type=r.constantRtc.NETCALL_TYPE_VIDEO,Promise.resolve()}).catch(function(e){return Promise.resolve(e)})},changeRoleToPlayer:function(){return 0===this.imInfo.role?Promise.resolve({role:"player"}):(this.imInfo.role=0,this.controller.uploadDataApi("update",{key:"actor"}),this.controller.switchRole().then(function(){return Promise.resolve({role:"player"})}))},changeRoleToAudience:function(){return 1===this.imInfo.role?Promise.resolve({role:"audience"}):(this.imInfo.role=1,this.controller.switchRole().then(function(){return Promise.resolve({role:"audience"})}))},updateRtmpUrl:function(e){return this.controller.setSessionConfig({rtmpUrl:e}),this.controller.updateRtmpUrl(e),Promise.resolve()},setSessionConfig:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.controller.setSessionConfig(e)},setSessionVideoQuality:function(e){this.controller.setSessionVideoQuality(e)},setSessionVideoFrameRate:function(e){this.controller.setSessionVideoFrameRate(e)},setSessionAudioQuality:function(e){this.controller.setSessionAudioQuality(e)},setCaptureVolume:function(e){return e=void 0===e?1:e/255,this.controller.setCaptureVolume(e)},setPlayVolume:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.constructor===String&&(e=+e),e.constructor===Number&&(e={volume:e}),e.volume=void 0===e.volume?1:e.volume/255,e.volume=e.volume>1?1:e.volume,this.controller.setPlayVolume(e)},destroyMediaStream:function(e){this.controller.destroyMediaStream({uid:e,type:"remote"})},updateRtmpHostVideo:function(e){var t=e.account,n=e.uid;return t&&(n=this.getUidWithAccount(t)),n?this.controller.updateRtmpHostVideo(n):Promise.reject("账号不在房间中，无法进行操作")}},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={pipe:function(){var e=[].concat(Array.prototype.slice.call(arguments));return this._pipe(1===e.length?e[0]:e)},_pipe:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments[1],r=t.shift();return(n&&n.constructor===Promise?n:Promise.resolve(n)).then(function(){return 0===t.length?e._pipeLast(r,n):e._pipeLast(r,n).then(function(n){return e._pipe(t,n)})})},_pipeLast:function(e,t){if(!e||e.constructor!==Function&&e.constructor!==Promise)return Promise.resolve(e);if(e.constructor===Promise)return e;if(e.constructor===Function){var n=e(t);return n&&n.constructor===Promise?n:Promise.resolve(n)}return Promise.resolve(e)}},e.exports=t.default},,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";var r=c(n(65)),i=c(n(378)),o=n(58),a=n(68),s=c(n(352));function c(e){return e&&e.__esModule?e:{default:e}}n(139);var u=n(294),d=n(295),l=n(296),p=n(297),f=n(298),h=n(3),m=h.info.nrtcVersion,v=h.info.version,g=void 0,y=(0,r.default)({version:v,versionRtc:m},o.constantRtc,a.RtcSupport,s.default,{install:function(e,t){u.install(e,t),d.install(e,t),e.parser.mixin({configMap:l,serializeMap:p,unserializeMap:f})},getInstance:function(e){return g||(g=new i.default(e)),g},destroy:function(){g&&(g.destroy(),g=null)}});e.exports=y},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=m(n(14)),i=m(n(50)),o=m(n(27)),a=m(n(28)),s=m(n(73)),c=n(58),u=m(n(199)),d=m(n(299)),l=m(n(349)),p=m(n(350)),f=m(n(351)),h=m(n(379));function m(e){return e&&e.__esModule?e:{default:e}}s.default.CURRENT.SDK_TYPE=s.default.SDK_TYPE.WEBRTC;var v=function(e){function t(e){(0,r.default)(this,t);var n=(0,o.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.initWR(),n}return(0,a.default)(t,e),(0,i.default)(t,[{key:"initWR",value:function(){this.nim||this.logger.error("webrtc-client::initWR: 请传入nim实例"),this.initProtocol(),this.initController(),this.devices={hasAudio:!1,hasVideo:!1}}},{key:"destroy",value:function(){var e=this;this.controller.destroy(),this.resetStatus(),this.nim=null,this.controller=null,Object.keys(this).map(function(t){e[t]=null,delete e[t]})}},{key:"resetWhenHangup",value:function(){this.controller.stopSession(),this.resetStatus()}},{key:"initSignal",value:function(){return Promise.resolve()}},{key:"initProtocol",value:function(){var e=this.nim;e.on("beCalled",this.onBeCalled.bind(this)),e.on("notifyCalleeAck",this.onCalleeAck.bind(this)),e.on("notifyHangup",this.onHangup.bind(this)),e.on("netcallControl",this.onControl.bind(this)),e.on("notifyCalleeAckSync",this.onCalleeAckSync.bind(this)),e.on("notifyJoin",this.onNotifyJoin.bind(this))}},{key:"initController",value:function(){var e=this;window.myContrl=this.controller=new d.default({appKey:this.nim&&this.nim.options.appKey,logger:this.logger,container:this.container,remoteContainer:this.remoteContainer,chromeId:this.chromeId,client:this}),this.controller.on("sessionConnected",function(t){e.emit("sessionConnected",t)}),this.controller.on("signalClosed",function(t){e.emit("signalClosed",t)}),this.controller.on("userJoined",this.onUserJoin.bind(this)),this.controller.on("deviceStatus",function(t){e.emit("deviceStatus",t)}),this.controller.on("deviceAdd",function(t){e.emit("deviceAdd",t)}),this.controller.on("deviceRemove",function(t){e.emit("deviceRemove",t)}),this.controller.on("devices",function(t){e.emit("devices",t)}),this.controller.on("statistics",function(t){e.emit("statistics",t)}),this.controller.on("willReconnect",function(t){e.emit("willReconnect",t)}),this.controller.on("reconnectFailed",function(t){e.emit("reconnectFailed",t)}),this.controller.on("reconnectSuccess",function(t){e.emit("reconnectSuccess",t)}),this.controller.on("sessionDuration",function(t){e.emit("sessionDuration",t)}),this.controller.on("signalClosed",function(t){e.emit("signalClosed",t)}),this.controller.on("remoteSignalClosed",function(t){e.emit("remoteSignalClosed",{uid:t,account:e.getAccountWithUid(t)})}),this.controller.on("leaveChannel",this.onUserLeft.bind(this)),this.controller.on("remoteTrack",function(t){e.emit("remoteTrack",{uid:t.uid,track:t.track,type:t.track.kind,account:e.getAccountWithUid(t.uid)})}),this.controller.on("remoteStreamUpdate",function(t){t.account=e.getAccountWithUid(t.uid),e.emit("remoteStreamUpdate",t)}),this.controller.on("audioVolume",function(t){e.emit("audioVolume",t)})}},{key:"call",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.calling)return Promise.reject({type:"statusNotMatch",error:"呼叫失败: 当前正在通话中"});var t=e.account,n=e.type,r=e.pushConfig,i=e.sessionConfig;if(this.calling=!0,this.isCaller=!0,this.callee=t,this.target.account=t,this.setSessionConfig(i),this.setSessionConfig({signalStartTime:Date.now()}),this.controller.uploadDataApi("update",{key:"p2p"}),i.highAudio&&this.controller.uploadDataApi("update",{key:"hd_audio"}),void 0!==i.videoFrameRate&&this.controller.uploadDataApi("update",{key:"fps",ext:0==+i.videoFrameRate?0:+i.videoFrameRate+1}),r.forceKeepCalling&&this.controller.uploadDataApi("update",{key:"always_keep_calling"}),void 0!==i.videoQuality){var o=+i.videoQuality;o===c.constantRtc.CHAT_VIDEO_QUALITY_540P?o=c.constantRtc.CHAT_VIDEO_QUALITY_720P:o===c.constantRtc.CHAT_VIDEO_QUALITY_720P&&(o=c.constantRtc.CHAT_VIDEO_QUALITY_540P),this.controller.uploadDataApi("update",{key:"video_quality",ext:o||0})}return this.initNetcall({type:n,pushConfig:r})}},{key:"initNetcall",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.type,r=t.pushConfig;return this.type=n,this.setSessionConfig({signalStartTime:Date.now()}),this.nim.initNetcall({type:n,accounts:[this.callee],pushConfig:r,webrtcEnable:!0}).then(function(t){e.signalInited=!0,e.sessionMode="p2p",e.logger.log("webrtc-client::initNetcall:",t),e.callerInfo=t,e.channelId=t.channelId,e.imInfo=e.callerInfo,e.imInfo.sessionMode=e.sessionMode,e.imInfo.role=0}).catch(function(t){return e.setSessionConfig({signalEndTime:Date.now()}),e.controller.uploadDataRtcOnce({code:t.code}),e.resetWhenHangup(),Promise.reject(t)})}},{key:"response",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.sessionConfig,n=void 0===t?{}:t;if(this.controller.uploadDataApi("update",{key:"p2p"}),n.highAudio&&this.controller.uploadDataApi("update",{key:"hd_audio"}),void 0!==n.videoFrameRate&&this.controller.uploadDataApi("update",{key:"fps",ext:0==+n.videoFrameRate?0:+n.videoFrameRate+1}),void 0!==n.videoQuality){var r=+n.videoQuality;r===c.constantRtc.CHAT_VIDEO_QUALITY_540P?r=c.constantRtc.CHAT_VIDEO_QUALITY_720P:r===c.constantRtc.CHAT_VIDEO_QUALITY_720P&&(r=c.constantRtc.CHAT_VIDEO_QUALITY_540P),this.controller.uploadDataApi("update",{key:"video_quality",ext:r||0})}return e.fn="calleeAck",this.baseResponse(e)}},{key:"control",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.fn="netcallControl",this.baseControl(e)}},{key:"hangup",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.fn="hangup",e.recordType="cancelNetcallBeforeAccept",this.baseHangup(e)}},{key:"onBeCalled",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.signalInited=!0,this.channelId=e.channelId,this.beCalledInfo=e,this.logger.log("beCalling",e),this.emit("beCalling",e)}},{key:"setNetcallSession",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.calling?Promise.reject({type:"statusNotMatch",error:"开启会话失败: 当前正在通话中"}):(this.signalInited=!0,this.calling=!0,this.channelId=e.channelId,this.type=e.netcallType,this.imInfo=e,this.imInfo.serverAddrs=e.rtcServerMap,this.imInfo.rtcUrls=e.rtcServerMap,this.beCalledInfo=this.imInfo,this.imInfo.sessionConfig&&this.setSessionConfig(this.imInfo.sessionConfig),this.parseAccountUidMap(e.accountUidMap),Promise.resolve())}},{key:"startSession",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.wssArr&&(this.imInfo.serverAddrs=e.wssArr.constructor===Array?e.wssArr:[e.wssArr]),this.baseStartSession(),this.controller.uploadDataApi("start",{uid:this.imInfo.uid}),this.controller.startSession(this.imInfo)}},{key:"startRtc",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.startSession(e)}},{key:"stopSession",value:function(){return this.controller.stopSession()}}]),t}(u.default),g=v.prototype;g=Object.assign(g,l.default),g=Object.assign(g,p.default),g=Object.assign(g,f.default),g=Object.assign(g,h.default),t.default=v,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(58),i=n(42);t.default={createChannel:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i.tool.verifyOptions(t,"channelName"),t.custom=t.custom||"",t.webrtcEnable=!0,this.controller.uploadDataApi("update",{key:"meeting"}),this.setSessionConfig({signalStartTime:Date.now()}),this.baseCreateChannel("createChannel",t).then(function(e){return Promise.resolve(e)}).catch(function(t){return e.setSessionConfig({signalEndTime:Date.now()}),e.controller.uploadDataRtcOnce({code:t.code}),Promise.reject(t)})},joinChannel:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.signalInited)return Promise.reject("已经加入房间");i.tool.verifyOptions(t,"channelName type");var n=t.sessionConfig,o=void 0===n?{}:n;if(o.liveEnable=t.liveEnable||o.liveEnable,i.tool.merge(this,{sessionConfig:o}),this.setSessionConfig(o),this.setSessionConfig({signalStartTime:Date.now()}),this.controller.uploadDataApi("update",{key:"meeting"}),t.liveEnable&&this.controller.uploadDataApi("update",{key:"bypass",ext:void 0!==o.splitMode?+o.splitMode+1:0}),o.highAudio&&this.controller.uploadDataApi("update",{key:"hd_audio"}),void 0!==o.videoFrameRate&&this.controller.uploadDataApi("update",{key:"fps",ext:0==+o.videoFrameRate?0:+o.videoFrameRate+1}),void 0!==o.videoQuality){var a=+o.videoQuality;a===r.constantRtc.CHAT_VIDEO_QUALITY_540P?a=r.constantRtc.CHAT_VIDEO_QUALITY_720P:a===r.constantRtc.CHAT_VIDEO_QUALITY_720P&&(a=r.constantRtc.CHAT_VIDEO_QUALITY_540P),this.controller.uploadDataApi("update",{key:"video_quality",ext:a||0})}return this.baseJoinChannel("joinChannel",{channelName:t.channelName,liveEnable:t.liveEnable}).then(function(n){return console.log("joinChannel",n),e.type=n.type=t.type,n.account=e.nim.account,e.imInfo=n,e.imInfo.role=void 0===t.role?0:t.role,e.channelId=n.channelId,e.controller.uploadDataApi("start",{uid:n.uid}),Promise.resolve({uid:n.uid,account:e.nim.account,type:n.type,custom:n.custom})}).catch(function(t){return e.controller.uploadDataRtcOnce({code:t.code}),Promise.reject(t)})},leaveChannel:function(){return this.signalInited&&this.sessionMode?"meeting"!==this.sessionMode?Promise.reject({code:"not in a meeting"}):(this.controller.uploadDataApi("send"),this.controller.hangup(),this.resetStatus(),Promise.resolve()):Promise.reject({code:"noConnection"})}},e.exports=t.default}])});